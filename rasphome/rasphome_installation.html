<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="StÃ©phane Apiou">
<title>Installation d&#8217;un home serveur Linux sur un Raspberry</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="article">
<div id="header">
<h1>Installation d&#8217;un home serveur Linux sur un Raspberry</h1>
<div class="details">
<span id="author" class="author">StÃ©phane Apiou</span><br>
<span id="email" class="email"><a href="mailto:stephane@apiou.org">stephane@apiou.org</a></span><br>
<span id="revnumber">version 1.1,</span>
<span id="revdate">2022-05-17</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_avant_propos">1. Avant propos</a></li>
<li><a href="#root_login">2. Se loguer root sur le serveur</a></li>
<li><a href="#pass_gen">3. Gestion des mots de passe</a></li>
<li><a href="#_installation_du_linux_sur_votre_raspberry_pi">4. Installation du linux sur votre Raspberry Pi</a>
<ul class="sectlevel2">
<li><a href="#_installation_avec_Ã©cran_et_clavier">4.1. Installation avec Ã©cran et clavier</a></li>
<li><a href="#_installation_headless_de_raspberry_pi_os_lite_64_bit">4.2. Installation Headless de Raspberry Pi OS LITE (64-bit)</a></li>
<li><a href="#_installation_headless_de_ubuntu_64">4.3. Installation Headless de Ubuntu 64</a></li>
<li><a href="#_reconnecter_automatiquement_votre_raspberry_pi_au_wifi">4.4. Reconnecter automatiquement votre Raspberry Pi au wifi</a></li>
</ul>
</li>
<li><a href="#_configuration_basique">5. Configuration basique</a>
<ul class="sectlevel2">
<li><a href="#_mettre_lÃ©diteur_de_votre_choix">5.1. Mettre l&#8217;Ã©diteur de votre choix</a></li>
<li><a href="#_installation_dun_repository_pour_etc">5.2. Installation d&#8217;un repository pour <code>/etc</code></a></li>
<li><a href="#_mise_Ã _jour_des_sources_de_paquets_debian_ou_ubuntu">5.3. Mise Ã  jour des sources de paquets Debian ou Ubuntu</a></li>
<li><a href="#_installation_des_paquets_de_base">5.4. Installation des paquets de base</a></li>
<li><a href="#_installer_loutil_debfoster">5.5. Installer l&#8217;outil Debfoster</a></li>
<li><a href="#_crÃ©ation_dun_fichier_keeper_dans_etc">5.6. CrÃ©ation d&#8217;un fichier keeper dans /etc</a></li>
<li><a href="#_installation_des_mises_Ã _jours_automatiques">5.7. Installation des mises Ã  jours automatiques</a></li>
<li><a href="#_vÃ©rification_du_nom_de_serveur">5.8. VÃ©rification du nom de serveur</a></li>
<li><a href="#_interdire_le_login_direct_en_root">5.9. Interdire le login direct en root</a></li>
<li><a href="#_crÃ©ation_dune_clÃ©_de_connexion_ssh_locale">5.10. CrÃ©ation d&#8217;une clÃ© de connexion ssh locale</a></li>
<li><a href="#_sudo_sans_mot_de_passe">5.11. Sudo sans mot de passe</a></li>
<li><a href="#_configuration_du_motd">5.12. Configuration du Motd</a></li>
<li><a href="#_installer_loutil_dselect">5.13. Installer l&#8217;outil dselect</a></li>
<li><a href="#swap_create">5.14. Ajouter un fichier de swap</a></li>
</ul>
</li>
<li><a href="#_installation_initiale_des_outils">6. Installation initiale des outils</a>
<ul class="sectlevel2">
<li><a href="#_supprimer_le_sleep_mode">6.1. Supprimer le sleep mode</a></li>
<li><a href="#xfce">6.2. Configuration de xfce et de l&#8217;environnement graphique</a></li>
<li><a href="#_configuration_de_vnc">6.3. Configuration de VNC</a></li>
<li><a href="#hairpinning">6.4. ProcÃ©dure spÃ©cifique pour les serveurs du rÃ©seau local</a></li>
<li><a href="#_configuration_de_ssmtp">6.5. Configuration de ssmtp</a></li>
<li><a href="#firewall">6.6. Deblocage de port de firewall</a></li>
<li><a href="#_configuration_de_avahi">6.7. Configuration de Avahi</a></li>
<li><a href="#pihole">6.8. Configuration de Pi-Hole</a></li>
<li><a href="#_installation_dun_serveur_de_fichier_windows">6.9. Installation d&#8217;un serveur de fichier Windows</a></li>
<li><a href="#_scan_des_vulnÃ©rabilitÃ©s">6.10. Scan des vulnÃ©rabilitÃ©s</a></li>
</ul>
</li>
<li><a href="#_installation_du_systÃ¨me_dadministration_webmin">7. Installation du systÃ¨me d&#8217;administration Webmin</a></li>
<li><a href="#_configuration_de_apt_cacher">8. Configuration de Apt-cacher</a></li>
<li><a href="#_installation_de_docker_et_des_outils_associÃ©s">9. Installation de Docker et des outils associÃ©s</a>
<ul class="sectlevel2">
<li><a href="#_a_propos_des_raspberry_pi">9.1. A propos des Raspberry Pi</a></li>
<li><a href="#_installation_de_docker">9.2. Installation de Docker</a></li>
<li><a href="#_installation_de_docker_compose">9.3. Installation de docker-compose</a></li>
<li><a href="#_installation_de_docker_swarm">9.4. Installation de docker swarm</a></li>
<li><a href="#_choix_des_images_docker">9.5. Choix des images docker</a></li>
<li><a href="#_considÃ©rations_de_sÃ©curitÃ©">9.6. ConsidÃ©rations de sÃ©curitÃ©</a></li>
<li><a href="#_mise_Ã _jour_automatique_des_images">9.7. Mise Ã  jour automatique des images</a></li>
<li><a href="#_surveillance_et_redÃ©marrage_de_container">9.8. Surveillance et redÃ©marrage de container</a></li>
</ul>
</li>
<li><a href="#_installation_de_traefik">10. Installation de Traefik</a>
<ul class="sectlevel2">
<li><a href="#_installation_de_traefik_2">10.1. Installation de Traefik</a></li>
<li><a href="#_configuration_de_traefik_pour_une_utilisation_avec_pi_hole">10.2. Configuration de Traefik pour une utilisation avec Pi-Hole</a></li>
<li><a href="#_upgrade_de_traefik">10.3. Upgrade de Traefik</a></li>
</ul>
</li>
<li><a href="#_outils_web_de_gestion_des_containers">11. Outils web de gestion des containers</a>
<ul class="sectlevel2">
<li><a href="#_installation_de_yacht">11.1. Installation de Yacht</a></li>
<li><a href="#yacht_container_updt">11.2. Upgrade d&#8217;un container dans Yacht</a></li>
<li><a href="#_upgrade_de_yacht">11.3. Upgrade de Yacht</a></li>
<li><a href="#_installation_de_portainer">11.4. Installation de Portainer</a></li>
<li><a href="#port_container_updt">11.5. Upgrade d&#8217;un container dans Portainer</a></li>
<li><a href="#_upgrade_de_portainer">11.6. Upgrade de Portainer</a></li>
</ul>
</li>
<li><a href="#_configuration_de_docker_mirror">12. Configuration de Docker-mirror</a></li>
<li><a href="#_installation_de_statping">13. Installation de Statping</a>
<ul class="sectlevel2">
<li><a href="#_prÃ©requis">13.1. PrÃ©requis</a></li>
<li><a href="#_installation_du_serveur_statping">13.2. Installation du serveur Statping</a></li>
<li><a href="#_crÃ©ation_du_site_web_de_statping">13.3. CrÃ©ation du site web de statping</a></li>
<li><a href="#_configuration_du_site_statping">13.4. Configuration du site statping</a></li>
<li><a href="#_upgrade_de_statping">13.5. Upgrade de Statping</a></li>
</ul>
</li>
<li><a href="#_installation_du_systÃ¨me_de_backup_borgbackup">14. Installation du systÃ¨me de backup BorgBackup</a>
<ul class="sectlevel2">
<li><a href="#_introduction">14.1. Introduction</a></li>
<li><a href="#_installation_du_serveur_de_stockage">14.2. Installation du serveur de stockage</a></li>
<li><a href="#_installation_sur_le_serveur_sauvegardÃ©">14.3. Installation sur le serveur sauvegardÃ©</a></li>
<li><a href="#_effectuer_un_backup">14.4. Effectuer un backup</a></li>
<li><a href="#_lister_les_backups">14.5. Lister les backups</a></li>
<li><a href="#_vÃ©rifier_un_backup">14.6. VÃ©rifier un backup</a></li>
<li><a href="#_restaurer_un_backup">14.7. Restaurer un backup</a></li>
<li><a href="#_supprimer_vos_vieux_backups">14.8. Supprimer vos vieux backups</a></li>
<li><a href="#_automatisez_votre_sauvegarde">14.9. Automatisez votre sauvegarde</a></li>
<li><a href="#_restauration_durgence">14.10. Restauration d&#8217;urgence.</a></li>
<li><a href="#_installation_de_borgweb">14.11. Installation de Borgweb</a></li>
<li><a href="#_crÃ©ation_du_site_web_de_borgweb">14.12. CrÃ©ation du site web de Borgweb</a></li>
</ul>
</li>
<li><a href="#_annexe">15. Annexe</a>
<ul class="sectlevel2">
<li><a href="#_configuration_dun_Ã©cran_3_5_inch_rpi_lcd_a">15.1. Configuration d&#8217;un Ã©cran 3.5 inch RPI LCD (A)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_avant_propos">1. Avant propos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ce document est disponible sur le site <a href="https://raspberry-homeserver.readthedocs.io">ReadTheDocs</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAABOAQAAAACm0R2wAAABI0lEQVR4nLWSQWfEQBTHJztLhdTMVyghpyVrQpWNCT2F0i9Reiqhp556KXvNteRjlD0tGcmlbCTktMyx15LRYS0Z6allXnvdd3p+xu/9nzez6afGGfqt07XCUUttHGpTMhLZdFNpU0MVu0Xij0zqt/9G5G4CKR78BSs5oGouZYOcxKZ8ChDD02DTWsVaZzUwGCxXNygFBpIeztRLBbZA6+NVkWpg0E9R9ViuOpsuetR0CQVevK0C/+sCJPPujXwXBTCYRurL57vQpn0VhXshKczAZBBuQF53vc12hQcM+KFXURQDQ9ia3Gs3IJlwCBexARuTETW7igCDof51sozANITcD80+c0jxOXulGbxxzffZAN6quekOugNePvFhbOF/OE37DQUPepCaGG7wAAAAAElFTkSuQmCC" alt="Diagram" width="78" height="78">
</div>
</div>
<div class="paragraph">
<p>et sur <a href="https://github.com/stefapi/vps_installation">Github</a>. Sur Github vous trouverez aussi les versions PDF, EPUB, HTML, Docbook et Asciidoc de ce document</p>
</div>
<div class="paragraph">
<p>Cette documentation dÃ©crit la mÃ©thode que j&#8217;ai utilisÃ© pour installer un serveur linux de gestion du reseau Home (site auto hÃ©bergÃ©) avec un raspberry PI.</p>
</div>
<div class="paragraph">
<p>Elle est le rÃ©sultat de trÃ¨s nombreuses heures de travail pour collecter la documentation nÃ©cessaire.
Sur mon serveur, j&#8217;ai installÃ© un Ubuntu pour Raspberry. Cette documentation dÃ©crit aussi l&#8217;installation pour une Raspbian.</p>
</div>
<div class="paragraph">
<p>Dans ce document, je montre la configuration de nombreux types de sites web et services dans un domaine en utilisant ISPConfig.</p>
</div>
<div class="paragraph">
<p>Sont installÃ©s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un panel <a href="https://www.ispconfig.org/">ISPConfig</a>,</p>
</li>
<li>
<p>un configurateur <a href="http://www.webmin.com/">Webmin</a>,</p>
</li>
<li>
<p>un serveur apache avec sa configuration let&#8217;s encrypt et les plugins PHP, Python et Ruby,</p>
</li>
<li>
<p>un serveur de mail avec antispam, sÃ©curisation d&#8217;envoi des mails et autoconfiguration pour Outlook, Thunderbird, Android,</p>
</li>
<li>
<p>un webmail <a href="https://roundcube.net">roundcube</a>,</p>
</li>
<li>
<p>un serveur de mailing list <a href="https://www.list.org">mailman</a>,</p>
</li>
<li>
<p>un serveur ftp et sftp sÃ©curisÃ©,</p>
</li>
<li>
<p>un serveur de base de donnÃ©es MariaDB et son interface web d&#8217;administration <a href="https://www.phpmyadmin.net/">phpmyadmin</a>,</p>
</li>
<li>
<p>des outils de sÃ©curisation, de mise Ã  jour automatique et d&#8217;audit du serveur,</p>
</li>
<li>
<p>un outil de Monitoring <a href="http://munin-monitoring.org/">Munin</a>,</p>
</li>
<li>
<p>un outil de Monitoring <a href="http://mmonit.com/monit/">Monit</a>,</p>
</li>
<li>
<p>l&#8217;installation de <a href="https://hub.docker.com/">Docker</a> et des outils <a href="https://portainer.io">Portainer</a> et <a href="https://yacht.sh">Yacht</a>,</p>
</li>
<li>
<p>un sous domaine pointant sur un site auto-hÃ©bergÃ© (lâinstallation du site n&#8217;est pas dÃ©crite ici; Se rÃ©fÃ©rer Ã  <a href="https://yunohost.org">Yunohost</a> ) par exemple,</p>
</li>
<li>
<p>un site CMS sous <a href="https://www.joomla.fr/">Joomla</a>,</p>
</li>
<li>
<p>un site CMS sous <a href="https://www.concrete5.org/">Concrete5</a>,</p>
</li>
<li>
<p>un site WIKI sous <a href="https://www.mediawiki.org">Mediawiki</a>,</p>
</li>
<li>
<p>un site de blog <a href="https://wordpress.com">Wordpress</a>,</p>
</li>
<li>
<p>un site <a href="https://microweber.org/">Microweber</a>,</p>
</li>
<li>
<p>un site Photo sous <a href="https://piwigo.org/">Piwigo</a>,</p>
</li>
<li>
<p>un site de partage de recettes de cuisine <a href="https://hay-kot.github.io/mealie/">Mealie</a></p>
</li>
<li>
<p>un site Collaboratif sous <a href="https://nextcloud.com">Nextcloud</a>,</p>
</li>
<li>
<p>un site <a href="https://gitea.io">Gitea</a> et son repository GIT,</p>
</li>
<li>
<p>un serveur de mots de passe <a href="https://bitwarden.com/">Bitwarden</a>,</p>
</li>
<li>
<p>un dashboard pour vos sites web <a href="https://heimdall.site/">Heimdall</a>,</p>
</li>
<li>
<p>un serveur et un site  de partage de fichiers <a href="https://www.seafile.com">Seafile</a>,</p>
</li>
<li>
<p>un serveur <a href="https://grafana.com/">Grafana</a>, <a href="https://prometheus.io/">Prometheus</a>, <a href="https://github.com/grafana/loki">Loki</a>, Promtail pour gÃ©rer les statistiques et les logs du serveur,</p>
</li>
<li>
<p>un serveur de sauvegardes <a href="https://borgbackup.readthedocs.io/">BorgBackup</a>,</p>
</li>
<li>
<p>un serveur de VPN <a href="https://pritunl.com/">Pritunl</a>,</p>
</li>
<li>
<p>un serveur de bureau Ã  distance <a href="https://guacamole.apache.org">Guacamole</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dans ce document nous configurons un nom de domaine principal. Pour la clartÃ© du texte, il sera nommÃ© "example.com". Il est Ã  remplacer Ã©videmment par votre nom de domaine principal.</p>
</div>
<div class="paragraph">
<p>Je suppose dans ce document que vous savez vous connecter Ã  distance sur un serveur en mode terminal, que vous savez vous servir de <code>ssh</code> pour Linux ou de <code>putty</code> pour Windows, que vous avez des notions Ã©lÃ©mentaires de Shell Unix et que vous savez vous servir de l&#8217;Ã©diteur <code>vi</code>. Si <code>vi</code> est trop compliquÃ© pour vous, je vous suggÃ¨re d&#8217;utiliser l&#8217;Ã©diteur de texte <code>nano</code> Ã  la place et de remplacer <code>vi</code> par <code>nano</code> dans toutes les lignes de commande.</p>
</div>
<div class="paragraph">
<p>Dans le document, on peut trouver des textes entourÃ©s de &lt;texte&gt;. Cela signifie que vous devez mettre ici votre propre texte selon vos prÃ©fÃ©rences.</p>
</div>
<div class="paragraph">
<p>Le coÃ»t pour mettre en oeuvre ce type de serveur est relativement faible:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compter 15-18â¬TTC/an pour un nom de domaine classique (mais il peut y avoir des promos)</p>
</li>
<li>
<p>Comptez 26â¬ pour acheter une carte Raspberry PI 3 A+ (1Go de Ram) et 61â¬ pour un PI 4 avec 4Go de Ram. A cela il faut ajouter un boitier, une alim et une flash de 64 ou 128 Go (prenez les cartes SD les plus rapide possible en Ã©criture). Vous en aurez donc pour 110â¬ si vous achetez tout le kit.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Par rapport Ã  une solution VPS directement dans le cloud, ce budget correspond Ã  7-10 mois d&#8217;abonnement. Si vous avez la Fibre chez vous, il est nettement plus rentable d&#8217;utiliser un Raspberry que de prendre un abonne VPS.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="root_login">2. Se loguer root sur le serveur</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A de nombreux endroit dans la documentation, il est demandÃ© de se loguer root sur le serveur.
Pour se loguer root, et dans lâhypothÃ¨se que vous avez mis en place un compte sudo:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>De votre machine locale, loguez vous avec votre compte <code>&lt;sudo_username&gt;</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh &lt;sudo_username&gt;@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Mettez ici &lt;sudo_username&gt; par votre nom de login et &lt;example.com&gt; par votre nom de domaine ou son adresse IP. Au dÃ©but votre nom de domaine achetÃ© n&#8217;est pas encore configurÃ©. Il faut donc utiliser le nom de machine ( par exemple pour un VPS OVH: VPSxxxxxx.ovh.net ou pour un raspberry: raspberrypi.local ) ou votre adresse IP.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ou utilisez putty si vous Ãªtes sous Windows.</p>
</div>
</li>
<li>
<p>Tapez votre mot de passe s&#8217;il est demandÃ©. Si vous avez installÃ© une clÃ© de connexion ce ne devrait pas Ãªtre le cas.</p>
</li>
<li>
<p>Loguez-vous <code>root</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sudo </span>bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Un mot de passe vous est demandÃ©. Tapez le mot de passe demandÃ©.</p>
</div>
</li>
<li>
<p>Dans le cas contraire (pas de sudo crÃ©Ã© et connexion en root directe sur le serveur):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Se loguer root sur le serveur distant. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh root@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;example.com&gt; par votre nom de domaine.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tapez ensuite votre mot de passe root</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pass_gen">3. Gestion des mots de passe</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A propos des mots de passe: il est conseillÃ© de saisir des mots de passe de 10 caractÃ¨res contenant des majuscules/minuscules/nombres/caractÃ¨res spÃ©ciaux. Une autre faÃ§on de faire est de saisir de longues phrases. Par exemple: 'J&#8217;aime manger de la mousse au chocolat parfumÃ©e Ã  la menthe'. Ce dernier exemple a un taux de complexitÃ© bien meilleur qu&#8217;un mot de passe classique. Il est aussi plus facile Ã  retenir que 'Az3~1ym_a&amp;'.</p>
</div>
<div class="paragraph">
<p>Cependant, si vous Ãªtes en manque d&#8217;inspiration et que vous souhaitez gÃ©nÃ©rer des mots de passe, voici quelques mÃ©thodes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>En se basant sur la date. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">date</span> +%s | <span class="nb">sha256sum</span> | <span class="nb">base64</span> | <span class="nb">head</span> <span class="nt">-c</span> 32 <span class="p">;</span> <span class="nb">echo</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez 32 par la valeur qui vous convient pour gÃ©nÃ©rer un mot de passe d&#8217;une taille diffÃ©rente de 32 caractÃ¨res</td>
</tr>
</table>
</div>
</li>
<li>
<p>En se basant sur les nombres alÃ©atoires systÃ¨me. Tapez l&#8217;une des deux lignes ci dessous :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">tr</span> <span class="nt">-cd</span> <span class="s1">'[:graph:]'</span> &lt; /dev/urandom | <span class="nb">head</span> <span class="nt">-c</span> 32<span class="p">;</span> <span class="nb">echo <i class="conum" data-value="1"></i><b>(1)</b>
tr</span> <span class="nt">-cd</span> A-Za-z0-9 &lt; /dev/urandom | <span class="nb">head</span> <span class="nt">-c</span> 32<span class="p">;</span><span class="nb">echo</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez 32 par la valeur qui vous convient pour gÃ©nÃ©rer un mot de passe d&#8217;une taille diffÃ©rente de 32 caractÃ¨res</td>
</tr>
</table>
</div>
</li>
<li>
<p>En utilisant Openssl. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">openssl rand <span class="nt">-base64</span> 32 | <span class="nb">cut</span> <span class="nt">-c-32</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez 32 par la valeur qui vous convient pour gÃ©nÃ©rer un mot de passe d&#8217;une taille diffÃ©rente de 32 caractÃ¨res</td>
</tr>
</table>
</div>
</li>
<li>
<p>En utilisant gpg. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">gpg <span class="nt">--gen-random</span> <span class="nt">--armor</span> 1 32 | <span class="nb">cut</span> <span class="nt">-c-32</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez 32 par la valeur qui vous convient pour gÃ©nÃ©rer un mot de passe d&#8217;une taille diffÃ©rente de 32 caractÃ¨res</td>
</tr>
</table>
</div>
</li>
<li>
<p>En utilisant pwgen pour gÃ©nÃ©rer des mots de passe qui suivent des rÃ¨gles de longueur et types de caractÃ¨res.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Pour installer l&#8217;outil, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>pwgen</code></pre>
</div>
</div>
</li>
<li>
<p>Ensuite tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">pwgen <span class="nt">-Bcny</span> 32 <span class="nt">-1</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez 32 par la valeur qui vous convient pour gÃ©nÃ©rer un mot de passe d&#8217;une taille diffÃ©rente de 32 caractÃ¨res. La commande crÃ©e un mot de passe non ambigue avec au moins une majuscule , une valeur numÃ©rique, un symbole.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>En utilisant apg pour gÃ©nÃ©rer des mots de passe prononcables tel que: <code>7quiGrikCod+ (SEVEN-qui-Grik-Cod-PLUS_SIGN)</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Pour installer l&#8217;outil, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>apg</code></pre>
</div>
</div>
</li>
<li>
<p>Ensuite tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apg</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>En utilisant xkcdpass pour gÃ©nÃ©rer des passphrases comme: <code>context smashup spiffy cuddly throttle landfall</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Pour installer l&#8217;outil, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>xkcdpass</code></pre>
</div>
</div>
</li>
<li>
<p>Ensuite tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">xkcdpass</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_linux_sur_votre_raspberry_pi">4. Installation du linux sur votre Raspberry Pi</h2>
<div class="sectionbody">
<div class="paragraph">
<p>C&#8217;est la premiÃ¨re Ã©tape.</p>
</div>
<div class="paragraph">
<p>Il vous faut bien choisir le type de linux que vous souhaitez installer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debian: C&#8217;est la distribution la plus connue et celle qui offre le plus de possibilitÃ©s juste aprÃ¨s l&#8217;installation (notamment pour faire de la domotique, utiliser le GPIO &#8230;&#8203;) .</p>
</li>
<li>
<p>Ubuntu 64: Elle est plus proche d&#8217;une Ubuntu standard et propose beaucoup de paquets pour faire fonctionner votre raspberry en serveur web.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il vous faudra un lecteur de flash microSD - USB que vous brancherez sur votre PC.</p>
</div>
<div class="paragraph">
<p>Il existe maintenant un outil nommÃ© <a href="https://www.raspberrypi.org/downloads/">Rasberry PI Imager</a> pour la plateforme qui vous convient. C&#8217;est le moyen de plus simple de flasher votre Raspberry pi.</p>
</div>
<div class="paragraph">
<p>Pour Windows, trÃ¨s simple, il suffit de lancer le programme tÃ©lÃ©chargÃ©.
Pour Linux, appliquer la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /tmp
wget https://downloads.raspberrypi.org/imager/imager_amd64.deb
dpkg <span class="nt">-i</span> imager_amd64.deb</code></pre>
</div>
</div>
</li>
<li>
<p>Lancez le programme.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure ci dessous commune Ã  toutes les plateformes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>SÃ©lectionnez <code>Choose OS</code> et dans la liste choisissez <code>Raspberry Pi OS LITE (64-bit)</code> ou <code>Ubuntu 64</code></p>
</li>
<li>
<p>SÃ©lectionnez <code>CHoose SD CARD</code> et sÃ©lectionnez votre lecteur de carte SD</p>
</li>
<li>
<p>Cliquez sur <code>Write</code></p>
</li>
<li>
<p>Attendez la fin du chargement et de l&#8217;Ã©criture sur la flash.</p>
</li>
<li>
<p>Vous avez deux faÃ§ons d&#8217;installer:</p>
<div class="ulist">
<ul>
<li>
<p>avec un Ã©cran et un clavier qui est la mÃ©thode la plus facile</p>
</li>
<li>
<p>en mode Headless qui est plus complexe mais ne nÃ©cessite pas d&#8217;Ã©cran ni de clavier</p>
</li>
</ul>
</div>
</li>
<li>
<p>Vous devez choisir l&#8217;une des mÃ©thodes dÃ©crites dans les deux chapitres suivants.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_installation_avec_Ã©cran_et_clavier">4.1. Installation avec Ã©cran et clavier</h3>
<div class="paragraph">
<p>Pour ce type d&#8217;installation, il vous faut un clavier+souris et un Ã©cran.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enlevez la carte SD de votre lecteur et insÃ©rez la dans votre raspberry PI.</p>
</li>
<li>
<p>Brancher un clavier, une souris et un Ã©cran (ou utilisez un Ã©cran 3,5" configurÃ© selon la procÃ©dure en annexe).</p>
</li>
<li>
<p>Branchez votre Raspberry sur votre rÃ©seau Ethernet filaire (vous pouvez aussi utiliser le wifi)</p>
</li>
<li>
<p>DÃ©marrez votre Raspberry.</p>
</li>
<li>
<p>AprÃ¨s l&#8217;Ã©cran de dÃ©marrage arc en ciel, vous devez assez rapidement arriver sur le bureau</p>
</li>
<li>
<p>Un programme doit se lancer automatiquement.</p>
</li>
<li>
<p>SÃ©lectionnez le clavier et la langue en franÃ§ais</p>
</li>
<li>
<p>Tapez votre nouveau mot de passe pour le login <code>pi</code></p>
</li>
<li>
<p>Choisissez un full screen sans bords</p>
</li>
<li>
<p>Choisissez votre connexion wifi et entrez le mot de passe</p>
</li>
<li>
<p>Bien noter votre adresse IP elle vous sera utile ensuite</p>
</li>
<li>
<p>Les mises Ã  jours de paquets Debian ainsi que l&#8217;installation des traductions en franÃ§ais vont s&#8217;installer.</p>
</li>
<li>
<p>Une fois les installations terminÃ©es, le Raspberry va rebooter.</p>
</li>
<li>
<p>Une fois rebootÃ©, sÃ©lectionnez dans le menu <code>PrÃ©fÃ©rences</code>&#8594;`Configuration du Raspberry PI`</p>
<div class="ulist">
<ul>
<li>
<p>Dans l&#8217;onglet <code>Display</code> Cliquez sur <code>Set Resolution</code> et choisissez <code>31: 1920x1080</code></p>
</li>
<li>
<p>Dans l&#8217;onglet <code>Interfaces</code> activez <code>SSH</code> et <code>VNC</code></p>
</li>
<li>
<p>Cliquez sur <code>Valider</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur lâicÃ´ne <code>VNC</code> dans la barre en haut Ã  Droite</p>
<div class="ulist">
<ul>
<li>
<p>Dans la fenÃªtre cliquez sur le menu burger en haut Ã  Droite.</p>
</li>
<li>
<p>Choisissez <code>Options</code> puis l&#8217;onglet <code>SÃ©curitÃ©</code></p>
</li>
<li>
<p>Dans le champ Authentification choisissez l&#8217;option <code>mot de passe VNC</code></p>
</li>
<li>
<p>Tapez votre mot de passe dans les deux champs et cliquez <code>Valider</code> puis <code>OK</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Vous pouvez maintenant rebooter votre Raspberry sans Ã©cran et sans clavier pour continuer la configuration.</p>
</li>
<li>
<p>Vous avez deux options: connexion en mode SSH ou au travers d&#8217;une connexion VNC</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_headless_de_raspberry_pi_os_lite_64_bit">4.2. Installation Headless de Raspberry Pi OS LITE (64-bit)</h3>
<div class="paragraph">
<p>Pour ce type d&#8217;installation, pas besoin d&#8217;Ã©cran, de clavier et de souris. Tout s&#8217;effectue Ã  distance.</p>
</div>
<div class="paragraph">
<p>Dans la suite, je suppose que vous possÃ¨dez un PC fonctionnant avec un Linux (la procÃ©dure peut Ãªtre adaptÃ©e pour une machine windows en utilisant la ligne de commande et putty)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Avant d&#8217;enlever votre flash SD du lecteur, appliquez la procÃ©dure ci aprÃ¨s:</p>
<div class="ulist">
<ul>
<li>
<p>Sur la flash, 2 partitions ont Ã©tÃ© crÃ©es. Montez la partition boot</p>
</li>
<li>
<p>sur cette partition, crÃ©ez un fichier <code>wpa_supplicant.conf</code> et Ã©ditez le avec un Ã©diteur de text (Nano ou vi sous linux ou Notepad sous windows).</p>
</li>
<li>
<p>Mettez y le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=US
network={
    ssid="YOURSSID" <i class="conum" data-value="1"></i><b>(1)</b>
    psk="YOURPASSWORD" <i class="conum" data-value="2"></i><b>(2)</b>
    key_mgmt=WPA-PSK
    scan_ssid=1
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez <code>YOURSSID</code> par le nom SSID de votre wifi local</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>remplacez <code>YOURPASSWORD</code> par le mot de passe de votre wifi local</td>
</tr>
</table>
</div>
</li>
<li>
<p>sauvez le fichier</p>
</li>
<li>
<p>Sur la mÃªme partition crÃ©ez un fichier <code>ssh</code> (vide et sans extension). Il servira Ã  indiquer au raspberry d&#8217;activer ssh au prochain boot</p>
</li>
<li>
<p>dÃ©montez la partition</p>
</li>
<li>
<p>au boot sur la carte SD, le fichier sera recopiÃ© dans votre configuration et le rÃ©seau wifi sera ainsi accessible</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enlevez la carte SD de votre lecteur et insÃ©rez la dans votre Raspberry PI.</p>
</li>
<li>
<p>DÃ©marrez votre raspberry.</p>
</li>
<li>
<p>Attendez environ 2 minutes le temps que le premier boot se termine. Tout pendant la procÃ©dure de boot, la petite led d&#8217;accÃ¨s disque doit clignoter.</p>
</li>
<li>
<p>Vous devez maintenant dÃ©couvrir l&#8217;adresse IP de votre Raspberry, pour cela tapez la commande suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ping raspberrypi.local</code></pre>
</div>
</div>
</li>
<li>
<p>Si le Raspberry a dÃ©marrÃ© correctement, cette commande doit montrer l&#8217;adresse IP du raspberry et une rÃ©ponse correcte au ping</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>PING raspberrypi.local (192.168.3.212) 56(84) bytes of data.
64 bytes from raspberrypi.local (192.168.3.212): icmp_seq=1 ttl=64 time=1.32 ms</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Vous pouvez aussi utiliser la commande suivante:
+</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre> arp -na | grep -Pi "(b8:27:eb)|(dc:a6:32)"</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Si vous n&#8217;obtenez aucun rÃ©sultat essayer la commande <code>nmap</code> sur le subnet de votre rÃ©seau local</p>
<div class="ulist">
<ul>
<li>
<p>On obtient l&#8217;adresse local du subnet en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">hostname</span> <span class="nt">-I</span></code></pre>
</div>
</div>
</li>
<li>
<p>l&#8217;adresse IP de votre PC est affichÃ©e comme premier mot. Par exemple :`192.168.3.10`</p>
</li>
<li>
<p>le subnet se dÃ©duit de cette adresse en gardant les 3 premiers nombres (cas gÃ©nÃ©ral de la plupart des utilisateurs).</p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">nmap <span class="nt">-sn</span> 192.168.3.0/24</code></pre>
</div>
</div>
</li>
<li>
<p>la commande affiche alors les adresses IP et mac de toutes les machines prÃ©sentes sur le rÃ©seau.</p>
</li>
<li>
<p>le Raspberry se reconnait par son nom de machine qui contient le terme <code>raspberry</code> ou par son adresse mac qui est reconnue du type <code>Raspberry Pi Foundation</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>vous pouvez alors directement vous connecter. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh pi@adresse_ip <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>adresse_ip est l&#8217;adresse IP du Raspberry pi dÃ©couverte prÃ©cÃ©demment ou raspberrypi.local</td>
</tr>
</table>
</div>
</li>
<li>
<p>Se loguer avec le mot de passe <code>raspberry</code></p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sudo </span>raspi-config</code></pre>
</div>
</div>
</li>
<li>
<p>Choisissez <code>1 Change User Password</code> &#8594; tapez votre nouveau mot de passe 2 fois</p>
</li>
<li>
<p>Sur l&#8217;Ã©tape suivante, il ne faut pas se louper ou vous serez obligÃ© d&#8217;Ã©teindre votre raspberry, retirer la flash et la reprogrammer avec le fichier <code>wpa_supplicant.conf</code> dans la partition <code>boot</code></p>
</li>
<li>
<p>Choisissez <code>2 Network Options</code> &#8594; <code>N2 Wi-fi</code> &#8594; Tapez votre nom de SSID (attention aux majuscules) &#8594; Tapez votre mot de passe</p>
</li>
<li>
<p>Choisissez <code>4 Localisation Options</code> &#8594; <code>I1 Change Locale</code> &#8594; SÃ©lectionnez votre langue: <code>fr_FR.UTF-8 UTF-8</code> &#8594; puis la locale par dÃ©faut <code>fr_FR.UTF-8 UTF-8</code></p>
</li>
<li>
<p>Choisissez <code>4 Localisation Options</code> &#8594; <code>I2 Change Timezone</code> &#8594; Choisissez votre timezone (par exemple: <code>Europe</code> &#8594; <code>Paris</code>)</p>
</li>
<li>
<p>Choisissez <code>4 Localisation Options</code> &#8594; <code>I3 Change Keyboard Layout</code> &#8594; Choisissez votre mapping clavier</p>
</li>
<li>
<p>Choisissez <code>4 Localisation Options</code> &#8594; <code>I4 Change Wi-fi Country</code> &#8594; choisissez votre pays de norme wifi</p>
</li>
<li>
<p>choisissez <code>5 Interfacing Options</code> &#8594; <code>P2 SSH</code> &#8594; choisissez <code>yes</code></p>
</li>
<li>
<p>choisissez <code>7 Advanced Options</code> &#8594; <code>A5 Resolution</code> &#8594; choisissez <code>DMT Mode 82 1920x1080 60Hz 16:9</code></p>
</li>
<li>
<p>choisissez <code>8 Update</code> ; Une mise a jour du systÃ¨me va s&#8217;effectuer</p>
</li>
<li>
<p>Tapez ensuite 2 fois sur la touche <code>TAB</code> pour sÃ©lectionner <code>Finish</code>. Tapez <code>entrÃ©e</code>.</p>
</li>
<li>
<p>Rebootez le systÃ¨me en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sudo </span>reboot</code></pre>
</div>
</div>
</li>
<li>
<p>Vous allez perdre votre connexion avec le raspberry</p>
</li>
<li>
<p>si vous arrivez Ã  vous reloguer en tapant (attendre 30 secondes aprÃ¨s le reboot avant d&#8217;essayer):</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh pi@adresse_ip <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>adresse_ip est l&#8217;adresse IP du Raspberry pi dÃ©couverte prÃ©cÃ©demment ou raspberrypi.local</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>C&#8217;est que vous avez terminÃ© avec succÃ¨s la configuration initiale.</p>
</div>
</li>
<li>
<p>Vous avez terminÃ© l&#8217;installation initiale de Debian. Vous pouvez maintenant rebooter votre raspberry pour continuer la configuration.</p>
</li>
<li>
<p>Vous avez deux options: connexion en mode SSH ou au travers d&#8217;une connection VNC</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_headless_de_ubuntu_64">4.3. Installation Headless de Ubuntu 64</h3>
<div class="paragraph">
<p>Pour ce type d&#8217;installation, pas besoin d&#8217;Ã©cran, de clavier et de souris. Tout s&#8217;effectue Ã  distance.</p>
</div>
<div class="paragraph">
<p>Dans la suite, je suppose que vous possÃ©dez un PC fonctionnant avec un Linux (la procÃ©dure peut Ãªtre adaptÃ©e pour une machine Windows en utilisant la ligne de commande et putty)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Avant d&#8217;enlever votre flash SD du lecteur, appliquez la procÃ©dure ci aprÃ¨s:</p>
<div class="ulist">
<ul>
<li>
<p>Sur la flash, 2 partitions ont Ã©tÃ© crÃ©es. Montez la partition <code>system-boot</code></p>
</li>
<li>
<p>sur cette partition, editez le fichier <code>network-config</code> et Ã©ditez le avec un Ã©diteur de text (Nano ou vi sous linux ou Notepad sous windows).</p>
</li>
<li>
<p>Mettez y le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>version: 2
ethernets:
  eth0:
    dhcp4: true
    optional: true
wifis:
  wlan0:
    dhcp4: true
    optional: true
    access-points:
      YOURSSID: <i class="conum" data-value="1"></i><b>(1)</b>
        password: "YOURPASSWORD" <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez <code>YOURSSID</code> par le nom SSID de votre wifi local</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>remplacez <code>YOURPASSWORD</code> par le mot de passe de votre wifi local</td>
</tr>
</table>
</div>
</li>
<li>
<p>sauvez le fichier</p>
</li>
<li>
<p>dÃ©montez la partition</p>
</li>
<li>
<p>au boot sur la carte SD, le fichier sera recopiÃ© dans votre configuration et le rÃ©seau wifi sera ainsi accessible</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enlevez la carte SD de votre lecteur et insÃ©rez la dans votre Raspberry PI.</p>
</li>
<li>
<p>DÃ©marrez votre raspberry.</p>
</li>
<li>
<p>Attendez environ 2 minutes le temps que le premier boot se termine. Tout pendant la procÃ©dure de boot, la petite led d&#8217;accÃ¨s disque doit clignoter.</p>
</li>
<li>
<p>Vous devez maintenant dÃ©couvrir l&#8217;adresse IP de votre Raspberry, pour cela tapez la commande suivante:
+</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre> arp -na | grep -Pi "(b8:27:eb)|(dc:a6:32)"</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensuite testez l&#8217;adresse ip trouvÃ©e</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ping 192.168.0.100 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettez ici l&#8217;adresse IP qui a Ã©tÃ© dÃ©couverte.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Si le Raspberry a dÃ©marrÃ© correctement, cette commande doit montrer l&#8217;adresse IP du raspberry et une rÃ©ponse correcte au ping</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>PING 192.168.0.100 (192.168.0.100) 56(84) bytes of data.
64 bytes from 192.168.0.100: icmp_seq=1 ttl=64 time=1.49 ms</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Si vous n&#8217;obtenez aucun rÃ©sultat essayer la commande <code>nmap</code> sur le subnet de votre rÃ©seau local</p>
<div class="ulist">
<ul>
<li>
<p>On obtient l&#8217;adresse local du subnet en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">hostname</span> <span class="nt">-I</span></code></pre>
</div>
</div>
</li>
<li>
<p>l&#8217;adresse IP de votre PC est affichÃ©e comme premier mot. Par exemple :`192.168.3.10`</p>
</li>
<li>
<p>le subnet se dÃ©duit de cette adresse en gardant les 3 premiers nombres (cas gÃ©nÃ©ral de la plupart des utilisateurs).</p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">nmap <span class="nt">-sn</span> 192.168.3.0/24</code></pre>
</div>
</div>
</li>
<li>
<p>la commande affiche alors les adresses IP et mac de toutes les machines prÃ©sentes sur le rÃ©seau.</p>
</li>
<li>
<p>le Raspberry se reconnait par son nom de machine qui contient le terme <code>ubuntu</code> ou par son adresse mac qui est reconnue du type <code>Raspberry Pi Foundation</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>vous pouvez alors directement vous connecter. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh ubuntu@adresse_ip <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>adresse_ip est l&#8217;adresse IP du Raspberry pi dÃ©couverte prÃ©cÃ©demment</td>
</tr>
</table>
</div>
</li>
<li>
<p>Se loguer avec le mot de passe <code>ubuntu</code></p>
</li>
<li>
<p>Un nouveau mot de passe vous sera demandÃ© puis vous serez dÃ©connectÃ©.</p>
</li>
<li>
<p>Reconnectez vous.</p>
</li>
<li>
<p>Installez la langue franÃ§aise. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>language-pack-fr manpages-fr</code></pre>
</div>
</div>
</li>
<li>
<p>Installer la locale qui vous plait. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">dpkg-reconfigure locales</code></pre>
</div>
</div>
</li>
<li>
<p>Choisissez votre langue locale. Par exemple: <code>fr_FR.UTF-8</code></p>
</li>
<li>
<p>Installer la la timezone qui vous plait. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">dpkg-reconfigure tzdata</code></pre>
</div>
</div>
</li>
<li>
<p>Choisissez votre Timezone. Par exemple: <code>Europe/Paris</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_reconnecter_automatiquement_votre_raspberry_pi_au_wifi">4.4. Reconnecter automatiquement votre Raspberry Pi au wifi</h3>
<div class="paragraph">
<p>Si vous connectez votre raspberry pi au rÃ©seau au travers du wifi, il arrive que le raspberry perde la connexion au rÃ©seau de faÃ§on dÃ©finitive.</p>
</div>
<div class="paragraph">
<p>Pour corriger ce problÃ¨me, il faut reconnecter Raspberry Pi au rÃ©seau wifi de maniÃ¨re forcÃ©e.</p>
</div>
<div class="paragraph">
<p>Ce problÃ¨me apparait surtout avec les Raspberry PI 3 et plus rarement avec les PI 4.</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure ci-aprÃ¨s:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ãditez le fichier <code>wifi_rebooter.sh</code> :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>iw
vi /usr/local/bin/wifi_rebooter.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Collez-y le contenu suivant :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/bash</span>

<span class="nv">SERVER</span><span class="o">=</span>8.8.8.8

<span class="c"># Envoyer seulement 2 pings, et envoyer la sortie vers /dev/null</span>
ping <span class="nt">-c2</span> <span class="k">${</span><span class="nv">SERVER</span><span class="k">}</span> <span class="o">&gt;</span> /dev/null

<span class="c"># Si le code retour du ping ($?) est diffÃ©rent de 0 (qui correspond Ã  une erreur)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="o">!=</span> 0 <span class="o">]</span>
<span class="k">then</span>
    <span class="c"># Power save off</span>

    <span class="c"># Relancer l'interface wifi</span>
    ip <span class="nb">link set </span>dev wlan0 down
    <span class="nb">sleep </span>2
    ip <span class="nb">link set </span>dev wlan0 up
    <span class="nb">sleep </span>2
    iw dev wlan0 <span class="nb">set </span>power_save off
<span class="k">fi</span></code></pre>
</div>
</div>
</li>
<li>
<p>Rendre le script exÃ©cutable:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod</span> +x /usr/local/bin/wifi_rebooter.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Mettre en place la crontab:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">crontab <span class="nt">-e</span></code></pre>
</div>
</div>
</li>
<li>
<p>Ajouter Ã  la fin du fichier les lignes suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="k">*</span>/5 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span>   /usr/local/bin/wifi_rebooter.sh</code></pre>
</div>
</div>
</li>
<li>
<p>C&#8217;est fait !</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_basique">5. Configuration basique</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_mettre_lÃ©diteur_de_votre_choix">5.1. Mettre l&#8217;Ã©diteur de votre choix</h3>
<div class="paragraph">
<p>En fonction de vos prÃ©fÃ©rences en terme d&#8217;Ã©diteur, choisissez celui qui vous convient pour les outils utilisant un Ã©diteur de faÃ§on automatique tels que <code>crontab</code>.</p>
</div>
<div class="paragraph">
<p>Pour les dÃ©butants, il est conseillÃ© d&#8217;utiliser nano.</p>
</div>
<div class="paragraph">
<p><a href="#root_login">Loguez vous comme root </a> et tapez:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">update-alternatives  <span class="nt">--config</span> editor</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation_dun_repository_pour_etc">5.2. Installation d&#8217;un repository pour <code>/etc</code></h3>
<div class="paragraph">
<p>Si vous souhaitez gÃ©rer en gestion de configuration le contenu de votre rÃ©pertoire <code>/etc</code>, installez <code>etckeeper</code>.</p>
</div>
<div class="paragraph">
<p>Cette installation est optionnelle.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt update
apt <span class="nb">install </span>etckeeper</code></pre>
</div>
</div>
</li>
<li>
<p>Vous pouvez crÃ©er un repository privÃ© dans le cloud pour stocker votre configuration de serveur (autre serveur privÃ© de confiance ou repository privÃ©  <code>Gitlab</code> ou <code>Github</code>).</p>
</li>
<li>
<p>Ajoutez ce repository distant. Pour <code>Gitlab</code> et <code>Github</code>, une fois le repository crÃ©Ã©, demandez l&#8217;affichage de la commande git pour une communication en ssh. Tapez ensuite sur votre serveur :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /etc
git remote add origin git@github.com:username/etc_keeper.git <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer l&#8217;url par celle qui correspond au chemin de votre repository</td>
</tr>
</table>
</div>
</li>
<li>
<p>modifier le fichier de configuration de <code>etckeeper</code>. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/etckeeper/etckeeper.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Recherchez la ligne contenant <code>PUSH_REMOTE</code> et ajoutez y tous les repositories distant sur lesquels vous souhaitez pousser les modifications. Pour notre configuration, mettez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">PUSH_REMOTE</span><span class="o">=</span><span class="s2">"origin"</span></code></pre>
</div>
</div>
</li>
<li>
<p>Pour Ã©viter des demandes de mot de passe de la part de <code>github</code> ou <code>gitlab</code>, il est nÃ©cessaire de dÃ©clarer une clÃ© publique sur leur site. CrÃ©ez une clÃ© sur votre serveur pour l&#8217;utilisateur root:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>CrÃ©er un rÃ©pertoire <code>/root/.ssh</code> s&#8217;il n&#8217;existe pas. tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /root
<span class="nb">mkdir</span> <span class="nt">-p</span> .ssh</code></pre>
</div>
</div>
</li>
<li>
<p>Allez dans le rÃ©pertoire. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /root/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>GÃ©nÃ©rez vous clÃ©s. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh-keygen <span class="nt">-t</span> rsa</code></pre>
</div>
</div>
</li>
<li>
<p>Un ensemble de questions apparaÃ®t. Si un texte vous explique que le fichier existe dÃ©jÃ , arrÃªtez la procÃ©dure. Cela signifie que vous avez dÃ©jÃ  crÃ©Ã© une clÃ© et que vous risquez de perdre la connexion Ã  d&#8217;autres serveurs si vous en gÃ©nÃ©rez une nouvelle. Sinon, appuyez sur EntrÃ©e Ã  chaque fois pour accepter les valeurs par dÃ©faut.</p>
</li>
<li>
<p>Allez sur <code>gitlab</code> ou <code>github</code> dans la rubriques "settings" et le menu "SSH keys". Ajoutez la clÃ© que vous aurez affichÃ© avec la commande suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cat</span> /root/.ssh/id_rsa.pub</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Effectuez un premier push. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /etc
git push <span class="nt">-u</span> origin master</code></pre>
</div>
</div>
</li>
<li>
<p>aucun mot de passe ne doit vous Ãªtre demandÃ©. Si ce n&#8217;est pas le cas, re-vÃ©rifier les Ã©tapes prÃ©cÃ©dentes.</p>
</li>
<li>
<p>Lancer <code>etckeeper</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">etckeeper commit</code></pre>
</div>
</div>
</li>
<li>
<p>Tout le contenu de <code>/etc</code> est poussÃ© sur le repository. Saisissez un commentaire.</p>
</li>
<li>
<p>C&#8217;est fait !</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_mise_Ã _jour_des_sources_de_paquets_debian_ou_ubuntu">5.3. Mise Ã  jour des sources de paquets Debian ou Ubuntu</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Selon la distribution installÃ©e suivez la procÃ©dure ci-aprÃ¨s ou celle suivante.</p>
</li>
<li>
<p>Modifier la liste standard de paquets Debian</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ãditer le fichier <code>/etc/apt/sources.list</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/apt/sources.list</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©-commenter les lignes dÃ©butant par <code>deb</code> et contenant le terme <code>backports</code>. Par exemple pour <code>#deb <a href="http://deb.debian.org/debian" class="bare">http://deb.debian.org/debian</a> bullseye-backports main contrib non-free</code> enlever le # en dÃ©but de ligne</p>
</li>
<li>
<p>Ajouter sur toutes les lignes les paquets <code>contrib</code> et <code>non-free</code> . en ajoutant ces textes aprÃ¨s chaque mot <code>main</code> du fichier <code>source.list</code></p>
</li>
<li>
<p>Le fichier doit ressembler Ã  ceci:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">deb</span> <span class="err">http://deb.debian.org/debian</span> <span class="err">bullseye</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span>
<span class="err">deb-src</span> <span class="err">http://deb.debian.org/debian</span> <span class="err">bullseye</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span>

<span class="c">## Major bug fix updates produced after the final release of the
## distribution.
</span><span class="err">deb</span> <span class="err">http://security.debian.org/debian-security</span> <span class="err">bullseye-security</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span>
<span class="err">deb-src</span> <span class="err">http://security.debian.org/debian-security</span> <span class="err">bullseye-security</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span>
<span class="err">deb</span> <span class="err">http://deb.debian.org/debian</span> <span class="err">bullseye-updates</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span>
<span class="err">deb-src</span> <span class="err">http://deb.debian.org/debian</span> <span class="err">bullseye-updates</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span>

<span class="c">## N.B. software from this repository may not have been tested as
## extensively as that contained in the main release, although it includes
## newer versions of some applications which may provide useful features.
</span><span class="err">deb</span> <span class="err">http://deb.debian.org/debian</span> <span class="err">bullseye-backports</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span>
<span class="err">deb-src</span> <span class="err">http://deb.debian.org/debian</span> <span class="err">bullseye-backports</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Modifier la liste standard de paquets Ubuntu</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ãditer le fichier <code>/etc/apt/sources.list</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/apt/sources.list</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©-commenter les lignes dÃ©butant par <code>deb</code> enlever le # en dÃ©but de ligne</p>
</li>
</ol>
</div>
</li>
<li>
<p>Effectuer une mise Ã  niveau du systÃ¨me</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Mettez Ã  jour la liste des paquets. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt update</code></pre>
</div>
</div>
</li>
<li>
<p>Installez les nouveautÃ©s. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt dist-upgrade</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Effectuez du mÃ©nage. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt autoremove</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_des_paquets_de_base">5.4. Installation des paquets de base</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>curl wget ntpdate apt-transport-https apt-listchanges apt-file apt-rdepends man</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installer_loutil_debfoster">5.5. Installer l&#8217;outil Debfoster</h3>
<div class="paragraph">
<p>L&#8217;outil <code>debfoster</code> permet de ne conserver que les paquets essentiels.</p>
</div>
<div class="paragraph">
<p>Cette installation est optionnelle.</p>
</div>
<div class="paragraph">
<p>Il maintient un fichier <code>keepers</code> prÃ©sent dans <code>/var/lib/debfoster</code></p>
</div>
<div class="paragraph">
<p>En rÃ©pondant aux questions de conservations de paquets, <code>debfoster</code> maintient la liste des paquets uniques nÃ©cessaires au systÃ¨me.
Tous les autres paquets seront supprimÃ©s.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ajouter le paquet <code>debfoster</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>debfoster</code></pre>
</div>
</div>
</li>
<li>
<p>Lancez <code>debfoster</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">debfoster</code></pre>
</div>
</div>
</li>
<li>
<p>RÃ©pondez au questions pour chaque paquet</p>
</li>
<li>
<p>Acceptez la liste des modifications proposÃ©es Ã  la fin. Les paquets superflus seront supprimÃ©s</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ci dessous une petite liste de paquets Ã  conserver sur une installation basique Debian 64 pour Raspberry PI:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-listchanges</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-rdepends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-transport-https</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">avahi-daemon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">build-essential</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cifs-utils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">console-setup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">crda</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debconf-utils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debfoster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dphys-swapfile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dselect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ethtool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fake-hwclock</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fbset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firmware-atheros</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firmware-brcm80211</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firmware-libertas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firmware-misc-nonfree</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firmware-realtek</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gdb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hardlink</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">htop</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">libpam-chksshpwd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">libraspberrypi-doc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">man-db</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mkvtoolnix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ncdu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nfs-common</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ntpdate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">p7zip-full</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pi-bluetooth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pkg-config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">python-is-python3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">raspberrypi-net-mods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raspinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rng-tools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rpi-update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rsync</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssh-import-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sudo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">udisks2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">usb-modeswitch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">userconf-pi</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">v4l-utils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wireless-tools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wpasupplicant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zip</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>La mÃªme liste pour un Ubuntu pour Raspberry PI:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-listchanges</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-rdepends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-transport-https</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud-init</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debfoster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">etckeeper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">language-pack-fr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux-firmware-raspi2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux-raspi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manpages-fr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ntpdate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">openssh-server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u-boot-rpi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ubuntu-server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ubuntu-standard</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wpasupplicant</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_dun_fichier_keeper_dans_etc">5.6. CrÃ©ation d&#8217;un fichier keeper dans /etc</h3>
<div class="paragraph">
<p>Vous pourriez Ãªtre intÃ©ressÃ© aprÃ¨s l&#8217;installation de <code>debfoster</code> et de <code>etckeeper</code> de construire automatiquement un fichier qui contient la liste des paquets qui permettent de rÃ©installer le systÃ¨me:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/etckeeper/pre-commit.d/35debfoster</code></pre>
</div>
</div>
</li>
<li>
<p>Saisissez dans le fichier:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nb">set</span> <span class="nt">-e</span>

<span class="c"># Make sure sort always sorts in same order.</span>
<span class="nv">LANG</span><span class="o">=</span>C
<span class="nb">export </span>LANG

shellquote<span class="o">()</span> <span class="o">{</span>
        <span class="c"># Single quotes text, escaping existing single quotes.</span>
        <span class="nb">sed</span> <span class="nt">-e</span> <span class="s2">"s/'/'</span><span class="se">\"</span><span class="s2">'</span><span class="se">\"</span><span class="s2">'/g"</span> <span class="nt">-e</span> <span class="s2">"s/^/'/"</span> <span class="nt">-e</span> <span class="s2">"s/</span><span class="nv">$/</span><span class="s2">'/"</span>
<span class="o">}</span>


<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$VCS</span><span class="s2">"</span> <span class="o">=</span> git <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$VCS</span><span class="s2">"</span> <span class="o">=</span> hg <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$VCS</span><span class="s2">"</span> <span class="o">=</span> bzr <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$VCS</span><span class="s2">"</span> <span class="o">=</span> darcs <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="c"># Make sure the file is not readable by others, since it can leak</span>
        <span class="c"># information about contents of non-readable directories in /etc.</span>
        debfoster <span class="nt">-q</span> <span class="nt">-k</span> /etc/keepers
        <span class="nb">chmod </span>600 /etc/keepers
        <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"1i</span><span class="se">\\</span><span class="s2"># debfoster file"</span> /etc/keepers
        <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"1i</span><span class="se">\\</span><span class="s2"># Generated by etckeeper.  Do not edit."</span>  /etc/keepers

        <span class="c"># stage the file as part of the current commit</span>
        <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$VCS</span><span class="s2">"</span> <span class="o">=</span> git <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                <span class="c"># this will do nothing if the keepers file is unchanged.</span>
                git add keepers
        <span class="k">fi</span>
        <span class="c"># hg, bzr and darcs add not done, they will automatically</span>
        <span class="c"># include the file in the current commit</span>
<span class="k">fi</span></code></pre>
</div>
</div>
</li>
<li>
<p>Sauvez et tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>755 /etc/etckeeper/pre-commit.d/35debfoster</code></pre>
</div>
</div>
</li>
<li>
<p>ExÃ©cutez maintenant <code>etckeeper</code></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">etckeeper commit</code></pre>
</div>
</div>
</li>
<li>
<p>Le fichier keepers est crÃ©Ã© et sauvegardÃ© automatiquement.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_des_mises_Ã _jours_automatiques">5.7. Installation des mises Ã  jours automatiques</h3>
<div class="paragraph">
<p>Si vous souhaitez installer automatiquement les paquets Debian de correction de bugs de sÃ©curitÃ©, cette installation est pour vous.</p>
</div>
<div class="paragraph">
<p>Cette installation est optionnelle.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
L&#8217;installation automatique de paquets peut conduire dans certains cas
trÃ¨s rare Ã  des dysfonctionnements du serveur. Il est important de
regarder pÃ©riodiquement les logs d&#8217;installation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>unattended-upgrades</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_vÃ©rification_du_nom_de_serveur">5.8. VÃ©rification du nom de serveur</h3>
<div class="paragraph">
<p>Cette partie consiste Ã  vÃ©rifier que le serveur a un hostname correctement configurÃ©.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>vÃ©rifier que le hostname est bien celui attendu (c&#8217;est Ã  dire configurÃ© par votre hÃ©bergeur). Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cat</span> /etc/hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le nom du hostname (sans le domaine) doit s&#8217;afficher.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Si ce n&#8217;est pas le cas, changer ce nom en Ã©ditant le fichier. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">vi /etc/hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>Changez la valeur, sauvegardez et rebootez. Tapez :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">reboot</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
</ol>
</div>
</li>
<li>
<p>VÃ©rifier le fichier <code>hosts</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cat</span> /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si le fichier contient plusieurs lignes avec la mÃªme adresse de loopback en <code>127.x.y.z</code>, en gardez une seule et celle avec le hostname et le nom de domaine complet.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>si ce n&#8217;est pas le cas, changer les lignes en Ã©ditant le fichier. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/hosts</code></pre>
</div>
</div>
</li>
<li>
<p>Changez la ou les lignes, sauvegardez.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Le FQDN (nom de machine avec le nom de domaine) doit Ãªtre dÃ©clarÃ© avant le hostname simple dans le fichier <code>hosts</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Rebootez. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">reboot</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
</ol>
</div>
</li>
<li>
<p>VÃ©rifiez que tout est correctement configurÃ©.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">hostname</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La sortie doit afficher le nom de host.</p>
</div>
</li>
<li>
<p>Tapez ensuite :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">hostname</span> <span class="nt">-f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La sortie doit afficher le nom de host avec le nom de domaine.</p>
</div>
</li>
<li>
<p>Reconfigurez les clÃ©s SSH server si vous avez changÃ© le Hostname. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">rm</span> <span class="nt">-v</span> /etc/ssh/ssh_host_<span class="k">*</span>
dpkg-reconfigure openssh-server</code></pre>
</div>
</div>
</li>
<li>
<p>Les nouvelles clÃ©s vont Ãªtre regÃ©nÃ©rÃ©es.</p>
</li>
<li>
<p>DÃ©connectez vous de votre session SSH et reconnectez vous.</p>
</li>
<li>
<p>Sur votre poste de travail, la clÃ© d&#8217;authentification du serveur aura changÃ©e. il vous faudra annuler l&#8217;ancien puis accepter la nouvelle.</p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh-keygen <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.ssh/known_hosts"</span> <span class="nt">-R</span> <span class="nb">hostname</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer hostname par l&#8217;adresse IP ou le nom de machine</td>
</tr>
</table>
</div>
</li>
<li>
<p><a href="#root_login">Reloguez vous comme root sur le serveur</a></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_interdire_le_login_direct_en_root">5.9. Interdire le login direct en root</h3>
<div class="paragraph">
<p>Il est toujours vivement dÃ©conseillÃ© d&#8217;autoriser la possibilitÃ© de se connecter directement en SSH en tant que root.
De ce fait, notre premiÃ¨re action sera de dÃ©sactiver le login direct en root  et d&#8217;autoriser le sudo.
Respectez bien les Ã©tapes de cette procÃ©dure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ajoutez un utilisateur standard qui sera nommÃ© par la suite en tant que &lt;sudo_username&gt;</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">adduser &lt;sudo_username&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;sudo_username&gt; par votre login</td>
</tr>
</table>
</div>
</li>
<li>
<p>RÃ©pondez aux questions qui vont sont posÃ©es: habituellement le nom complet d&#8217;utilisateur et le mot de passe.</p>
</li>
<li>
<p>Donner les attributs sudo Ã  l&#8217;utilisateur <code>&lt;sudo_username&gt;</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">usermod <span class="nt">-a</span> <span class="nt">-G</span> <span class="nb">sudo</span> &lt;sudo_username&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;sudo_username&gt; par votre login</td>
</tr>
</table>
</div>
</li>
<li>
<p>Dans une autre fenÃªtre, se connecter sur le serveur avec votre nouveau compte <code>&lt;sudo_username&gt;</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh &lt;sudo_username&gt;@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;sudo_username&gt; par votre login et &lt;example.com&gt; par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>une fois loguÃ©, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sudo </span>bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tapez le mot de passe de votre utilisateur. Vous devez avoir accÃ¨s au compte root. Si ce n&#8217;est pas le cas, revÃ©rifiez la procÃ©dure et repassez toutes les Ã©tapes.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Tout pendant que ces premiÃ¨res Ã©tapes ne donnent pas satisfaction ne passez pas Ã  la suite sous peine de perdre la possibilitÃ© dâaccÃ©der Ã  votre serveur.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Il faut maintenant modifier la configuration de sshd.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Editez le fichier <code>/etc/ssh/sshd_config</code>, Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/ssh/sshd_config</code></pre>
</div>
</div>
<div class="paragraph">
<p>il faut rechercher la ligne: <code>PermitRootLogin yes</code> et la remplacer par:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">PermitRootLogin</span> <span class="err">no</span></code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez le serveur ssh. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service sshd restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Faites maintenant l&#8217;essai de vous re-loguer avec le compte root.Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh root@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remplacer ici &lt;example.com&gt; par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Ce ne devrait plus Ãªtre possible: le serveur vous l&#8217;indique par un message <code>Permission denied, please try again.</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_dune_clÃ©_de_connexion_ssh_locale">5.10. CrÃ©ation d&#8217;une clÃ© de connexion ssh locale</h3>
<div class="paragraph">
<p>Pour crÃ©er une clÃ© et la dÃ©ployer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©ez une clÃ© sur votre machine locale (et pas sur le serveur distant!):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ouvrir un terminal</p>
</li>
<li>
<p>CrÃ©er un rÃ©pertoire <code>~/.ssh</code> s&#8217;il n&#8217;existe pas. tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/.ssh
<span class="nb">chmod </span>700 ~/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>Allez dans le rÃ©pertoire. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> ~/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>GÃ©nÃ©rez vous clÃ©s. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh-keygen <span class="nt">-t</span> rsa</code></pre>
</div>
</div>
</li>
<li>
<p>Un ensemble de questions apparaÃ®t. Si un texte vous explique que le fichier existe dÃ©jÃ , arrÃªtez la procÃ©dure. Cela signifie que vous avez dÃ©jÃ  crÃ©Ã© une clÃ© et que vous risquez de perdre la connexion Ã  d&#8217;autres serveurs si vous en gÃ©nÃ©rez une nouvelle. Sinon, appuyez sur EntrÃ©e Ã  chaque fois pour accepter les valeurs par dÃ©faut.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Sur votre PC local afficher la clÃ© Ã  l&#8217;Ã©cran. Elle sera copiÃ©e-collÃ©e par la suite:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cat</span> ~/.ssh/id_rsa.pub</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©ployez votre clÃ©:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Loguez vous sur votre serveur distant. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh &lt;sudo_username&gt;@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;sudo_username&gt; par votre login et &lt;example.com&gt; par votre nom de domaine</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Entrez votre mot de passe</p>
</div>
</li>
<li>
<p>CrÃ©er un rÃ©pertoire <code>~/.ssh</code> s&#8217;il n&#8217;existe pas. tapez: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>Ãditez le fichier <code>~/.ssh/authorized_keys</code> tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi ~/.ssh/authorized_keys</code></pre>
</div>
</div>
<div class="paragraph">
<p>et coller dans ce fichier le texte contenu dans le votre fichier local <code>~/.ssh/id_rsa.pub</code>. Remarque: il peut y avoir dÃ©jÃ  des clÃ©s dans le fichier <code>authorized_keys</code>.</p>
</div>
</li>
<li>
<p>SÃ©curisez votre fichier de clÃ©s. Tapez: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>600 ~/.ssh/authorized_keys</code></pre>
</div>
</div>
</li>
<li>
<p>SÃ©curisez le rÃ©pertoire SSH; Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 ~/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©connectez vous de votre session</p>
</li>
</ol>
</div>
</li>
<li>
<p>VÃ©rifiez que tout fonctionne en vous connectant. Tapez: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh &lt;sudo_username&gt;@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;sudo_username&gt; par votre login et &lt;example.com&gt; par votre nom de domaine</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La session doit s&#8217;ouvrir sans demander de mot de passe.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_sudo_sans_mot_de_passe">5.11. Sudo sans mot de passe</h3>
<div class="paragraph">
<p>Avant tout, il faut bien se rendre compte que cela constitue potentiellement une faille de sÃ©curitÃ© et qu&#8217;en consÃ©quence, le compte possÃ©dant cette propriÃ©tÃ© devra Ãªtre autant sÃ©curisÃ© qu&#8217;un compte root.
LâintÃ©rÃªt Ã©tant d&#8217;interdire le compte root en connexion ssh tout en gardant la facilitÃ© de se loguer root sur le systÃ¨me au travers d&#8217;un super-compte.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ajoutez un groupe sudonp et y affecter un utilisateur. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">addgroup <span class="nt">--system</span> sudonp</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ajouter l&#8217;utilisateur: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">usermod <span class="nt">-a</span> <span class="nt">-G</span> sudonp &lt;sudo_username&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Ãventuellement retirez l&#8217;utilisateur du groupe sudo s&#8217;il a Ã©tÃ© ajoutÃ© auparavant :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">gpasswd <span class="nt">-d</span> &lt;sudo_username&gt; <span class="nb">sudo</span></code></pre>
</div>
</div>
</li>
<li>
<p>Ãditez le fichier sudoers. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/sudoers</code></pre>
</div>
</div>
</li>
<li>
<p>Ajouter dans le fichier la ligne suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">%sudonp</span> <span class="py">ALL</span><span class="p">=</span><span class="s">(ALL:ALL) NOPASSWD: ALL</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;utilisateur nom_d_utilisateur pourra se logger root sans mot de passe au travers de la commande <code>sudo bash</code></p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_du_motd">5.12. Configuration du Motd</h3>
<div class="paragraph">
<p>Le motd est affichÃ© au moment ou l&#8217;utilisateur se loggue en ssh. Nous allons configurer l&#8217;affichage de plusieurs informations importantes.</p>
</div>
<div class="sect3">
<h4 id="_installation_de_neofetch">5.12.1. Installation de Neofetch</h4>
<div class="paragraph">
<p>Neofetch affiche au dÃ©marrage de votre systÃ¨me des informations sur le fonctionnement de celui-ci.</p>
</div>
<div class="paragraph">
<p>Nous allons crÃ©er une configuration systÃ¨me:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez le package neofetch. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>neofetch</code></pre>
</div>
</div>
</li>
<li>
<p>Editez ensuite le fichier <code>/etc/neofetch.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/neofetch.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Mettez ensuite dans le fichier la configuration suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">print_info<span class="o">()</span> <span class="o">{</span>
    info title
    info underline

    info <span class="s2">"OS"</span> distro
    info <span class="s2">"Host"</span> model
    info <span class="s2">"Kernel"</span> kernel
    info <span class="s2">"Uptime"</span> <span class="nb">uptime
    </span>info <span class="s2">"Packages"</span> packages
    info <span class="s2">"Shell"</span> shell
    info <span class="s2">"Resolution"</span> resolution
    info <span class="s2">"DE"</span> de
    info <span class="s2">"WM"</span> wm
    info <span class="s2">"WM Theme"</span> wm_theme
    info <span class="s2">"Theme"</span> theme
    info <span class="s2">"Icons"</span> icons
    info <span class="s2">"Terminal"</span> term
    info <span class="s2">"Terminal Font"</span> term_font
    info <span class="s2">"CPU"</span> cpu
    info <span class="s2">"CPU Usage"</span> cpu_usage
    prin <span class="s2">"CPU Temp"</span> <span class="s2">"</span><span class="si">$(</span>vcgencmd measure_temp | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">'='</span> <span class="s1">'{print $2}'</span><span class="si">)</span><span class="s2">"</span> <i class="conum" data-value="1"></i><b>(1)</b>
    prin <span class="s2">"Load"</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">cat</span> /proc/loadavg | <span class="nb">awk</span> <span class="s1">'{print $1, $2, $3}'</span><span class="si">)</span><span class="s2">"</span>
    info <span class="s2">"GPU"</span> gpu
    info <span class="s2">"GPU Driver"</span> gpu_driver  <span class="c"># Linux/macOS only</span>
    info <span class="s2">"Memory"</span> memory
    info <span class="s2">"Disk"</span> disk
    info <span class="s2">"Local IP"</span> local_ip
    info <span class="s2">"Public IP"</span> public_ip
    info <span class="s2">"Users"</span> <span class="nb">users
    </span>info <span class="s2">"Locale"</span> locale  <span class="c"># This only works on glibc systems.</span>

    info cols
<span class="o">}</span>

<span class="nv">title_fqdn</span><span class="o">=</span><span class="s2">"on"</span>
<span class="nv">memory_percent</span><span class="o">=</span><span class="s2">"on"</span>
<span class="nv">memory_unit</span><span class="o">=</span><span class="s2">"mib"</span>
<span class="nv">package_managers</span><span class="o">=</span><span class="s2">"on"</span>
<span class="nv">image_backend</span><span class="o">=</span><span class="s2">"ascii"</span>
<span class="nv">cpu_temp</span><span class="o">=</span><span class="s2">"on"</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cette ligne est Ã  retirer si vous n&#8217;utilisez pas de Raspberry PI 4</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cette ligne est Ã  mettre pour tout systÃ¨me qui n&#8217;utilise pas de Raspberry PI 4</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_du_motd_avec_neofetch">5.12.2. Configuration du MOTD avec Neofetch</h4>
<div class="paragraph">
<p>Pour afficher les informations au moment du login ssh, vous devez modifier le fichier Motd:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Editez le fichier Neofetch du MOTD</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/update-motd.d/20-neofetch</code></pre>
</div>
</div>
</li>
<li>
<p>Mettez ensuite dans le fichier la configuration suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
neofetch <span class="nt">--config</span> /etc/neofetch.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Changez les permissions du fichier <code>20-neofetch</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>755 /etc/update-motd.d/20-neofetch</code></pre>
</div>
</div>
</li>
<li>
<p>A notez que vous pouvez utiliser Neofetch pour votre fichier <code>.bash_profile</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_mise_Ã _jour_de_packages">5.12.3. Mise Ã  jour de packages</h4>
<div class="paragraph">
<p>Vous pouvez ajouter la liste des mises Ã  jours dans le fichier MOTD:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installez le package python de gestion APT. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>python3-apt</code></pre>
</div>
</div>
</li>
<li>
<p>Editez le fichier MOTD</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/update-motd.d/30-updates</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier mettez le contenu suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="c1">#!/usr/bin/python
</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">apt_pkg</span>

<span class="n">DISTRO</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">"lsb_release"</span><span class="p">,</span> <span class="s">"-c"</span><span class="p">,</span> <span class="s">"-s"</span><span class="p">],</span>
                          <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">).</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="n">strip</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">OpNullProgress</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s">'''apt progress handler which supresses any output.'''</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">is_security_upgrade</span><span class="p">(</span><span class="n">pkg</span><span class="p">):</span>
    <span class="s">'''
    Checks to see if a package comes from a DISTRO-security source.
    '''</span>
    <span class="n">security_package_sources</span> <span class="o">=</span> <span class="p">[(</span><span class="s">"Ubuntu"</span><span class="p">,</span> <span class="s">"%s-security"</span> <span class="o">%</span> <span class="n">DISTRO</span><span class="p">),</span>
                               <span class="p">(</span><span class="s">"Debian"</span><span class="p">,</span> <span class="s">"%s-security"</span> <span class="o">%</span> <span class="n">DISTRO</span><span class="p">)]</span>

    <span class="k">for</span> <span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pkg</span><span class="p">.</span><span class="n">file_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">origin</span><span class="p">,</span> <span class="n">archive</span> <span class="ow">in</span> <span class="n">security_package_sources</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">file</span><span class="p">.</span><span class="n">archive</span> <span class="o">==</span> <span class="n">archive</span> <span class="ow">and</span> <span class="nb">file</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="n">origin</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="c1"># init apt and config
</span><span class="n">apt_pkg</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># open the apt cache
</span><span class="k">try</span><span class="p">:</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">apt_pkg</span><span class="p">.</span><span class="n">Cache</span><span class="p">(</span><span class="n">OpNullProgress</span><span class="p">())</span>
<span class="k">except</span> <span class="nb">SystemError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Error: Opening the cache (%s)"</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># setup a DepCache instance to interact with the repo
</span><span class="n">depcache</span> <span class="o">=</span> <span class="n">apt_pkg</span><span class="p">.</span><span class="n">DepCache</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>

<span class="c1"># take into account apt policies
</span><span class="n">depcache</span><span class="p">.</span><span class="n">read_pinfile</span><span class="p">()</span>

<span class="c1"># initialise it
</span><span class="n">depcache</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># give up if packages are broken
</span><span class="k">if</span> <span class="n">depcache</span><span class="p">.</span><span class="n">broken_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Error: Broken packages exist."</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># mark possible packages
</span><span class="k">try</span><span class="p">:</span>
    <span class="c1"># run distro-upgrade
</span>    <span class="n">depcache</span><span class="p">.</span><span class="n">upgrade</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1"># reset if packages get marked as deleted -&gt; we don't want to break anything
</span>    <span class="k">if</span> <span class="n">depcache</span><span class="p">.</span><span class="n">del_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">depcache</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

    <span class="c1"># then a standard upgrade
</span>    <span class="n">depcache</span><span class="p">.</span><span class="n">upgrade</span><span class="p">()</span>
<span class="k">except</span> <span class="nb">SystemError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Error: Couldn't mark the upgrade (%s)"</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># run around the packages
</span><span class="n">upgrades</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">security_upgrades</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">.</span><span class="n">packages</span><span class="p">:</span>
    <span class="n">candidate</span> <span class="o">=</span> <span class="n">depcache</span><span class="p">.</span><span class="n">get_candidate_ver</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">pkg</span><span class="p">.</span><span class="n">current_ver</span>

    <span class="c1"># skip packages not marked as upgraded/installed
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">depcache</span><span class="p">.</span><span class="n">marked_install</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span> <span class="ow">or</span> <span class="n">depcache</span><span class="p">.</span><span class="n">marked_upgrade</span><span class="p">(</span><span class="n">pkg</span><span class="p">)):</span>
        <span class="k">continue</span>

    <span class="c1"># increment the upgrade counter
</span>    <span class="n">upgrades</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># keep another count for security upgrades
</span>    <span class="k">if</span> <span class="n">is_security_upgrade</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
        <span class="n">security_upgrades</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># double check for security upgrades masked by another package
</span>    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">pkg</span><span class="p">.</span><span class="n">version_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">current</span> <span class="ow">and</span> <span class="n">apt_pkg</span><span class="p">.</span><span class="n">version_compare</span><span class="p">(</span><span class="n">version</span><span class="p">.</span><span class="n">ver_str</span><span class="p">,</span> <span class="n">current</span><span class="p">.</span><span class="n">ver_str</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">is_security_upgrade</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
            <span class="n">security_upgrades</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">break</span>

<span class="k">print</span><span class="p">(</span><span class="s">"%d updates to install."</span> <span class="o">%</span> <span class="n">upgrades</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"%d are security updates."</span> <span class="o">%</span> <span class="n">security_upgrades</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>  <span class="c1"># leave a trailing blank line</span></code></pre>
</div>
</div>
</li>
<li>
<p>Changez les permissions du fichier <code>30-updates</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>755 /etc/update-motd.d/30-updates</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installer_loutil_dselect">5.13. Installer l&#8217;outil dselect</h3>
<div class="paragraph">
<p>L&#8217;outil <code>dselect</code> permet de choisir de faÃ§on interactive les paquets que l&#8217;on souhaite installer.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ajouter le paquet <code>dselect</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>dselect</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="swap_create">5.14. Ajouter un fichier de swap</h3>
<div class="paragraph">
<p>Pour un serveur VPS ou Raspberry Pi de 2 Go de RAM, la taille du fichier de swap sera de 2 Go.
Si vous avez beaucoup d&#8217;outils et de serveurs Ã  installer il peut Ãªtre nÃ©cessaire d&#8217;avoir 4 Go de RAM au total + 2 Go de swap.</p>
</div>
<div class="paragraph">
<p>Enfin pour un Raspberry PI 3 avec 1 Go de Ram, il faut ajouter 1 Go de swap.</p>
</div>
<div class="paragraph">
<p>Tapez :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tout d&#8217;abord, si l&#8217;outil <code>dphys-swapfile</code> est installÃ© et configurÃ© sur la machine, commencez par dÃ©sactiver le swap. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">dphys-swapfile uninstall</code></pre>
</div>
</div>
</li>
<li>
<p>Pour installer un swap de 2Go, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /
fallocate <span class="nt">-l</span> 2G /swapfile
<span class="nb">chmod </span>600 /swapfile
mkswap /swapfile
swapon /swapfile</code></pre>
</div>
</div>
</li>
<li>
<p>Enfin ajoutez une entrÃ©e dans le fichier fstab. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/fstab</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez la ligne:</p>
<div class="listingblock">
<div class="content">
<pre>/swapfile swap swap defaults 0 0</pre>
</div>
</div>
</li>
<li>
<p>Enfin vous pouvez Ãªtre tentÃ© de limiter le swap (surtout utile sur les systÃ¨mes avec peu de RAM et du SSD. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/systctl.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez ou modifiez la ligne:</p>
<div class="listingblock">
<div class="content">
<pre>vm.swappiness = 5</pre>
</div>
</div>
</li>
<li>
<p>Le paramÃ¨tre sera actif au prochain reboot</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_initiale_des_outils">6. Installation initiale des outils</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les chapitres ci aprÃ¨s dÃ©crivent l&#8217;installation des outils de base.</p>
</div>
<div class="sect2">
<h3 id="_supprimer_le_sleep_mode">6.1. Supprimer le sleep mode</h3>
<div class="paragraph">
<p>Pour Ã©viter que le raspberry ne s&#8217;endorme en raisons d&#8217;Ã©vÃ¨nements sleep lancÃ©s par des programmes tiers (souvent du Ã  la gestion d&#8217;Ã©conomie d&#8217;Ã©nergie de XFCE), il est nÃ©cessaire de dÃ©sactiver toute action de sleep.</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure ci-aprÃ¨s:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target</code></pre>
</div>
</div>
</li>
<li>
<p>C&#8217;est fait !</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="xfce">6.2. Configuration de xfce et de l&#8217;environnement graphique</h3>
<div class="paragraph">
<p>Ubuntu est installÃ© avec un environnement graphique par dÃ©faut qui peut Ãªtre considÃ©rÃ© comme lourd pour un petit raspberry PI. vous pouvez installer Ã  la place XFCE.</p>
</div>
<div class="paragraph">
<p>Il vous faut suivre la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installez XFCE.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Pour Ubuntu, tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>xubuntu-desktop
apt remove <span class="nt">--purge</span> ubuntu-desktop
apt autoremove <span class="nt">--purge</span></code></pre>
</div>
</div>
</li>
<li>
<p>Lorsque le systÃ¨me propose un systÃ¨me de login XWindows, choisissez Lightdm.</p>
</li>
<li>
<p>Pour Debian, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>xfce4 atril</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Pour avoir un autologin,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>tapez pour Ubuntu :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/lightdm/lightdm.conf.d/99-autologin.conf</code></pre>
</div>
</div>
</li>
<li>
<p>tapez pour Debian :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/lightdm/lightdm.conf</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Dans le fichier ouvert, chercher <code>Seat</code> et tapez:</p>
<div class="listingblock">
<div class="content">
<pre>[Seat:*]
autologin-user=[autologin account] <i class="conum" data-value="1"></i><b>(1)</b>
autologin-user-timeout=0</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettez ici votre nom de compte en autologin</td>
</tr>
</table>
</div>
</li>
<li>
<p>Rebootez le systÃ¨me en n&#8217;oubliant pas de connecter un clavier et un Ã©cran.</p>
</li>
<li>
<p>le Window manager doit s&#8217;ouvrir logguÃ© automatiquement</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_de_vnc">6.3. Configuration de VNC</h3>
<div class="paragraph">
<p>VNC permet de prendre le contrÃ´le Ã  distance et en mode graphique du raspberry pi.</p>
</div>
<div class="paragraph">
<p>Il peut Ãªtre lancÃ© Ã  la demande ou automatiquement au dÃ©marrage du raspberry pour un utilisateur standard.</p>
</div>
<div class="paragraph">
<p>Si vous ne souhaitez pas dÃ©marrer automatiquement x11vnc, ne crÃ©ez pas le fichier 'vnc server.desktop' dans le rÃ©pertoire autostart.</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez le package VNC. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>x11vnc</code></pre>
</div>
</div>
</li>
<li>
<p>reloguez vous avec le user <code>autologin</code> dÃ©finit dans le chapitre sur la <a href="#xfce">configuration xfce</a></p>
</li>
<li>
<p>Configurez un mot de passe. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">x11vnc <span class="nt">-storepasswd</span> <span class="o">[</span>votre_mot_de_passe] ~/.vnc_passwd <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez [votre mot de passe] par <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a></td>
</tr>
</table>
</div>
</li>
<li>
<p>Changez les droits d&#8217;accÃ¨s du fichiez mot de passe. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>750 ~/.vnc_passwd</code></pre>
</div>
</div>
</li>
<li>
<p>Ensuite Ã©ditez le fichier de configuration de vnc. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi ~/.x11vncrc</code></pre>
</div>
</div>
</li>
<li>
<p>Inserez le texte suivant dans ce fichier:</p>
<div class="listingblock">
<div class="content">
<pre>-bg
-display :0.0
-forever
-shared</pre>
</div>
</div>
</li>
<li>
<p>Ensuite Ã©ditez le fichier de dÃ©marrage automatique. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.config/autostart
vi ~/.config/autostart/vnc<span class="se">\ </span>server.desktop</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant dans ce fichier:</p>
<div class="listingblock">
<div class="content">
<pre>[Desktop Entry]
Encoding=UTF-8
Version=0.9.4
Type=Application
Name=vnc server
Comment=
Exec=/usr/bin/x11vnc
OnlyShowIn=XFCE;
RunHook=0
StartupNotify=false
Terminal=false
Hidden=false</pre>
</div>
</div>
</li>
<li>
<p>Enfin le raspberry PI 4 a des problÃ¨mes de lenteurs lorsque vous ne branchez pas d&#8217;Ã©cran au moment du boot de votre raspberry. C&#8217;est typiquement le cas pour les configurations Headless. Pour corriger cela il faut forcer une rÃ©solution avec une autodÃ©tection de l&#8217;Ã©cran. Il faut modifier la conf de boot.</p>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>pour un Ubuntu:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /boot/firmware/cmdline.txt</code></pre>
</div>
</div>
</li>
<li>
<p>pour une Debian:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /boot/cmdline.txt</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Puis sur la ligne prÃ©sentÃ© Ã  l&#8217;Ã©cran, ajoutez au bout le texte suivant prÃ©cÃ©dÃ© d&#8217;un espace. Vous pouvez changer la rÃ©solution (1024x768) comme vous voulez :</p>
<div class="listingblock">
<div class="content">
<pre>video=HDMI-A-1:1024x768@60D</pre>
</div>
</div>
</li>
<li>
<p>Le driver graphique dÃ©finit par dÃ©faut n&#8217;est pas le bon pour un Raspberry PI . Tapez</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>pour un Ubuntu :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /boot/firmware/config.txt</code></pre>
</div>
</div>
</li>
<li>
<p>pour une Debian :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /boot/config.txt</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Cherchez la ligne <code>dtoverlay=vc4-kms-v3d</code> et replacez la avec :</p>
<div class="listingblock">
<div class="content">
<pre>gpu_mem=128
dtoverlay=vc4-kms-v3d-pi4
hdmi_force_hotplug=1</pre>
</div>
</div>
</li>
<li>
<p>Si la ligne n&#8217;est pas trouvÃ© c&#8217;est que la configuration d&#8217;Ubuntu est plus rÃ©cente. il faut alors rajouter ces lignes directement dans le fichier vers la fin.</p>
</li>
<li>
<p>Enfin il peut Ãªtre utile de changer le mode de dÃ©marrage par dÃ©faut de <code>systemd</code>.</p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl set-default graphical.target</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="hairpinning">6.4. ProcÃ©dure spÃ©cifique pour les serveurs du rÃ©seau local</h3>
<div class="paragraph">
<p>L&#8217;un des problÃ¨mes classiques des Routeurs internet est leur gestion du port forwarding lorsque l&#8217;on est sur un rÃ©seau local.</p>
</div>
<div class="paragraph">
<p>En effet la plupart des routeurs ne supportent pas un fonctionnalitÃ© appelÃ©e <code>NAT loopback</code> ou <code>Hairpinning</code>.</p>
</div>
<div class="paragraph">
<p>Le schÃ©ma ci dessous montre bien la problÃ©matique rencontrÃ©e sur un rÃ©seau local lorsque l&#8217;on utilise l&#8217;adresse DNS:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABC4AAAD8CAIAAAA39HLGAABSsUlEQVR4Xu3dC1hU1703/j2A3EEBUUJERFFz0YCozRGNt9B/ek5jXnJRa1KD+jbpyWkbT582zTGP0TZpkibG06SNTUzyV2PVYEyNaY0xoZgqNIh4N2q8BkRFVCgICMol749ZslisvWfNAAOzN/P9POvx2euy1177MrPXT2bPaN8CAAAAAAB0O00uAAAAAAAA6HoIRQAAAAAAwANaQ5EmAAAAAACALoZQBAAAAAAAPAChCAAAAAAAeABCEQAAAAAA8ACEIgAAAAAA4AEIRQAAAAAAwAMQigAAAAAAgAcgFAEAAAAAAA9AKAIAAAAAAB6AUAQAAAAAADwAoQgAAAAAAHgAQhEAAAAAAPAAhCIAAAAAAOABCEUAAAAAAMADEIoAAAAAAIAHIBQBAAAAAAAPQCgCAAAAAAAegFAEAAAAAAA8AKEIAAAAAAB4AEIRAAAAAADwAIQiAAAAAADgAQhFAAAAAADAAxCKAAAAAACAByAUAQAAAAAAD0AoAgAAAAAAHoBQBMDrrF+/XtO0+fPnyxUAAJ3w5JNP0nsLvcPIFQAADiAUAWvQ7OTSnqvr9re0tDQ6Ojo9Pb2hoUGu85x27W+7GgNnieMmDZJlObp077rrro8++khYw23YJuTSFmKtuqU3o3cVem+h00TvM3Kda9ixtdlsgYGBMTExqampixcvPnv2rL5NcnLy9evX9eU8u2nTpokTJ9JgfH19Q0ND4+Li7rzzTqE5AJgCQhGwBm+793fd/j700EPf+c53ampq5AqPatf+tqsxcJY4btIgxWxtbW1ubu6IESOo5E9/+hNv4y7q4yPWqlt6uerqanqHmT59ulzhGn5sKcw4c+bMihUrEhISevfuTXGF1Ib87ne/a12z7Xl58803afk3v/nNpUuXqqqq9u/f//vf/z4pKUlsDwBmgFAErEG8x3gDb9vfdsHB6RhLHDdpkPox5+fnU8mQIUPEQrfQb0ukrgV30R/ny5cv0+kOCAg4ePCg2KZ///7BwcGnTp3iLcV1ExMTabmiooLXAoA5IRQBj1m7di27c9A9ZtiwYQsXLqyrq+O17733Ht1+6E6TkpKyatUq8R7Dlmtra+fPnx8dHe3j48PKd+zYkZaWFhYWFh4enpqaunnzZt5bcXFxRkbGgAEDaFsJCQkPP/zw9u3bnVY1ORvkn//8Z0eDbFKOR8/p/oqN9SUcq3LXwVGv2KQ8PvpB6ks4sYotb9iwYeLEiREREZGRkdOmTeMTDlbL8R4U42QtpWPCCh1tRd2haNSoUawfXvLBBx9QCZ1HllX0Yzgw9emQKI5/kwsXlbuuE0VVk7JPPXGQ+myT/T/dqaRXr15iIcfa087SLtOO0+6vXr1aqhWaG1x4rqwr9eP0OPOW+pJ2HRxFY9at4nqWqK8cmvTPnDkzJiaGakePHi1+Ik5RpRie+goR6Y8YWbNmDRU+8sgjLMvavP/++/TvPffcw5uJ69LpoGU6CJ9++mlZWRlvAwBmg1AEPObpp5/esmVLVVVVRUXFK6+8QreNBQsWsKrPP/+csuPHjy+0owXxHsOWlyxZsnfv3vr6ela4bds2Pz8/ug2fOHGCbjyzZ8/W7LMKVjtp0iTKbty4saam5vjx4ytWrBg7dqzTqiblILOzsyk7bty4b+zuvPNOcZDq8Uic7q/NZhPbi7USVuWug6NesUl5fDowbHE5KSmJdqGysvK5556jLA3SsDGjHidrLx0T9VbUHYr++Mc/UtW9997LS77//e9TyRtvvNHkrB/DgSlOh57i+Du9qPSbVo9WMTBFlbpPPXGQ+izZuXOn5vivIqw9e1UWFRWxvaaXKq9VXJNO15VasmWnx1mxxXYdHHVj1q2j61lPceXk5+cHBQXFxcVlZWVduXJlz549FDk4rVIPT3GFSMTjw5WUlFDhTTfdxLK8DUUatPDnP/9ZKie//e1vWZa5+eabKZKhQbJaADAPhCJgCtevX6e7xeDBg1l28uTJlP3nP//Jsrm5uex2wrJsuaCggGUZugVS4YEDB1j2woULlB02bBjLhoSEUHb79u2NjY2t6zirkkiDnDJlCmVzcnJYlnoQB6kej8Tp/vr6+ra2dnC3ZliVuw6OekWJdHw6MGxxOS8vj2VpxqPZ/+/WsDGjHidrLx0T9VbUHYrKy8sDAwNpEkazpSb7nImWabpG5U3O+jEcmOJ0qJnzRaTuU08cpJStra2l3WHPiixbtoy3EbH2tLMsy/aaXqq8VnFNOl1XasmWnR5nxRbbdXDUjVm3jq5nNenKufvuuylr+N0Aiir18BRXiITtiFR47do1TfhTGG9TXFwcHh4eHR19+fJlsZz59NNP6fTR8Wflmj0sfPvtt3kDADADhCLgGaWlpXPmzBkwYADN2/h9gn9KJDIykrJ0N2XZyspK1oBl2TLdnFiWYX+Ol/BJwIQJE1gJNUtOTp4/fz7/ShZFVWcGqR6PRN2VfkWxVsKq3HVw1Cuqj4/YkpdoymGLy/zjIjR3kVbU96MeJ8tKx4QVOtqKukPJI488QrWvvvoqLS9ZsoSWf/jDH7IqdT8sKw1McTok6uPv9KLSdJtWj1YxMEWVuk891kDKcn379lV/gxZrJu11VFQUr1Vck07XlVqyZafHWbHFdh0cdWOWdXQ9S9RXDtuQ4YeanFZJXLl4JKyZVHj+/HnN6K8ihIJSWp47d65UztXU1FB8uGjRotDQUM3x39MAwFMQioBn3HPPPZr9IwEXL15ssv9/p3gXke7u7H/4eK3h/YbdCB19g2RRURHdq+Li4ti6hG6NTqvaNUjDUMTReCRO95fPEgjNNsRaiWGVejCKI6BeUX18tI4OW99MKtE3UI9T396wUCxRdyhhH9UbOXIkLdO/tPzFF1+wKnU/+jE0KU+HRH38nV5UfJlTj1YxMEWVuk89trqjrFOsvbTXYjihuCadriu1ZMtOj7Nii+06OOrGYreOSjj1lcM2xP6sJ3Fa5Wh4iitEIo6EW716NRXyD4OJbSjoouiUstu2bTNcl/vb3/6mufyXIgDoNghFwDPCwsI04f5NUzfxLsI+WKz4zIP+fsM+JiE+PWyooqJi3bp11DIkJMRplXqQ7ANa/BMR0ge0XBwPo95ff39/Wq6urmZZ9ll5XisxrHJxMPojoF5RfXw6PGx9M6nEZrNJDdTj1HdoWCiWqDuU0GRoyJAh1H758uX0b2JiIv8Uirof/RhE+tMhUR9/9UVluGn1aDnFwPRVLvbJSQMzHKcCa+/oQ1bqa1K9rr4lW1YfZ/UW23Vw1I3Fbh2VcOorZ+rUqbQsfnkup6hSD4/TXyES/bAdfYMWb3D06FH28L1+XRGLEocOHSpXAIBHIRQBz2CfOV66dCndpOn2TLcH8S6ydetWTfkkqP5+k5OTQ3f9hIQEig2ozyNHjtC8cMyYMax23LhxmZmZp0+frqur++STT2j1tLQ0p1XqQbL/C6eJSFFRkf6xdfV4JOr9ZR/CfuGFF+hWun//fvaVTbxWYlilHoziCKhXVB+fDg9b30wqiY2Npezhw4d5iXqc+g4NC8USdYd67BnZoKAg+vfFF1/k5ep+9GNoUp4Oifr4qy8qw02rR6sYmKJK3aeeNDDDcSqw9myv+aPnWVlZrFZ9TarX1bdky+rjrN5iuw6OurHYraMSTn3lUP+BgYHx8fH0FldVVbVv376HHnrIaZV6eIorRMJHUl9fX1xczH9XRPxUnn7Xnn/+eVbIy4cPH/6rX/3q73//+6lTp2pray9evLh48WKqfeutt8QVAcDjEIqAZ5w7d27GjBmRkZEBAQHJycnsuxrFuwvdgQYPHkxzu6SkpJUrV4q1Uktu165d6enpUVFRdEdMTEzMyMjIz89nVV9++eWsWbPoDkqbi4uLmzdvHnvIWF3ldJDsy3zZINn/iIuf81aMR0+xv3QrnTZtGg2D7sepqansu2INj0CTuw+OekX18enwsPXNpBI6Vv3795cKFePUd2hY6HqHenQofO1Px9K/tCxWKfrRj6HJ2ekQqY9/k/KiMtx0k3K0ioEpqtR96kkDczROR1h72lnaZdpxmsWKX0ilvibV6+pb8irFcVZvsamdB0fRWOrWsIRzeuVQ1DR9+vR+/fpRg5SUFDEMUFQphqe+QkRsJDabjVqqf21dLLl27dodd9whlj/wwAN0OqKjo+m8+Pj4RERETJkyhY6/uBYAmAFCEQD3OHjwIN0Fhw8fLlcAQHfRT1K7nxnGAABgFQhFADruP/7jP3Jzc6uqqo4ePco+Ku3oNwEAoBuYIQwwwxgAAKwCoQhAx23evDk1NTU4ODg8PHzSpEkbN26UWwBANzJDGGCGMQAAWAVCEQAAAAAA8ACEIgAAAAAA4AEIRQAAAAAAwAMQigAAAAAAgAcgFAEAAAAAAA9AKAIAAAAAAB6AUMRLLV68mH3jJENZ1KIWtahFLWoVtWIWAMAtEIoAAACAExp+LAUAugBCEQAAAHACoQgAdAWEIgAAAOAEQhEA6AoIRQAAAMAJhCIA0BUQigAAAIATeGwdALoCQhEAAAAAAPAAhCIAAAAAAOABCEUAAAAAAMADEIoAAAAAAIAHIBQBAAAAJ/DYOgB0BYQiAAAA4AS+zBcAugJCEQAAAHACoQgAdAWEIgAAAOAEQhEA6AoIRQAAAMAJhCIA0BUQigAAAIATeGwdALoCQhEAAAAAAPAAhCIAAAAAAOABCEUAAAAAAMADEIoAAAAAAIAHIBQBAAAAJ/DYOgB0BYQiAAAAILvjjjs0B6hKbg0A0CEIRQAAAED2u9/9Tg5BWlCV3NqU2GjlUnAAhws8AqEIAAAAyIqKinx8fFrjjxZUSFVya1NiA5ZLwQEcLvAIhCIAAABgYPLkyTwC4ahQbmdWbMByKTiAwwUegVAEAAAADLz99tutIUgLKpTbmRUb8IYNGyZOnBgREREZGTlt2rRTp07xBlu3bp0wYUJwcHBQUND48eMpK627Zs2a22+/PSAgYOTIkZs3b37++edjY2OpPa311Vdf8cY7duxIS0sLCwsLDw9PTU2llrxKz1HjuXPn0hZHjx7d0NBAWfp31KhRVDJv3jzWYOnSpZr9r1IxMTGPPfZYZWUlK3d9qKzlqlWrUlJSqGrIkCGrV69mVbyWZx2N09DBgwdnzpxJA6MB0C589NFHvMpdBxl6KoQiAAAAYKC8vJwmiGy+yFCWCuV2ZsXGnJSUtHfvXpq4P/fcc5SdNGkSq6U5MU3rx40b98033xQWFtICZflEma2bnp5+6dKlzMxMln3ggQcuX768bt06Wqb2rOW2bdv8/Pwo2jlx4kRZWdns2bM1+3Sf1UoUjWtqathXBSxfvpyyb7zxBhv81atX2bqLFy+mqTll3333Xar6yU9+wspdHyqrYrtcVFREgQFls7OzxVq2rBinXn5+PoUZcXFxWVlZV65c2bNnz8MPP8yq3HWQoQdDKAIAAADGaF7IJoh8mii3MDE25ry8PJalaESzR1Msyybiubm5LJuTk0PZCRMmiOseOXKkyR4kiNnr16/bbDZ/f3/WkubrVHXgwAGWvXDhAmWHDRvGshJ142PHjoWHh/ft25cWIiIievfuffz48daVW9TX19NaAwcOZFnXh8qq+C7TAmWnTJki1rJl9Tgld999N9WKfwnh3HWQoQdDKAIAAADGPvzwQzZBZCgrtzAxNua6ujqWbWxsZCUsGxQURMtXrlxhWRaoUKG4Lk2Ixey1a9fELFsODg5mWZGvry+rlThtvH79eiqhOERre7RPnz49ffr0mJgY/l0CtMCqWNaVobJlaZejoqL0LZ2OU8Qal5WVyRXuO8jQgyEUAQAAAGO1tbVsWqzZ58eUlVuYmH4uK5ZIs2RaoCzNqvUt1Vk2ES8tLeW1Ck4bL1myhBrExsbSvy+//DIvv+uuu6jkD3/4A50CmqyLAxCX1Vm2LO2yIhRRjFPEGht+cs9dBxl6MIQiAAAA4NCPfvQjNimkBbnO3PRzWbFE+uwQ+7SS9NkhtqzOsu8Z27BhA68VSSuqGxcUFPj7+8fExBQXF1M00qtXr127drGqkJAQWrGmpoaW9+3bJ3YrbUKRZcuufEBLPU6xJZk6dSplN23aJDS5wV0HGXowhCIAAADg0LZt29ikkBbkOnPTz2XFEvZENc2VCwsL2TPc+ieqDVeUsjk5ORQ/JCQk5OXlVVdXHzlyZPny5WPGjNG3VDe+cuVKYmIiNX7vvfcou2bNGlqmEvZNWf/2b/+m2b9sqrS09Lvf/a7YrbQJRZYti7tM2aysLH1LxTilloTaBAYGxsfHZ2dnV1VVUaT00EMPsSp3HWTowRCKAAAAgEONjY1xdrQg15mbfi4rlbDvmQ2yS01N/fTTTx21VGd37dqVnp4eFRVF03cKHjIyMvLz8w1bKhr/8Ic/1IS/GDS1fCiLymn58OHDNMKAgICBAwcuW7ZM7FbahCLLlleuXJmUlES7TJGG+KVY0oqOxqlvSfbv3z99+vR+/frRCFNSUvRf5tv5gww9FUIRAAAAUHnaTi4Fq8HkHkwIoQgAAACoHLCTS8FqEIqACSEUAQAAAOj5EIqACSEUAQ/46quvFi9efPvttzt6W2QfLe3du3dERMSMGTMKCwt51d69e3/2s58NHTrU39+/f//+U6ZM2bx5s7CqzOm2qqqqnn766fj4+KCgoLFjx3788ce8qra29qWXXhoxYkR4eHhYWBgtUFbxXZbqbbV35Fx9fX1aWtpTTz0ldsuWJW3XA8tTX1FNeKXYqduzTUiEtW8wfJUBdIb6yiTHjx+/7777wuxo4eTJk2KtRP2qaWpnbzt37szIyGBjo5ctvaJfeeUV/vseeq0vHoHcCKBDEIqAB9x22230lkpvrIZvZ+vWraNCeic9b0cLAwcO5F9YnpSUtHTp0v3799PEiN552ReJvPnmm237aKXeFs0/Jk6cSDO5DRs2VFRUFBQU0HyO186dO5dWefTRRy9cuHDx4sU5c+ZQlgqFDtpQb6u9I+doekSTJPbzurxbw01AD6O+ovBKYdTtDTehZ/gqA+gM9ZV56dKl2NhYigGK7UaPHj1gwADDXwlk1K+a9vZGLVeuXPn1119fvXr16NGj//7v/059PvbYY3K7FoYbBXALhCLgSYbvbux/fY4dO8aytEDZRYsWtWnUoqioiGoHDRokV+gYbuudd96hwiVLlkjlTGhoKNXS1IplaYGyVNi2lQHDbUlcHHlmZmZCQgLdZpraduvKJqDHMDzdeKUYktq7sglHrzIAN5KuzGeffZay/K+LGzdupCwFG60rOGB4iXa4N+bcuXPUPiQkRK5oYbhRALdAKAKeZPju1qtXLyrkn+6gBcqOGjWqbasbSktLqdbf31+u0DHcFvthJj6Zk0RGRmq6CRb/YVoFw21JXBn5gQMHoqOj9+7dy7Jit65sAnoMw9ONV4ohqb3TTSheZQBuJF2ZKSkplC0uLmZZFqjwH+5QMLxEO9wbw0KRvn37yhUtDDcK4BYIRcCTDN/d4uLiqPD48eMsy/6vNywsrG2rG375y19S7YgRI+QKHcNt0WyJCidOnEhzqZCQEHo3X7t2La9lHxyfM2fORTv2sZMFCxYIHRgz3JbE6cjLysqGDBmyZs0aXiJ2y5bpsPjbf4XqwQcfzMvL4y2hhzG8ovBKMSS1Z5tw9EpRv8oA3Ei6MumapGxdXR3LXr16lbLh4eGtKzhgeIl2uLfr169//fXX9913H7V/5pln5OoWbKOOXkcAnYFQBDzJ8C116dKlVHj//feX2KWnp1PWz89PasZbkvfff1+u0zHclq+vLxXSJmhD58+fZ9t67bXXWC29m6emprIVmfHjxysexuUMtyVyZeTf+973fv7zn4slYrd33XUXzZ9OnDhRVVX1xRdfDB8+3GazrV+/XmwPPYbhFYVXip6+vfqVon6VAbiL/sr08fGhLP/VyIaGBsrSC611HQcML9GO9ca6Ym677bbLly/LLVqoX0cAnWGxUMTfP1x85YAJufKpDI6tIpc2Na1evXrUqFHBwcG9e/dmPzcbHR0ttXnllVeonN4NX3/9danKkOG22Gfcpf9Xjo+PZ9knnnhCs/9fb2lpKf+/XipsXd8Bw21xLo58ypQp9fX1Yomi29zcXKq65ZZb5AroERyderxSRK60l14p7XqVSaKi/Fhj8ELtutMZXpns7xg8Ynf97xhsAFJhh3u7du3awYMH77nnHmo/ffp0udoBt99x9u/fP2vWrNjY2BvHF1xDR4yOGx09+YBaisVCEa35pZKFZOZE56iioqKqqoreCuk9rqGhQT6LAvZakkvbOnz4MLVJS0sTC1966SXN/s7+zjvviOUKhttKTk7WdJ+255/lpemdpvsEPBWyrILhthjXR846cURqTAdca8/n6cFaDE+6xGtfKYyL7aVXChuAI21XlVGDb78djeSdSXP5TufoymRPd5w5c4ZlCwsLNdee7jC8ODvcG1NcXKy59lUTjHvvOFu2bImIiKCA7fTp03wuCq6gI0bHjY7eX/7yl5qamrq6uvr6ev7HMavgu4NQBMk9ic5RUVFRSUlJWVkZvVvRe7R8FgWGb6mSF154gdqsWLGClzz//PNU4uPjIxYyig4Nq5555hlN93+9I0eOZNnw8Oa/wjmaYBl2yDiq6tjIOUWb/Px8qho+fLhcAT2C4tRz3vxKUbSXOH2lGPZvSEMo4sVJc+1Op7gyFy5cqAnfeUVTSU34zivFdWhY1eHemLNnz2rCY+tO2zt9HbmuvLy8X79+WVlZfBYK7UVHj84dvS3Twayurqar0VrRCN8RhCJI7kl0jg4dOnTixAl6a6P36KtXr8pnUeDo/e6+++7bvXt3RUVFZmZmaGjo1KlT+f85/frXv9bsH4FdvXp125WaOeqwyUEV+y526dP2/POvjz/+uCY8jMt+POHHP/4xqzXskDGs6vDIObHN6NGj33rrrSNHjtTU1BQUFCQlJdlsNhc/Tw+W4+jywCulyVn79r5S9P07oiEU8eKkuXCnU1+Z9EqJiYkZO3bsWTu6UOklxp/WUFyHhlXt7e3OO++kUdH4aeRfffUV+4AWDdhR+/a+jly3bNmyBx98kE9BoWPuvfdeijzPnDlD79UUGyt+rdKE+F4gFEFyT6JzlJubu3//fnqPoykLvSTks2jH3ulEYu3GjRvpjS8wMDA+Pn7BggUU5fMqebUWYi1vLBaKxNqTJ08+8MADve0mTJjw+eef86q6urqXX3555MiR7PdrR4wYQVn+FSX6rnihSFHFiLW8sSGxTV5e3uzZsxMTE+koxcXF0ZSUDnvb5tATtF4oLcRavFKctm/vK0VcV01DKOLFSXPhTidejSLe4NixYzSDDLWbNm0a/6sjX5dnxUKRWNuu3nJycigAoFeEn59fVFTU1KlT1d8j197XketoqJmZmXwKCh2zcuXKu+666/Dhw4WFhRSNUMSo+NCg2fC9QCiC5J5E52jLli30JnXo0KGioqKKigr5LAIAWJ+GUMSLE+507jJ48GCKmvgUFDqGgpCbbrqJIkZaKC4upgvSQn8Y4XuBUATJPUmzf1nh1q1bd+3adeLEibKyMvksAgBYH0IRb06407lLWFhYVVUVn4JCx1RWVgYFBfEL8uLFi658nbpJ8L1AKILknoQ3aADwBghFvDnhTucuPj4+TcJkFDqGjqHNZtu0adOOHTsOHTp07ty5mpoa+VibFd+LnhyKsP1yvbz708sv7z9ypLyy8lpjY1NtbcPly7XHj1fom1ki4Q0aALxBd4YimqBXL1tiYsCzz950/XqKvmXHEutZX951SdwjkVirXzZP0nCncxP7yXWDluvEVe1t3xXcOwbq6sMPP8zOzt63b19hYeGVK1fkY21WrbvAl+QmZqL1xFDk7beP0DAyM0/Om/ePH/5w2y9/mbdy5TG6ivQtLZHwBg0A3sA+h5BnqF2UWqYso5uaRp8+PeLee5t/yIWiEX3LjiXef7cl9RbFWnVLTyUNdzo3sZ9cN2i5TlzV3vZdwb1j0OzfapiVlbV79+7Tp0//61//ko+1WbXuAl+Sm5iJ1hNDkZKSGhrGo49+oa+yYsIbNAB4A/scQp6hdlFqmbLcyJ44MYKyQ4YE6Ft2LEn9d0NyfYuut+zOpOFO5yb2k+sGLdeJq9rbviu4dwzUVWZm5meffVZQUHDy5Mny8nL5WJtV6y7wJbmJmWhdGYr89rd7jx79V11dw7VrjV9//S/K6hu//vqhM2eqr19vLCqqevHFfe+/Tye7jlahFX/+8y/F9s8+W3DwYNnVqw1Xr9Z//XUFNZa2zhOtTj3v3n2Rtjhnzj/0DdS9sYE9/HD2J58UVVY2/8rS6dNXqOTVVw/wNkuXHvi2+Vc5b/ylpV29SSNxmvAGDQDewD6HkGeoXZRapiw3snV1zT+tHRBgE9t89tnQCRNCg4N9goJ8xo8Ppayj1aUStszxNjk5w9PSwsPCfMPDfVNTQz/5JNFwdX0JW6ZBzp/fLzraz8fH4EDpe3BUy5bfe29QSkow7R0FYH/+c4LUUr8txeDdkjTc6dzEfqLdoOWaaZP98MMPJ06cGBERERkZOW3aNP5r7qyW42vl5OSkpaWFhYWFh4enpqZ+8sknvIq1pAnf/Pnzo6OjfXx8eKGjrbjSIcfLO0yzX5MUitA1SaGIha7J1l3gS3ITM9G6LBShMKCp+Wu5K/7rv3KeeCKHFigrRiOs8a5dF+fN+8f//u9Blt25s3Tu3H+89lpzllbhjX/9690NDU1HjpT/9Ke5FF1s336eGrzxxlf6MVBat+4k640pK6vbsaOEenCxN7bW6tXHn3pq58yZf6eSd9/9+tvm2OYS72HPnktU8u67RzvQW3sTezHgDRoAejb77EGeoXZRapms3MgeP978V5FBg/x5CQUeNAsfNy6ksHBkUdFIWqAsj0aosc3mMHLQZyl98cUwPz/bxImhJ0+OKC9Pnj07SrPHA650yJZffXXAvn23NjQYP9Ci36KjWrbMdu3MmZEUZVF227ZhYq20LfXg3ZI03OncxH6i3aDlmmmTTUpK2rdv35UrV9jP3k+aNMlRe/LFF1/4+flRUMH+pDB79mz7ZfOe2P7VV1+lDhsamv8HmRc62oq6Q746z3aShlCke2idCEUcYW2+/vpftLxw4S6WXbiwgLJHj/5L6uS//7v5Tx+PPJItZn/wg7/Tcn19I29ME30q+cUv8lj2Rz/aTtnz52t4AylRzPPVV+WNja3ng07NW28dcaU31v7pp/N5b3PmfHH9eiPFG9SStafla9caqbwDvbU3sRcD3qABoGezzyHkGWoXpZYpS/OzIt98M5I9K7JoUeuzImyC/s9/DmfZ3NzhlJ0wIZSv7uvb5k8ovEPDLCWax1PJwYO3sWxpaRJlhw0LdKVDtrx7961iAymxNnqOeuO7RguUnTIlTKyVtqUevFuShjudm9hPtBuwK0HK7ty5k2Wrqqq05j8kBkgNeJZQzKA1XzY3/q+5tLRUa75shrEsa7979+7WFZxtRd3ht0Zj6AzNstdk6y7wJbmJmWidCEXU5TRTp+XZs7ex7KOPbqMsFUqNKepQZHlj9pkrCUUavIFhogiHYqENG07V1javfuHCVVd6Y1k+EpZ27CihwvfeO0bLq1c3/3jQjh3nO9xbu5L6xTB06FD22gPoAWw2m1wEPQi9X4lvXxKt20MREU2sxW/QCgryocKqqlEse+VKMmWpkK+uiBz0WUrBwc0dSngn4rK+B7as/oIvsb0+6XuTdi0qyk+slbalHrxbkoY7nctceB25AduWlL127RrLsg3pG/AsCQ4OZoUiX19fsf3169fFVViho62oO+Sr82wnacpr0sxad4EvyU3MROuuUIQWKEuzdsPGTrNsuv9//2/zHyU6kF56aR+tfv36jUBI3Zu0aZZ+/evmwL2oqIqW6V9aXrz4xie+OtBbu5J1XwwA7UVXu1wEXsM+h5BnqF2UWqYszU+J7Nlz69ixIZT9619bn3+QQhFaoCzNyPnq4gMb1641P2oijl/Kftsym794MUksFNsrOtT3pk/qNvrepF2TQhFpdfXg3ZI03OncxH763KDlSjDO6kv0DVjkcPHiRbGQ07c3LBRL1B1+a7R6Z2iWvSZbd4EvyU3MROuyUET3Aa1d3xp9QMvF7FdfNX8ISnxwvF2JBUL8Q1Pq3qRNszRjRtaFC1ep/K23mr8puKSkhko63Fu7knVfDADtpSEU8WL2OYQ8Q+2i1DJluZE9f/4Of39bauqNz199q/uAFvsUE/+AFjWmbE3Njdl8fv4tUofsz3s8S2ny5DCt+XncwWIhT+oOpc4Nk7qNvjf1B7Sk1dWDd0vScKdzE/vpc4OWK8E4qy9hf9MW6r+dPHmyZn8GXSzk9B0aFool6g6/NRpDZ2iWvSZbd4EvyU3MROuyUIQ9tk4ByRNP5Pznf+bQQpPRY+suZhcuLKivbywtvfrMM7t++MNt//3fX1JIcPJkJW8gpnPnajZtKvzNb/b85Ce5Dz+cPW/ePz744BT1tnz5jWdF1L1Jm+aJPQ3P/tqzdu0JXt6x3lxP1n0xALSXhlDEi9nnEPIMtYtSy/ymteT++/tQyd//fuPpbfbYOgUkRUU3nu0WH1tnz068+OLNVVWjDhy4bdSoG58b4b3Fxvai7JEjt/OS3NzhFG8kJATs3HkLhRxHj97+9tvxY8YEu9KhfrT6pG6j703cNU3YccN+1IN3S9Jwp3MT++lzg5YrwTirL4mNjdWar/nm/65lcnNz/f39ExISdu7cWVNTc/To0bfffnvMmDGsVt+hYaFYou7wW6MxdIZm2WuydRf4ktzETLQuC0Wmt3yZL83d7V/mW2H4Zb4uZin9z//k79p18cqV6zTvLymp+cc/zlOJ2ICnnTtLCwuvVFZeo+3SPlZXX//qq/KlS9v81ULRm37TLD3++A72HDz9S8ud7M31ZN0XA0B7aQhFvJh9wiHPULsotcxvWks2bRpCJRQS8BL2Zb5BQc1f5puaGrp1a+uX+Z4+PWLatN6RkX69ezd/s+2GDYOlDleuHNS/f3M0IhYWFNyant4nKsqPpvWJiQEZGVG7dt3iSodSP4ZJ3Ubf26pVg5KSgmjXKMAQvwvLUT+KwbslabjTuYn99LlBy5VgnNWXrFy5sn///lJhQUFBenp6VFQUhRCJiYkZGRl0flmVvkPDQtc7/NbBGDpMs+w12boLfEluYiZah0IRpO5M1n0xALSXhlDEi9lnD/IMFclLEu507uKWWTh8i1Ck2yAUMX+y7osBoL0QingzhCLenHCncxeEIu5i3WuydRf4ktzETBCKmD9Z98UA0F4IRbwZQhFvTrjTuQtCEXex7jXZugt8SW5iJghFzJ+s+2IAaC+EIt4MoYg3J9zp3AWhiLtY95ps3QW+JDcxE4Qi5k/WfTEAtBdCEW+GUMSbE+507oJQxF2se0227gJfkpuYCUIR8yfrvhgA2guhiDdDKOLNCXc6d0Eo4i7WvSZbd4EvyU3MBKGI+ZN1XwwA7YVQxJshFPHmhDuduyAUcRfrXpOtu8CX5CZmglDE/Mm6LwaA9kIo4s0Qinhzwp3OXRCKuIt1r8nWXeBLchMzQShi/mTdFwNAeyEU8WYIRbw54U7nLghF3MW612TrLvAluYmZIBQxf+q6F8PixYs1AWXdVQvQMRpCES+mIRTx4qR12Z3O29hfR+AG1r0mW3eBL8lNzERDKGL6ZN0XA0B7IRTxZghFvDnhTucuCEXcxbrXZOsu8CW5iZkgFDF/styL4eTJk5WVlXIpgAsQingzhCLenCx3pzMthCLuYt1rsnUX+JLcxEwQipg/We7F8IMf/GDZsmVyKYALEIp4M4Qi3pwsd6czLYQi7mLda7J1F/iS3MRMEIqYP1nuxfDBBx9MmzZNLgVwAUIRb4ZQxJuT5e50poVQxF2se0227gJfkpuYCUIR8yfLvRhokIMHD5ZLAVyAUMSbIRTx5mS5O51pIRRxF+tek627wJfkJmaCUMT8yXIvhurq6pCQELkUwAUIRbwZQhFvTpa705kWQhF3se412boLfEluYiYIRcyfLPdiaGxsnDJlilzqIU8++SQdwPXr18sVYEoIRbwZQhFvTpa705mWj49PkzAZhY5paGiw2WwWvSb5XiAUQXJPwht0Z9C7SXp6enR0dGlpqVzXI2h2cqll9aR9gfZCKOLNCXc6dwkLC6uqquJTUOiYS5cuBQYG0jX52Wef0TV58uRJC12TfC8QiiC5J+ENupOqq6u/853vTJ8+Xa7oERCKQI+BUMSbE+507jJ48ODjx4/zKSh0zJdfftm3b1+EIt0BoYj5E96gQQGhCPQYCEW8OeFO5y7Tpk3LzMzkU1DomN/97ncjR46kI0mhSEFBAYUi5eXl8rE2K74XCEWQ3JO85A167dq1bFYdEBAwbNiwhQsX1tXV8dqDBw/OnDkzJiaGakePHv3RRx+5UrVjx460tLSwsLDw8PDU1NTNmzfzquLi4oyMjAEDBtBaCQkJDz/88Pbt23mtRLEJOi8TJkwIDg4OCgoaP348ZXkV253a2tr58+dHR0ezz+8aFjYph9rkeACsN05cRaTonK24YcOGiRMnRkREREZG0m3s1KlTwtrdSrEX0ONpCEW8OGnecafrBm+88caDDz7Ip6DQAXQYv/Od78yaNWv9+vVZWVm7d+8+ffr0v/71L/lYmxXfEYQiSO5JVnyD3rZtm1zkzNNPP71ly5aqqqqKiopXXnmF9nrBggWsKj8/nyb6cXFx9I5w5cqVPXv2UOTgtIrG4OfnRzNsdtBmz55Nfa5atYrVTpo0ibIbN26sqak5fvz4ihUrxo4dy6okik3QSaFYYty4cd98801hYSEtUJZHI2yWv2TJkr1799bX1ysK1UNVDIB3yLN66s7Z6klJSTSeysrK5557jrJ0cNr20X3U+wI9m4ZQxIuTZsE7nTmVl5dHR0fT/YLPQqG9li1bFhYW9tprr3344YfZ2dn79u2jWzzdf+VjbVZ8RxCKILknWfENupMTyuvXr1MP/MdJ7r77bsqKf4vgFFU0+aaqAwcOsOyFCxcoO2zYMJYNCQmh7Pbt2xsbG1vXMaLYxPjx46kqNzeXZXNycig7YcIEltXsCgoKWldwUKgeqmIATS6EIurO2ep5eXksS2+1mv0PUyzb/dT7Aj2bhlDEi5NmwTudadH9ok+fPi+88AIdST4XBado7pGfn//YY48FBwf/9Kc/Xbly5aZNm3bs2HHo0KFz587V1NTIB9qs+B5ZIxSJiopicxEwLZo0W+4NWmvnhLK0tHTOnDkDBgzw8/PjO84/vERvCpQ13HGnVRJfX19WSwEDK6FmycnJ8+fPP3v2bNsOblBsIigoiKr4/5RUVlZSlgpZlvV/7dq11hUcFKqHqhhAkwuhiLpzluWfhaPAjJW0rt+9PLhp8Djcj7yZFe90plVbW/uPf/zj3nvvjY6Olg80KPXu3XvMmDHPPvvsu+++K16QFy9epKMqH2izslgoQioqKoqKiijmy83N3bJly/tgPnRe6OzQOaIzRedLPoXmo7VzQnnPPfdo9k9k0au9yf42yt4UWC2bTBs+Mea0ytF3+NKRnDt3blxcHH8D4n/NkCg2IYUi7E8K1J5lWbetrR0XqoeqGECTgw5F6s71q+tLupMHNw1mgPuRN7Pcnc60rl+/TgewuLj48OHDeXl5NJ/euHHjBx98kJmZKR900KGjRMeKjhgdNzp6dAzpSNLxpKMqH2izsl4oUlVVVVJSQjHf/v376V1gK5gPnRc6O3SO6EzR+ZJPofm0d0IZFhamCXP6L774QpwQT506lZY3bdrUukILRdXkyZM1+wPZckVb9P6ybt06zf5/cnKdnWIT0ge0aEHTfUCrtbXjQvVQFQMgNptN36FI3bl+PPqS7uTBTYMZ4H7kzSx3pzOthoaGmpqaS5cuFRYW0kw6Pz+f7qpZWVmf2cnHHQTsENGxoiNGx42OHh1DOpJ0POmoygfarKwXily9erWsrOzs2bP0+j906NAuMB86L3R26BzRmaLzJZ9C86Hpr1ykxB6HWLp0aXV19c6dO4cOHSpOiPPy8gIDA+Pj47Ozs+n+tG/fvoceeshpVU5Ojr+/f0JCArWhbo8cObJ8+fIxY8aw2nHjxmVmZp4+fbquru6TTz6hbaWlpbEqiWITW+2PrVNAQm9VRUVFtKB/bL21I8eF6qEqBkBiY2OpQ3q75CUSdef68ehLupMHNw1mgPuRN7Pcnc7Mrl+/TvcLmkOfOXPm2LFjBw4c2LNnT0FBgXzQQYeOEh0rOmJ03Ojo0TGkI2mhP4k0WTEUuXbtGh1leuWXlJTQdOoEmA+dFzo7dI7oTEmPGfQM586dmzFjRmRkZEBAQHJy8po1a6QJ8f79+6dPn96vXz9qkJKSIj7Draii95T09PSoqCiaiycmJmZkZOTn57OqL7/8ctasWTS/p7Xi4uLmzZtHR5ivKFFsYqv9y3yD7FJTUz/99FNeZTinNyxsUg61STmAFStW9O/f31G3jKJz/Yr6ku7kwU2DGeB+5M16/J2uOzU2NtIxrK6uLi8vv3DhAk2pT58+fdJOPu4gYIeIjhUdMTpudPToGNKRdPoNN6ZivVCkoaGBjvLVq1fZ96iWgfnQeaGzQ+eIzpSF/kQI0F4IRbwc7kfeDHc696LZc319fV1dXU1NDXtB0cRaPuigQ0eJXYp03Ojo0TG0VhzSZMVQBADAJBCKAAAAdAZCEQCADkIoAtBtysvLZ82aJZcCgMUhFAHoyK+tb9q0aciQIT4+Pnwy6uJDC+pm6tqOmT17Nv+JQLUObJ133oF1XdR1PXeeaQcG0MNkZ2ezbzOXKwDA4hCKAHRkQjlw4EBa69ChQ7zExRmzupm6tgMaGhqio6N//vOfyxVG2rt1sfP2ruu6ruu580w7MIAeo7a29he/+AX7fx+84gB6HoQiAB2ZUHb4ptjhFTvmyy+/pM1lZWXJFUbaOzax8/au67qu67nzTDswgJ7hwIEDd9xxB3sTMPNbAQB0GEIRgHZPKMX7Il9XXCYHDx6cOXNmTExMQEDA6NGj+RfasmYbNmyYOHFiREREZGTktGnTTp06ZdjJjh070tLSwsLCwsPDU1NTN2/ezKtYy9ra2vnz50dHR/v4+PAq0cKFC2n1uro6lnXaIcfLHe1IU9vO2VqO9qup5XuEg4ODg4KCxo8fz3/PhBQXF2dkZAwYMIA2kZCQ8PDDD2/fvp1VtR3UjVEp2nczPiQAcK/GxsZXX32VXuOGbwIA0GMgFAHoyIRSf1MUS/Lz82nCHRcXl5WVdeXKlT179tB0WWyWlJS0d+/eysrK5557jrKTJk3Sd7Jt2zY/Pz+a2Z84caKsrGz27NlUtWrVKrHlkiVLqJ/6+npWqDdq1KgHHniALas7bDLaKcWONLXtnK3raL/YryuOGzfum2++KSwspAXx1xWpGTXeuHFjTU3N8ePHV6xYMXbsWFbFe+bZJmftu5M0MABwi6KioqlTp7LXvkRuCgAWh1AEoN2/tt5kND8WS9jPsYt/QOBYs7y8PJalWTtlAwICxFq2TDEDLR84cIBlL1y4QFn+ADprWVBQwLKGzp07Z7PZ3n33XZZVd9hktFOKHZE6Z+s62q/x48dTNjc3l2VzcnIoO2HCBJYNCQmh7Pbt2w2/DV0/KnX77iQNDAA6b+3atX369GEvfD25NQBYHEIRgI7Q3xTFkuDgYFouKysTGzCsGf/EFE2mxRX1nUh8fX3Fluqf+H377bcpWqCYgWXVHTYZ7ZRiR6TO2bqO9isoKIiWr1y5wrIsUKFClqWYhDWmzSUnJ8+fP//s2bOsqsloVOr23UkaGHjE4sWLpSy7PBjUWq72wQcfFGsl7eoKtd1TC9AZCEUAOoK9HTsqYTP48vJysQGjXlHfSWlpaWtTgb4fvfT09NGjR/OsusMmoz4VOyJ1rl9XLJFCEVrQ7IEEyxYVFc2dO5d9UyfD/2DSZNSzun13kgYGHoGz0PPgA1oA3gOhCEBH6G+KYgm7iW7atElswKhXFJcnT56s2R8Eb20q0PcjqaurCw0NXbRoES9Rd0hsNpvUp6Md0XeuH49YIn1AixY0o/ihoqJi3bp1VBUSEsIL9aPiDNt3J0cDg+6Es9Aj4bF1AC+BUASgI/Q3RbEkLy8vMDAwPj4+Ozu7qqpq3759Dz30kL6ZvkRczsnJ8ff3T0hIoN6qq6uPHDmyfPnyMWPG6Fsa+uyzz6jBzp07eYm6QxIbG0urHD58mJc42hF95/rxiCXssXUKSAoLC4uKimhBfGx93LhxmZmZp0+fpgjnk08+obXS0tJ4P/pRqdt3J/UpgO6Bs9CD4ct8AXo8hCIAHfm1df1NUSrZv3//9OnT+/XrFxAQkJKSIn2ZL28mlUi1u3btSk9Pj4qKohAiMTExIyMjPz/fsKUe+5LfhoYGsVDRIVmxYkX//v2lng13RN+5fjxSCfsy3yC71NTUTz/9lFd9+eWXs2bNooCHNhEXFzdv3rySkhJeqx+Vun13knYZPAJnoWfDTxwC9GwIRQB65lSGIo1HH31ULnWTLu3cQnrklWM5eILWG2RnZ7PHw+QKALA4hCIAmFBCB+HKAeg25eXls2bNkksBwOIQioD1uPeG1NjYaLPZ5FIAFyAUAQBT+eijj9gn2fRfNwJgTghFwGLc/mf6mpoa/q2yAO3ixusQAKyOxQBMr169EhMTn332WfWvP7nXpUuX+vfvf48dLVCWV7FRCW27VfdsvfNbkXpgWS46Ovquu+4y/M3fzmObkEtbiLXqllaEUAQso4seXiwrK8vIyJBLAVzgxusQAKyO35saGxtPnTp17733UpaiEbldl5kxY0ZycnKlHS1Qlle5977ZXt2z9c5vRepBzNIMJDc3d8SIEVTypz/9ibdxF/XgxVp1SytCKALWgK90BBPCdWgGeGwdTEK6Nx0/fpyyQ4YMEZp4jGfvm92z9c5vRepB32F+fr7WNedUvy2RutbqEIqA2eGHrsC0cB2aAc4CmIR0b6qtraUs3byEJk07duxIS0sLCwsLDw9PTU3dvHmzWPvee+/RNDc4ODglJWXVqlVih/obn1Si6Jm15FxZRU/RmHW7YcOGiRMnRkREREZGTps27dSpU2ItJxbSIWJfDe/j48PK165dy6rouA0bNmzhwoV1dXUd3kqTcth60rpSllRXV2v2T9+JhRxrTyeOTh+dRDqVq1evlmqF5m1KXF9X6qeLrpnuhFAETK2oqIj94Lee3BSg2+E6NAOcBTAJ6d507Ngxyg4aNIiXbNu2zc/Pj2bSJ06cKCsrmz17tmaffbLazz//nLLsp2AJLYgd0oL0DStirbpnqTHjdBWRujHrPCkpae/evZWVlc899xxlJ02axFfXb52VLFmyhFapr6/n5U8//fSWLVuqqqoqKipeeeUVarNgwQJxlXZtRT1sPakHfYc7d+7UHP9VhLUfN27cN998w37Ml7LZ2dm8VnEGna4rtWTLXXrNdBuEImBea9eu7dOnD3vl6Mmt2+nUqVMeeclBT9L56xA6D2cBTILfmxobG0+fPs2eFVm0aBFvQNM+Kjlw4ADLXrhwgbLDhg1j2cmTJ1P2n//8J8vm5uaKNzta8PX1Zcu8hNeqe5YaM05XEakbs87z8vJY9sqVK1rbPwfpt85KCgoKxELJ9evXqc3gwYNZtgNbUQ9bT+pBzNbW1tKpYc+KLFu2jLcRsfZ04liWncEpU6bwWsUZdLqu1JItd+k1020sFopE+vmy4wimFRUVJZ+2jlKHItzZs2fFtWJjY12p7du378yZM8vKysRagHbRMAk2AZwFMAnx1sPQxE78Bq3g4GC5hTBZjIyMpCzNsFm2srKSNWBZsSUv4bXqnqXGjNNVROrGLMs/SUWRGCvhq0tZXiJ9vVhpaemcOXMGDBjg5+fHGhD+2S2WbddW1MPWYw2kLEfTBvU3aLFm0hnkkyJNt2nWXlxWrCu1ZMtdes10G4uFInSYykcPRjJzonNUUVFRVVV19epVepdpaGiQz2J74ANaYGa4Ds0Aj62DSfB7U21t7e7du8eOHUvZjz/+mDdgkz+acLeuI5Cmlex//fmbjCZMygnNyMVadc9Nukl2kwuriNSN9Z1LJU4bMPfcc49m/0TWxYsXm1oetuHN9KtIJfoG6mHrOe1QjbWXzqAYTijOoNN1pZZsuUuvmW6DUATJzYnOEcUPJSUlZWVlFJB0/ivV8dg6mBauQwDgpHvTuXPn/P39U1NTeQn7OM2GDRt4iWjSpEma4w/bUFe0XF1dzbLsoQVeq+6Z2Gw2cWxNLqwiUjcWR2JYot+6fhUSFhamCRPrL774QmymX0Uq0W9FPWw9qUP9FtVYe0cfslKfQfW6+pZsuUuvmW6DUATJzYnO0aFDh06cOHH27FmKRq5evSqfxQ7Bl/mCCeE6BABOf2+6//77qSQrK4tlc3JyaHaYkJCQl5dHE8QjR44sX758zJgxrHbr1q2a40eQ2Sf7X3jhBZqp79+/f9SoUWKtuuemlg8nHz58mJc4XUWkbqzfcalEv3X9KuTuu++mwqVLl9ImaN48dOhQsZl+FalEvxX1sPWkDvVbVGPt2Rnkj57zs68+g+p19S3ZcpdeM90GoQiSm5NmD+vpoqdopKSkpKqqSj6LHdVFP3EI0GG4DgGA09+bPvroIyqhGSEv2bVrV3p6elRUFM0CExMTMzIy8vPzee2KFSsGDx4cFBSUlJS0cuVKscNTp05NmzYtMjKyd+/eqampH3zwgbQ5pz3379+/XatIFI2lbvUl+q3rV2my/x1pxowZtI8BAQHJyclr1qxRryKV6LfSpBy2nrSufotqrD2dODp9dBJpli9+O476DKrX1bfkVV13zXQbhCJIbk50jrZs2ULRyKFDhyiyr6iokM9i52RnZ8fFxYmvJQBPwXUIAF1HmjiCyZnhfJlhDO2FUATJzYnO0fvvv79161aKttmXVctnsdPKy8tnzZollwJ0O8u94/dIeGwdeiorTiu9mRnOlxnG0F4IRZDcnLohFAEwCcu94/dIOAvQU1lxWunNzHC+zDCG9ur5ocjaITGpoYF9/Xx9bVqIj8/N/n6jQwL0zSyR4gOav2k757YBvOSRqOavm5geGcpLdtw2gEqCfWwXUhL0PUiJXbL68s4kDaEIeA3LveP3SDgLAADW1cNDkf8d2JdWWRAbcTIp/uyoBJrEvxgXNSLIX9/SEml23+bA4+W4vrwkMbAXlQz09+MlVEsl/94nWL+6PiEUAegMTILNAGcBAMC6engoMjigeaZelDxIX2XF9P8P7ke7838iQlj2VNKg5u/Qtjt6RzwrpFrKLh3YGq4oEltXX96ZpCEUAa+BSbAZ4CwAAFhXDw9Fgnya5+rf6x384dCbTjsISLYMj50UHhTq6xPm6/Od0MD1iTG8is3US1IS/rNf775+vj6adkdw8w/tvTe4P2+zanDzN8clBd/40JfT3sRNiyX6bYktWTqeFE/706+XL8u+nxhDq/jbf9OHD4lqKbt/5EC+ltMh/WlQNI2fjlVCQK+3Evrpt9uupCEUAa+hYRJsAnhsHQDAunp4KLLw5kg222Zu6uU3PTL0r8Nu4g1o2c9mSw0N3DMijmKVmVGhbGrOatlazw+I2n7rgEspzSWv2D/xdU/v1o8//X+9g6lkif2vEE57szkLRcRtGaYRQc2/nVkwIo6W/zumDy3PiGzeyn/1700lVE7LwwJ78fZOh0TGhgQeGDnw0MiBd4YGUvZj4fh0IGkIRcBraAhFAAAAOqGHhyKUPhx6011hQb78k0z2eOD1+Btz8VT75Du35UHwY0nxlB3SMpVn7bfdejPv7ZvkQQE+NprcH7N/IIr+peVAH9s39j+5OO2NhsG74v072pZh+kn/3tTsD/bxs819cevN9O8Y+7P4f4yP1lrCEpacDolsHR7LsrRAWTpc0kbblTSEIuA1NIQiAAAAndDzQxGWzo9KoHn2r26KCLH/VndCwI25OPsEl4QHDCxb2varqKbb/wrx2wFRtPz8gCjN/ncJF3tzGopI29KnD+wfypoVFUYtaXM39Wp+YH1QQC9/m60kJWGW/Qu1Phra+mcNp0MixaOa4yhKZ5IHUTbS78YHwDqWNGUoMnToUGEgANYWFRUlXt4AAADQLt4SivCUaZ/KB9hsLMtm6seTbjzzLSU225AKPx52ExXeZv8artvsH5f627Abf1Vw2puP0NuFlASxf8Nt6dPZUQkUdcQH+P39luY/hkyzP8L+kD06+nR4LMUkwT7NMQlv73RImhCK0ILWxaEIAAAAAADjdaEIm20PafmryISwIK3tY+hiYjN1qbBs9OAE+xdzvWb/NNTggF5lLVXq3tjz5edG3YgTWCzB+zfclmFin7lin9R6zv7Hmd/FNf9x5ol+zSXfE55jKXc2JLZRfEALAKwLj60DAFhXDw9FEgN7PRnTZ9Owm/aNGFiSknAiKf7p2Ajq5PfxN77r9tPhseyPDFm33ExBQv7tcRRgjGr5Oiw2U9d3y56GD7T/wWHRzZG8XN0bCyGevTmSwqGc2wawL+Pi/Tvalj79j30XQpu/ZEvbYo8isu1RTbB9PK+2/Rpf9ZDYRu8MDTwoPLb+ER5bBwDr0PDEDgCAZfXwUGRan5ARQf59/XwpbKCZex9fn7vCgla1/RNB9q03f79PSKSfL03ZBwf0mhUVRjN7VuUoPDh6Rzx7Dp7+5T/o4bQ3Coe+1zs4ws8n3P6luuxbgHn/jralT+xvF6SXzXbe/jeW0pQEFhdpbb/GlyXFkNgqywZF01GiHihi4V+u1eGkIRQBgG6kIRQBALCsHh6KIHV/QigCAN0JoQgAgHUhFEFyc0IoAgDdCaEIAIB1IRRBcnNCKAIA3QmPrQMAWBdCEePEHqLQl0sN/Gy2fSPaPJtBWT/7N2WpV5f60S9bN2kuhCJfffUVzR5uv/12tstydVMTrT5hwoTevXtHRETMmDGjsLCQV+3du/dnP/vZ0KFD/f39+/fvP2XKlM2bNwurypxuq6qq6umnn46Pjw8KCho7duzHH3/Mq2pra1966aURI0aEh4eHhYXRAmWpUFi7DfW23D7y48eP33fffWF2tHDy5Em5BQAAAICJIRQxTmzypy+XGpCMvuFi+aN9m39k0OnqUj/6ZesmzYVQ5LbbbqNJNk212S5LtevWraNCmluft6OFgQMHlpeXs9qkpKSlS5fu37+fQgiai3/3u9+lxm+++WbbPlqpt1VfXz9x4kSKeTZs2FBRUVFQUECRD6+dO3curfLoo49euHDh4sWLc+bMoSwVCh20od6We0d+6dKl2NhYip2K7UaPHj1gwADDow0AAABgTghFjBOb/OnLpQb/Fhrob7N91fKlVbRA2XH2r8RVr26YOraW2ZLmQijCsV2WCtnfAY4dO8aytEDZRYsWtWnUoqioiGoHDRokV+gYbuudd96hwiVLlkjlTGho829HUhDCsrRAWSps28qA4bYknRz5s88+S4X8bzgbN26kLD6pAgAAABbivaHIluGxk8KDQn19wuxfrbs+MYZXsZkfp1+Xt1lv/+32H/frzQoft//I4Af2QnHFdxL6sZIAm21IYK9f3hRxoeUH0cWW0loWTVqnQ5FevZp/QZJ/DooWKDtq1Ki2rW4oLS2lWn9/f7lCx3BbU6dO1YSwRxIZ2fwDMlIoEhUV1baVAcNtSTo58pSUFCosLi5mWRbYjBkzpm0rAAAAAPPy0lDkr8Nu8rPZUkMD94yIO508aGZU839+iz+pwSZ/+hX1DUYGN/8ix7Gk+GN3xNPCHfZfD5RWnx/TZ8PQmLOjEoqSBz03oPmX0X8e00e/IWktiyat06FIXFwcFR4/fpxl2V9FwsLC2ra64Ze//CXVjhgxQq7QMdwWxRVUOHHiRIo6QkJCaH6/du1aXvvUU09R7Zw5cy7asQ9oLViwQOjAmOG2JJ0cOR0QKqyrq2PZq1evUjY8PLxtK4CeD38MBACwLi8NRdgPn+feNoBlKZCg7JDAXrwBm/zpV9Q3WGH/pcInY/r8rH8fWlhp//1ExeoXUxKoalDAjW2JLRVrWShpnQ5Fli5dSoX3339/iV16ejpl/fz8pGa8JduiXKdjuC1fX18qpE3Qhs6fP8+29dprr7Famt+npqayFZnx48crHlvnDLcl6vzIfXx8qLCxsZFlGxoaKEu707YVQM+nf3UAAIBVeGkoEtTy2+QiX1tr56xEv6K+weXRgymGCfX1CfHxoYXLutWPJ8U/HBUW6+/Hv1mL+BiFH+KydZPW6VCErF69etSoUcHBwb17977rrruoTXR0tNTmlVdeoXKbzfb6669LVYYMt8WeBpH+AhMfH8+yTzzxhGb/q0hpaSn/qwgVtq7vgOG2OLeMnP1VhMdF+KsIeC39qwMAAKzCq0MRChL0VSyxyZ++3LDBH+KjWfaP8Tc+4iXWTg0P0uyfyDph31yJ/a8ivNbRsnWT5o5QRHT48GFqk5aWJha+9NJLmn02/84774jlCobbSk5O1nTPpfDnNygQ0nTPilAhyyoYbotx18jZsyJnzpxh2cLCQg3PioBX0r86AADAKrw0FJkQ1hwevGf/MJVhYn+/0JfzxGaHbLk0JSHW349SqdHD6KG+zR+kKR41iGX/NixWrHW0bN2kuTsUeeGFF6jNihUreMnzzz9PJT4+PmIho+jQsOqZZ57RdH8VGTlyJMuGh4drjkMRww4ZR1VuHPnChQs14Ru0/vKXv2j4Bi3wSvpXBwAAWIWXhiKfDo/1t9niA/yybrn53KiE/NvjXouPHmV/4pylmF7NjxDsvD1Ovy5LbHaoL9fXTrKHPS8MiKIN/f2Wm4cENH89FK91tGzdpLkjFLnvvvt2795dUVGRmZkZGho6derUhoYGVvXrX/9asz8UsXr16rYrNXPUYZODKvbrHNJzKevXr2e1jz/+uCY8ts5+ZuTHP/4xqzXskDGscu/IaTwxMTFjx449azd69GjakcuXL0vNAHo8ROAAANblpaEIpexbb/5+n5BIP1+KSQYH9JoVFZZ9y8289o1B0dH2aMTRFhVVUu3RO+LTI0Ii/HwCbLaRwf5vt3yxr76luk+rJM21UITtrEis3bhxI82tAwMD4+PjFyxYUF1dzavk1VqItbyxWCgSa0+ePPnAAw/0tpswYcLnn3/Oq+rq6l5++eWRI0eyXzQfMWIEZfmXVum74oUiRRUj1vLGYqFIrD127Ni9994bajdt2jT+tx0AAAAAS/DeUASpi5LmWigCAAAAAF4OoQiSmxNCEQAAAABwBUIRJDcnhCIAAAAA4AqEIkhuTo5CEVrw9/en2oCAANPGJ+LzGOKynrq2e7Ax2Gy2wMDAmJiY1NTUxYsXnz17Vt/Gz8/v1KlTYjllqVDcC7bsiLgugKngsXUAAOtCKILk5qQ5CEX+9Kc/afaf7KB/33zzzbYn1izEabd6Cq6u7R58DNevXz9z5syKFSsSEhJ69+69adMmqQ15/PHHW9dsanrsscd4lVguyczMZBGLXAFgGrg+AQCsC6EIkpuT5iAUGTduHFW9/vrr9G9qamrbE2tG6mm6urZ76Mdw+fLlIUOGBAQEHDx4UGwzYcIECgL57yHSAmXZz9gr9mLt2rW+vs3fI/f73/9ergMwDcU1DAAAJodQBMnNSTMKRWiBym+99VZavuWWW2iZSsQzS1PnmTNnxsTE0DR69OjRH330kStVO3bsSEtLCwsLCw8Pp/Bm8+bNvKq4uDgjI2PAgAG0VkJCwsMPP7x9+3anVeLUnC2vWrUqJSUlODiYpvji74GILZuUI9FTNGbdbtiwYeLEiREREZGRkdOmTZM+W8VJY2DWrFlDhY888gjLsja0Cfr3ySefZIU/+9nPKPvJJ58Y9sDQzrI45LXXXpPrAMzE0TUMAADmh1AEyc1JMwpFFi1aROUvvfQSLb/44ota298Fz8/PDwoKiouLy8rKunLlyp49eyg8cFq1bds2Pz8/mrKzrcyePVuzRw6sdtKkSZTduHFjTU3N8ePHV6xYMXbsWKdV4tScLY8bN+6bb74pKioaP348ZbOzs/Ut1SORqBuzbpOSkvbu3VtZWfncc89Rlgbcto8bxDFwJSUlVHjTTTexLG+TnJxMR/LChQvUgBZGjRol1kromPj4+FDVH/7wB7kOwGQMr2EAALAEhCJIbk6aUSgyePBgX19f9kR1cXExTXOHDBnCT+vdd99Na4l/7nClimbzVHXgwAGWpUk2ZYcNG8ayISEhlN2+fXtjY2PrOs6qxKk5W87NzWVZWqDslClT9C3VI5GoG7Nu8/LyWJaiL83+oD/LSsQxcNeuXaPCXr16sSxvk5mZSQu/+tWvnnrqKa3lF+UNe3jnnXdsNhuV//GPf5SqAEwIj60DAFiXxUKRqKgoNnkC06KJvhSK7Nixg8q/973v8fN4zz33UElOTg7LBgcHU9bwa7WcVkko4GG1EyZMYCXULDk5ef78+fyrpRRVrFxcpmCAZSsrKylLV6C+pXokEnVjluU/6E7BEitpXV9gWHX+/HnN6K8iDQ0NFPCEhYWFhobSAmXFWu7NN9+02b3xxhtiOQAAAIDbWSwUIRUVFUVFRYcOHcrNzd2yZcv7YD50Xujs0DmiM0Xn6/HHH2dTXsmPf/xjdk7Z7Ly8vLztqXapqrS0VK6wo03PnTs3Li6Ob44iEKdVLCsu81CE/YFCEYo4GolE3Vjs1lEJZ1i1evVqKuQfYxPbvPPOOyz77rvv6msJhR8sDlm2bBkvBAAAAOgi1gtFqqqqSkpKTpw4sX//fprvbgXzofNCZ4fOEZ2py5cv9+nTJyQkpLq6WjyJVBIREVFbW0vZqVOn0oRY/ApaTlE1efJkzf6Et1zRFsVC69at0+x/rnFaJU7N2bIrH9BycSSMurHYraMSTl/l6Bu02PK1a9cG2NGCvva1117T7L9SYtqvWgYAAIAexnqhyNWrV8vKys6ePUsz3UOHDu0C86HzQmeHzhGdqbVr12rCf9Jzs2bN0lpm5Hl5eYGBgfHx8dnZ2RSl7Nu376GHHmLNFFU5OTn+/v4JCQnUhuKcI0eOLF++fMyYMax23LhxmZmZp0+frqurY18VlZaW5rRKnJqz5fHjxxcWFvLH1rOysvQt1SORqBuL3Toq4XhVfX19cXEx/10R8dEaxepNuv2lOOStt95q2wQAAACgq1gvFLl27RpNSWmOW1JSQhPEE2A+dF7o7NA5ojN177330hz3r3/9q3QeP/74Yyq/7777WHb//v3Tp0/v169fQEBASkqKOJlWVFHYk56eHhUVRZP7xMTEjIyM/Px8VvXll19StEMxDK0VFxc3b948GpLTKmlqTlauXJmUlBQUFESzfPFLscSWTcqR6CkaS90alnCsiuIH2hH1r62LJSKxli070nY9ABPBY+sAANZlvVCkoaGBopGrV6/SNLeioqIMzIfOC50dOkd0ptjj0QAAXQShMgCAdVkvFAEAAOAQigAAWBdCEWsoLy+fNWuWXAoA4PUQigAAWBdCEQvIzs5m3zwrVwAAeD28NwIAWBdCEVOrra39xS9+4ePjg0eHAQAM4bF1AADrQihiXgcOHLjjjjv4VxghFAEAAACAngShiBk1Nja++uqrAQEBYhyCUAQAAAAAehKEIqZTVFTEfmJcT24KAAAAAGBZCEXMZe3atX369JFDkBZyawAAAAAAy0IoYi7qUGTx4sVSVlwXtahFLWpRCwAAFoJQxHTwAS0AAAAA8AYIRcwIj60DAAAAQI+HUMS88GW+AAAAANCDIRQxNfzEIQAAAAD0VAhFLCA7OzsuLg6hCAAAAAD0JAhFrKG8vHzWrFlyKQAAAACAZSEUAQAAAAAAD0AoAgAAAAAAHoBQBAAAAAAAPAChCAAAAAAAeABCEQAAAAAA8ACEIgAAAAAA4AEIRQAAAAAAwAMQigAAAAAAgAcgFAEAAAAAAA9AKAIAAAAAAB6AUAQAAAAAADwAoQgAAAAAAHgAQhEAAAAAAPAAhCIAAAAAAOABCEUAAAAAAMADEIoAAAAAAIAHIBQBAAAAAAAPQCgCAAAAAAAegFAEAAAAAAA8AKEIAAAAAAB4AEIRAAAAAADwAIQiAAAAAADgAQhFAAAAAADAAxCKAAAAAACAByAUAQAAAAAADzAIRQAAAAAAALoNQhEAAAAAAPAAhCIAAAAAAOAB/w9KhvsFo3HabwAAAABJRU5ErkJggg==" alt="essai" width="1070" height="252">
</div>
</div>
<div class="paragraph">
<p>Si vous avez configurÃ© votre box pour que la machine 192.168.12.10 (sur votre rÃ©seau local) rÃ©ponde aux requÃªtes venant d&#8217;internet au travers de la box, vous avez soit fait du port forwarding soit dÃ©fini cette machine comme prÃ©sente dans la DMZ du routeur Internet.</p>
</div>
<div class="paragraph">
<p>Si vous accÃ¨dez Ã  votre nom de domaine <code>home.example.com</code> Ã  partir d&#8217;internet, l&#8217;adresse IP qui sera fournie est la 20.10.3.5 pour l&#8217;exemple suivant. La configuration de votre routeur fera que les paquets IP seront retransmis vers votre Serveur Web qui rÃ©pondra correctement aux requÃªtes.</p>
</div>
<div class="paragraph">
<p>Sur le rÃ©seau local, il en est autrement.</p>
</div>
<div class="paragraph">
<p>Lorsque depuis votre Home Server, vous demanderez la rÃ©solution de l&#8217;adresse <code>home.example.com</code>, c&#8217;est toujours l&#8217;adresse de 20.10.3.5 qui sera fournie (adresse IP fournie par le serveur DNS). La machine home Server (tout comme n&#8217;importe quel PC local) tentera de se connecter au routeur internet qui ne fera pas suivre les paquets vers le Server Web car la requÃªte provient du rÃ©seau local interne et non pas d&#8217;internet.</p>
</div>
<div class="paragraph">
<p>De ce fait, il est impossible de contacter les services de <code>home.example.com</code> Ã  partir du rÃ©seau local.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Certaines boxes plus rÃ©centes (ou d&#8217;autres trÃ¨s anciennes) ne sont pas soumises Ã  ce problÃ¨me et routent correctement les paquets. Faire une recherche <code>ADSL Hairpinning</code> sur google pour voir si votre box n&#8217;est pas soumise Ã  ce problÃ¨me.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_contournement_par_le_fichier_hosts">6.4.1. Contournement par le fichier Hosts</h4>
<div class="paragraph">
<p>Un moyen de contourner cela est de dÃ©finir dans le fichier <code>/etc/hosts</code> une entrÃ©e spÃ©cifique pour indiquer que <code>home.example.com</code> n&#8217;est pas 20.10.3.5 mais 192.168.12.10.</p>
</div>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Editez le fichier hosts. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/hosts</code></pre>
</div>
</div>
</li>
<li>
<p>Allez Ã  la fin du fichier et ajoutez dans le fichier:</p>
<div class="listingblock">
<div class="content">
<pre>[Adresse IP locale]     [home.example.com] <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
[adresse IP locale]     [mail.example.com]</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez [Adresse IP locale] par l&#8217;adresse IP du serveur qui rÃ©pond au domaine [home.example.com] dans votre rÃ©seau local. L&#8217;adresse IP doit Ãªtre du type 192.x.y.z.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>replacez [home.example.com] par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_contournement_par_la_mise_en_place_dun_dns_interne">6.4.2. Contournement par la mise en place d&#8217;un DNS interne</h4>
<div class="paragraph">
<p>Une autre maniÃ¨re de faire est de mettre en place un <a href="#pihole">DNS interne</a>.
Il vous faudra au prÃ©alable l&#8217;installer (voir la doc du lien ci dessus).</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Loggez vous sur le serveur PI-Hole.</p>
</li>
<li>
<p>allez dans <code>Local DNS</code>&#8594;`DNS Records`</p>
</li>
<li>
<p>Dans le Champ domaine Ajouter votre domaine Ã  redÃ©finir [home.example.com]</p>
</li>
<li>
<p>Dans le champ <code>IP Address</code> mettez l&#8217;adresse IP du serveur qui rÃ©pond au domaine dans votre rÃ©seau local.</p>
</li>
<li>
<p>Cliquez sur <code>Add</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le nom de domaine est maintenant correctement rÃ©solu sur le rÃ©seau local pour toute les machines qui rÃ©cupÃ¨rent leurs paramÃ¨tres avec le DHCP local.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_de_ssmtp">6.5. Configuration de ssmtp</h3>
<div class="paragraph">
<p>Les mails locaux de la machine, notamment les mails envoyÃ©s sur le compte root doivent Ãªtre relayÃ©s vers un serveur de messagerie.
La maniÃ¨re la plus simple lorsqu&#8217;un serveur n&#8217;a pas de nom de domaine internet est de faire suivre ces comptes mails vers une adresse mail externe.</p>
</div>
<div class="sect3">
<h4 id="_crÃ©ation_dun_mail_dÃ©diÃ©">6.5.1. CrÃ©ation d&#8217;un mail dÃ©diÃ©</h4>
<div class="paragraph">
<p>Dans la suite du texte, "&lt;serveurmail&gt;" est le nom de la machine de relai de mail.</p>
</div>
<div class="paragraph">
<p>Pour crÃ©er une boite de messagerie dÃ©diÃ©e Ã  votre serveur:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connectez vous sur l&#8217;interface ispconfig de votre serveur de mail qui relayera les mails de votre machine interne</p>
</li>
<li>
<p>Aller dans la rubrique <code>Email</code>. SÃ©lectionnez ensuite le menu <code>Email Mailbox</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Mailbox</code></p>
</li>
<li>
<p>Remplissez les champs suivants:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Name:</code> &#8592; mettez un descriptif de votre serveur</p>
</li>
<li>
<p><code>`Email:</code> &#8592; saisir le &lt;mailname&gt;@&lt;serveurmail&gt; . Par exemple <code>homeserver@example.com</code></p>
</li>
<li>
<p><code>Password:</code> &#8592; <a href="#pass_gen">Saisissez un mot de passe gÃ©nÃ©rÃ©</a> ou gÃ©nÃ©rez en un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password</code> &#8592; saisissez une deuxiÃ¨me fois votre mot de passe</p>
</li>
<li>
<p><code>Quota (0 for unlimited):</code> &#8592; mettez Ã©ventuellement un quota ou laissez 0 pour illimitÃ©.</p>
</li>
<li>
<p><code>Spamfilter:</code> &#8592; SÃ©lectionnez <code>Normal</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Dans lâonglet Backup:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Backup interval:</code> SÃ©lectionnez <code>Daily</code></p>
</li>
<li>
<p><code>Number of backup copies:</code> SÃ©lectionnez 1</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Notez que si vous crÃ©ez une adresse mail nommÃ©e <code>homeserver@example.com</code>, vous pouvez utilisez toutes les variantes (nommÃ©es tag) derriÃ¨re le caractÃ¨re "+". Ainsi <code>homeserver+nospam@example.com</code> sera bien redirigÃ© vers votre boite et l&#8217;extension <code>+nospam</code> vous permettre de trier automatiquement les mails selon leur catÃ©gorie.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Il est possible de changer ce caractÃ¨re spÃ©cial en le modifiant dans le fichier <code>/etc/postfix/main.cf</code> sur la machine &lt;serveurmail&gt;.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_de_ssmtp_2">6.5.2. Configuration de ssmtp</h4>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez le package ssmtp. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>ssmtp</code></pre>
</div>
</div>
</li>
<li>
<p>Editez ensuite le fichier <code>/etc/ssmtp/ssmtp.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/ssmtp/ssmtp.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Mettez ensuite dans le fichier la configuration suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="c"># root is the person who gets all mail for userids &lt; 1000
</span><span class="py">root</span><span class="p">=</span><span class="s">&lt;mailname&gt;@&lt;servermail&gt;  </span><i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>

<span class="c"># The place where the mail goes. The actual machine name is required no
# MX records are consulted. Commonly mailhosts are named mail.domain.com
</span><span class="py">mailhub</span><span class="p">=</span><span class="s">mail.&lt;serveurmail&gt;:465 </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="py">UseTLS</span><span class="p">=</span><span class="s">YES</span>
<span class="py">UseSTARTTLS</span><span class="p">=</span><span class="s">No</span>
<span class="py">AuthUser</span><span class="p">=</span><span class="s">&lt;mailname&gt;@&lt;servermail&gt;  </span><i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="py">AuthPass</span><span class="p">=</span><span class="s">[mot_de_passe] </span><i class="conum" data-value="3"></i><b>(3)</b>

<span class="c"># Where will the mail seem to come from?
</span><span class="py">rewriteDomain</span><span class="p">=</span><span class="s">&lt;servermail&gt; </span><i class="conum" data-value="2"></i><b>(2)</b>

<span class="c"># The full hostname
</span><span class="py">hostname</span><span class="p">=</span><span class="s">&lt;serveurname&gt;.local </span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer &lt;mailname&gt; par le nom de serveur dÃ©fini au chapitre prÃ©cÃ©dent</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>remplacer &lt;servermail&gt; par le nom de domaine du relai de mail.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>remplacez [mot_de_passe] par le mot de passe gÃ©nÃ©rÃ© au chapitre prÃ©cÃ©dent.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enfin dernier fichier Ã  Ã©diter, le fichier <code>revaliases</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/ssmtp/revaliases</code></pre>
</div>
</div>
</li>
<li>
<p>Mettez ensuite dans le fichier la configuration suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">root:&lt;mailname&gt;@&lt;serveurmail&gt;:mail.&lt;serveurmail&gt;:465</span>  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer &lt;mailname&gt; par le nom de serveur dÃ©fini au chapitre prÃ©cÃ©dent</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>remplacer &lt;servermail&gt; par le nom de domaine du relai de mail.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="firewall">6.6. Deblocage de port de firewall</h3>
<div class="paragraph">
<p>Par dÃ©faut, une fois le firewall activÃ©, TOUS les ports sont bloquÃ©s en entrÃ©e de votre Ã©quipement. Cela veut dire qu&#8217;il ne sera pas possible de connecter une machine externe sur votre Ã©quipement sans avoir effectÃ© une opÃ©ration de dÃ©blocage du port du firewall.</p>
</div>
<div class="paragraph">
<p>Il existe deux maniÃ¨re de dÃ©bloquer un port. Elle dÃ©pend de ce que vous avez configurÃ©.</p>
</div>
<div class="sect3">
<h4 id="_dÃ©blocage_et_suppression_de_regles_de_firewall_avec_ispconfig">6.6.1. DÃ©blocage et suppression de regles de Firewall avec ISPconfig</h4>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes pour DÃ©bloquez le firewall:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez sur le site ispconfig <a href="https://example.com:8080/" class="bare">https://example.com:8080/</a></p>
</li>
<li>
<p>Loguez-vous et cliquez sur la rubrique <code>System</code> et le menu <code>Firewall</code>. Cliquez sur votre serveur.</p>
</li>
<li>
<p>dans la rubrique <code>Open TCP ports:</code>, ajoutez le numero de port xxxx que vous souhaitez dÃ©bloquer</p>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes bloquer (en lever une rÃ¨gle de dÃ©blocage) de firewall:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez sur le site ispconfig <a href="https://example.com:8080/" class="bare">https://example.com:8080/</a></p>
</li>
<li>
<p>Loguez-vous et cliquez sur la rubrique <code>System</code> et le menu <code>Firewall</code>. Cliquez sur votre serveur.</p>
</li>
<li>
<p>dans la rubrique <code>Open TCP ports:</code>, Supprimer le port xxxx</p>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_dÃ©blocage_de_firewall_ufw">6.6.2. DÃ©blocage de Firewall UFW</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Si vous avez installÃ© ISPconfig vous ne devez pas utiliser cette mÃ©thode !
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tout d&#8217;abord, Ã  la premiÃ¨re utilisation, il vous faut appliquer la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installez <code>ufw</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>ufw</code></pre>
</div>
</div>
</li>
<li>
<p>Autorisez SSH si vous ne voulez pas perdre votre connexion SSH Ã  l&#8217;activation du  firewall. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 443/tcp</code></pre>
</div>
</div>
</li>
<li>
<p>Activez le firewall. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ufw <span class="nb">enable</span></code></pre>
</div>
</div>
</li>
<li>
<p>C&#8217;est prÃªt !</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes pour DÃ©bloquez le firewall:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ufw allow xxxx/tcp <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez xxxx par le numero de port que vous souhaitez dÃ©bloquer</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes bloquer (en lever une rÃ¨gle de dÃ©blocage) de firewall:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ufw delete allow xxxx/tcp <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez xxxx par le numero de port que vous souhaitez dÃ©bloquer</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_de_avahi">6.7. Configuration de Avahi</h3>
<div class="paragraph">
<p>Avahi est une mise en Åuvre des protocoles Zeroconf (connexion au rÃ©seau avec zÃ©ro configuration) permettant ainsi Ã  des logiciels de publier et de dÃ©couvrir des services et des hÃ´tes en cours d&#8217;exÃ©cution sur un rÃ©seau local TCP/IP sans configuration particuliÃ¨re. Par exemple, un utilisateur peut brancher son ordinateur sur un rÃ©seau et trouver instantanÃ©ment des imprimantes pour imprimer, des fichiers Ã  lire et des personnes Ã  qui parler.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Avahi n&#8217;est Ã  utiliser que sur un rÃ©seau local sÃ©curisÃ©. L&#8217;outil expose des informations qui peuvent compromettre des reseaux non sÃ©curisÃ©s. Il est trÃ¨s fortement dÃ©conseillÃ© d&#8217;utiliser Avahi sur un rÃ©seau public ou sur Internet.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez le package <code>avahi-daemon</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>avahi-daemon</code></pre>
</div>
</div>
</li>
<li>
<p>Configurez Avahi. Editez le fichier <code>/etc/avahi/avahi-daemon.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/avahi/avahi-daemon.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Inserez dans le fichier les infos suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="nn">[server]</span>
<span class="py">domain-name</span><span class="p">=</span><span class="s">local</span>
<span class="py">use-ipv4</span><span class="p">=</span><span class="s">yes</span>
<span class="py">use-ipv6</span><span class="p">=</span><span class="s">yes</span>
<span class="py">enable-dbus</span><span class="p">=</span><span class="s">yes</span>
<span class="py">ratelimit-interval-usec</span><span class="p">=</span><span class="s">1000000</span>
<span class="py">ratelimit-burst</span><span class="p">=</span><span class="s">1000</span>

<span class="nn">[wide-area]</span>
<span class="py">enable-wide-area</span><span class="p">=</span><span class="s">yes</span>

<span class="nn">[publish]</span>
<span class="py">add-service-cookie</span><span class="p">=</span><span class="s">yes</span>
<span class="py">publish-addresses</span><span class="p">=</span><span class="s">yes</span>
<span class="py">publish-hinfo</span><span class="p">=</span><span class="s">yes</span>
<span class="py">publish-workstation</span><span class="p">=</span><span class="s">yes</span>
<span class="py">publish-domain</span><span class="p">=</span><span class="s">yes</span>
<span class="py">publish-resolv-conf-dns-servers</span><span class="p">=</span><span class="s">yes</span>

<span class="nn">[reflector]</span>
<span class="py">enable-reflector</span><span class="p">=</span><span class="s">yes</span>

<span class="nn">[rlimits]</span></code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez le service Avahi. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service avahi-daemon restart</code></pre>
</div>
</div>
</li>
<li>
<p>VÃ©rifiez que dans <code>/etc/systemd/resolved.conf</code>, le paramÃ¨tre <code>MulticastDNS=no</code> n&#8217;est pas prÃ©sent. Mettre yes sinon ou enlever la ligne.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="pihole">6.8. Configuration de Pi-Hole</h3>
<div class="paragraph">
<p>Pi-hole a pour rÃ´le de bloquer l&#8217;affichage des publicitÃ©s sur toutes les machines connectÃ©es au niveau d&#8217;un rÃ©seau local. Il joue le rÃ´le de serveur DNS local pour bloquer toutes les requÃªtes faites vers des domaines servant Ã  afficher de la pub sur les sites que vous visitez.</p>
</div>
<div class="paragraph">
<p>Pi-hole fonctionne en se basant sur des listes de domaines malveillants et/ou connus pour servir Ã  l&#8217;affichage de publicitÃ©s. ConcrÃ¨tement, il faut configurer ses machines connectÃ©es avec l&#8217;adresse IP du Raspberry comme serveur DNS : au cours de notre navigation internet, toutes les requÃªtes sont envoyÃ©es vers Pi-hole, toutes celles qui pointent vers un site figurant dans une de ses listes de blocage seront bloquÃ©es, toutes les requÃªtes lÃ©gitimes pourront passer et Ãªtre soumises au serveur DNS public que vous choisirez d&#8217;utiliser dans les paramÃ¨tres de Pi-hole.</p>
</div>
<div class="paragraph">
<p>Par consÃ©quent, les sites web visitÃ©s s&#8217;afficheront normalement mais les publicitÃ©s Ã©ventuelles qu&#8217;ils contiennent ne s&#8217;afficheront plus.</p>
</div>
<div class="paragraph">
<p>Pihole offre d&#8217;autres fonctionnalitÃ©s comme un serveur DHCP sur votre rÃ©seau local qui configurera les adresses IP de toute vos machines de faÃ§on statique ou dynamique selon le paramÃ©trage.
Pihole fournit aussi la possibilitÃ© de rÃ©soudre le problÃ¨me de &lt;#hairpinning, hairpinning&gt; en configurant de faÃ§on statique les nom DNS de vos serveurs sur votre rÃ©seau local.
Enfin dernier point, en configurant des DNS qui sont libres de censure et pas ceux de votre ISP, il vous sera possible d&#8217;accÃ©der Ã  des sites webs bloquÃ©s dans votre pays par dÃ©cision politique.</p>
</div>
<div class="sect3">
<h4 id="_mettre_une_ip_statique">6.8.1. Mettre une IP statique</h4>
<div class="paragraph">
<p>l&#8217;installation est trÃ¨s simple, suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/dhcpcd.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez Ã  la fin du fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">interface</span> <span class="err">wlan0</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="err">static</span> <span class="py">ip_address</span><span class="p">=</span><span class="s">192.168.3.210/24 </span><i class="conum" data-value="2"></i><b>(2)</b>
        <span class="err">static</span> <span class="py">routers</span><span class="p">=</span><span class="s">192.168.3.254 </span><i class="conum" data-value="3"></i><b>(3)</b>
        <span class="err">static</span> <span class="py">domain_name_servers</span><span class="p">=</span> <span class="s">127.0.0.1</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettez ici l&#8217;interface concernÃ©e (eth0 ou wlan0)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Remplacez 192.168.3.210 par l&#8217;adresse IP statique de cette machine</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Remplacez 192.168.3.254 par l&#8217;adresse IP de votre routeur internet (Box)</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_installation_de_pi_hole">6.8.2. Installation de Pi-Hole</h4>
<div class="paragraph">
<p>l&#8217;installation est trÃ¨s simple, suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">curl <span class="nt">-sSL</span> https://install.pi-hole.net | bash</code></pre>
</div>
</div>
</li>
<li>
<p>Laissez l&#8217;installation se faire, puis:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>Ok</code> 2 fois de suite</p>
</li>
<li>
<p>Cliquez sur 'Oui' ensuite</p>
</li>
<li>
<p>Choisissez ensuite l&#8217;interface wlan0 (le wifi si vous etes en wifi) ou eth0 si vous Ãªtes en filaire</p>
</li>
<li>
<p>Choisissez ensuite votre serveur DNS (quad9 filtered ECS DNSSEC)</p>
</li>
<li>
<p>Choisissez la liste de filtrage de StevenBlack</p>
</li>
<li>
<p>Installer l&#8217;interface web admin</p>
</li>
<li>
<p>Installer le serveur web lighttpd</p>
</li>
<li>
<p>Activer le log des requÃªtes</p>
</li>
<li>
<p>Choisissez "Show Everything" pour le "privacy mode FTL"</p>
</li>
</ol>
</div>
</li>
<li>
<p>L&#8217;installation doit se terminer avec succÃ¨s. Avant de cliquer sur OK notez bien le mot de passe. Vous le changerez ensuite.</p>
</li>
<li>
<p>Pour changer le mot de passe, Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">pihole <span class="nt">-a</span> <span class="nt">-p</span></code></pre>
</div>
</div>
</li>
<li>
<p>Loguez vous sur votre site pihole en pointant sur <a href="http://&lt;adresseIP&gt;/admin" class="bare">http://&lt;adresseIP&gt;/admin</a>.</p>
</li>
<li>
<p>Cliquez sur <code>Login</code>, tapez le mot de passe que vous avez notÃ© et cliquez sur <code>Log in</code></p>
</li>
<li>
<p>Cliquez ensuite sur <code>Settings</code> &#8594; <code>DHCP</code> et configurez vos bails statique (static leases) en saisissant les adresses MAC, IP et les hostnames des machines</p>
</li>
<li>
<p>Allez ensuite dans <code>Local DNS</code> &#8594; <code>DNS Records</code> pour configurer les domaines et les adresses IP associÃ©es.</p>
</li>
<li>
<p>Si vous souhaitez bloquer des domaines vous pouvez ajouter un domaine avec une adresse IP en 0.0.0.0 ou ajouter un Ã©lÃ©ment dans l&#8217;onglet blacklist</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation_dun_serveur_de_fichier_windows">6.9. Installation d&#8217;un serveur de fichier Windows</h3>
<div class="paragraph">
<p>Le partage de fichier sous Linux s&#8217;appuie sur le logiciel Samba qui implÃ©mente les protocoles de Microsoft de partage des fichiers.</p>
</div>
<div class="paragraph">
<p>Deux configurations sont proposÃ©es dans ce tutoriel :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>une premiÃ¨re avec un partage de fichier simple et peu sÃ©curisÃ©</p>
</li>
<li>
<p>une deuxiÃ¨me avec un serveur Active directory et un contrÃ´leur de domaine.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Tout d&#8217;abord, il vous faudra installer Samba:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>samba</code></pre>
</div>
</div>
</li>
<li>
<p>Une premiÃ¨re configuration de base sera installÃ©e. Elle sera Ã  modifier en fonction de vos besoins.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_installation_dun_partage_de_fichier_basique">6.9.1. Installation d&#8217;un partage de fichier basique</h4>
<div class="paragraph">
<p>Nous allons configurer un partage Samba Ã  l&#8217;aide d&#8217;un serveur autonome. Dans le fichier nous allons configurer un partage du home, et d&#8217;un rÃ©pertoire de partage public sur le rÃ©seau local en lecture Ã©criture :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Editez le fichier <code>smb.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/samba/smb.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier remplacez tout le texte par:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="nn">[global]</span>
<span class="py">workgroup</span> <span class="p">=</span> <span class="s">HOME</span>
<span class="err">server</span> <span class="py">string</span> <span class="p">=</span> <span class="s">Samba Server %v</span>
<span class="err">server</span> <span class="py">role</span> <span class="p">=</span> <span class="s">standalone server</span>
<span class="err">obey</span> <span class="err">pam</span> <span class="py">restrictions</span> <span class="p">=</span> <span class="s">yes</span>
<span class="err">unix</span> <span class="err">password</span> <span class="py">sync</span> <span class="p">=</span> <span class="s">yes</span>
<span class="err">passwd</span> <span class="py">program</span> <span class="p">=</span> <span class="s">/usr/bin/passwd %u</span>
<span class="err">passwd</span> <span class="py">chat</span> <span class="p">=</span> <span class="s">*Enter</span><span class="se">\s</span><span class="s">new</span><span class="se">\s</span><span class="s">*</span><span class="se">\s</span><span class="s">password:* %n</span><span class="se">\n</span> <span class="s">*Retype</span><span class="se">\s</span><span class="s">new</span><span class="se">\s</span><span class="s">*</span><span class="se">\s</span><span class="s">password:* %n</span><span class="se">\n</span> <span class="s">*password</span><span class="se">\s</span><span class="s">updated</span><span class="se">\s</span><span class="s">successfully* .</span>
<span class="err">pam</span> <span class="err">password</span> <span class="py">change</span> <span class="p">=</span> <span class="s">yes</span>
<span class="err">map</span> <span class="err">to</span> <span class="py">guest</span> <span class="p">=</span> <span class="s">bad user</span>
<span class="err">name</span> <span class="err">resolve</span> <span class="py">order</span> <span class="p">=</span> <span class="s">bcast host</span>
<span class="err">dns</span> <span class="py">proxy</span> <span class="p">=</span> <span class="s">no</span>
<span class="err">usershare</span> <span class="err">allow</span> <span class="py">guests</span> <span class="p">=</span> <span class="s">yes</span>


<span class="nn">[homes]</span>
   <span class="py">comment</span> <span class="p">=</span> <span class="s">Home Directories</span>
   <span class="py">browseable</span> <span class="p">=</span> <span class="s">no</span>
   <span class="err">read</span> <span class="py">only</span> <span class="p">=</span> <span class="s">no</span>
   <span class="err">create</span> <span class="py">mask</span> <span class="p">=</span> <span class="s">0700</span>
   <span class="err">directory</span> <span class="py">mask</span> <span class="p">=</span> <span class="s">0700</span>
   <span class="err">valid</span> <span class="py">users</span> <span class="p">=</span> <span class="s">%S</span>

<span class="nn">[printers]</span>
   <span class="py">comment</span> <span class="p">=</span> <span class="s">All Printers</span>
   <span class="py">browseable</span> <span class="p">=</span> <span class="s">no</span>
   <span class="py">path</span> <span class="p">=</span> <span class="s">/var/spool/samba</span>
   <span class="py">printable</span> <span class="p">=</span> <span class="s">yes</span>
   <span class="err">guest</span> <span class="py">ok</span> <span class="p">=</span> <span class="s">no</span>
   <span class="err">read</span> <span class="py">only</span> <span class="p">=</span> <span class="s">yes</span>
   <span class="err">create</span> <span class="py">mask</span> <span class="p">=</span> <span class="s">0700</span>

<span class="nn">[Public]</span>
   <span class="py">comment</span> <span class="p">=</span> <span class="s">Public File Share</span>
   <span class="py">path</span> <span class="p">=</span> <span class="s">/srv/samba/share</span>
   <span class="py">browsable</span> <span class="p">=</span> <span class="s">yes</span>
   <span class="py">writable</span> <span class="p">=</span> <span class="s">yes</span>
   <span class="err">guest</span> <span class="py">ok</span> <span class="p">=</span> <span class="s">yes</span>
   <span class="err">read</span> <span class="py">only</span> <span class="p">=</span> <span class="s">no</span>
   <span class="err">create</span> <span class="py">mode</span> <span class="p">=</span> <span class="s">0777</span>
   <span class="err">directory</span> <span class="py">mode</span> <span class="p">=</span> <span class="s">0777</span>
   <span class="err">force</span> <span class="py">user</span> <span class="p">=</span> <span class="s">public_user </span><i class="conum" data-value="1"></i><b>(1)</b>
   <span class="err">force</span> <span class="py">group</span> <span class="p">=</span> <span class="s">public_group </span><i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettez ici le username de votre Linux qui possÃ©dera tous les fichiers.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>mettez ici le groupname de votre linux qui possÃ©dera tous les fichiers.</td>
</tr>
</table>
</div>
</li>
<li>
<p>RedÃ©marrez Samba. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service smbd restart
service nmbd restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_installation_dun_serveur_active_directory_domain_controller">6.9.2. Installation d&#8217;un serveur Active Directory Domain Controller</h4>
<div class="paragraph">
<p>Ici nous nous attaquons Ã  une configuration nettement plus complexe qui consiste Ã  mettre en place un serveur active directory basÃ© sur Kerberos et un contrÃ´leur de domaine en Active Directory qui sera muni ensuite de partage de fichiers contrÃ´lÃ©s pas les droits des utilisateurs du domaine:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tout d&#8217;abord, il faut dÃ©clarer le nom de host du DC. Editez le fichier <code>/etc/hosts</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/hosts</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier ajoutez sur l&#8217;adresse IP de votre machine, le nom du DC :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="nn">[ip_address]</span> <span class="err">dc1.home.lan</span> <span class="err">dc1</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez <code>ip_address</code> par l&#8217;adresse IP de votre machine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Installez Samba DC. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install</span> <span class="nt">-y</span> acl attr samba samba-dsdb-modules samba-vfs-modules smbclient winbind libpam-winbind libnss-winbind libpam-krb5 krb5-config krb5-user</code></pre>
</div>
</div>
</li>
<li>
<p>Reconfigurez Samba pour activer la version DC. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl disable <span class="nt">--now</span> smbd nmbd winbind
systemctl unmask samba-ad-dc
systemctl <span class="nb">enable </span>samba-ad-dc
<span class="nb">mv</span> /etc/samba/smb.conf /etc/samba/smb.conf.orig</code></pre>
</div>
</div>
</li>
<li>
<p>Provisionnez votre domaine. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">samba-tool domain provision</code></pre>
</div>
</div>
</li>
<li>
<p>RÃ©pondez aux questions suivantes:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Realm</code> &#8594; inscrivez votre rÃ©seau en majuscules (<code>HOME.LAN</code> par exemple). ne pas choisir <code>LOCAL</code> qui est dÃ©jÃ  utilisÃ© par <code>Avahi</code>.</p>
</li>
<li>
<p><code>Domain</code> &#8594; acceptez la valeur par dÃ©faut</p>
</li>
<li>
<p><code>Server Role</code>&#8594; Laisser la valeur par dÃ©faut</p>
</li>
<li>
<p><code>Dns Backend</code> &#8594; garder la valeur par dÃ©fault</p>
</li>
<li>
<p><code>Dns forwarder</code> &#8594; laissez la valeur par dÃ©faut ou 127.0.1.1 si vous utilisez <code>dnsmasq</code></p>
</li>
<li>
<p><code>Administrator Password</code> &#8594; tapez votre mot de passe administrateur</p>
</li>
</ol>
</div>
</li>
<li>
<p>Editez le fichier <code>/etc/samba/smb.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/samba/smb.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Dans ce fichier, VÃ©rifiez que les informations suivantes sont prÃ©sentes. Ajoutez les sinon :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Global parameters</span>
<span class="o">[</span>global]
        dns forwarder <span class="o">=</span> <span class="o">[</span>IP_DNS] <i class="conum" data-value="1"></i><b>(1)</b>
        netbios name <span class="o">=</span> DC
        realm <span class="o">=</span> HOME.LAN <i class="conum" data-value="2"></i><b>(2)</b>
        server role <span class="o">=</span> active directory domain controller
        workgroup <span class="o">=</span> HOME <i class="conum" data-value="3"></i><b>(3)</b>
        interfaces <span class="o">=</span> wlan0 eth0 lo
        <span class="nb">bind </span>interfaces only <span class="o">=</span> <span class="nb">yes
        </span>template shell <span class="o">=</span> /bin/bash
        template homedir <span class="o">=</span> /home/%U

<span class="o">[</span>sysvol]
        path <span class="o">=</span> /var/lib/samba/sysvol
        <span class="nb">read </span>only <span class="o">=</span> No

<span class="o">[</span>netlogon]
        path <span class="o">=</span> /var/lib/samba/sysvol/home.lan/scripts
        <span class="nb">read </span>only <span class="o">=</span> No

<span class="o">[</span>homes]
   comment <span class="o">=</span> Home Directories
   browseable <span class="o">=</span> no
   <span class="nb">read </span>only <span class="o">=</span> no
   create mask <span class="o">=</span> 0700
   directory mask <span class="o">=</span> 0700
   valid <span class="nb">users</span> <span class="o">=</span> %S

<span class="o">[</span>printers]
   comment <span class="o">=</span> All Printers
   browseable <span class="o">=</span> no
   path <span class="o">=</span> /var/spool/samba
   printable <span class="o">=</span> <span class="nb">yes
   </span>guest ok <span class="o">=</span> no
   <span class="nb">read </span>only <span class="o">=</span> <span class="nb">yes
   </span>create mask <span class="o">=</span> 0700

<span class="o">[</span>Public]
   comment <span class="o">=</span> Public File Share
   path <span class="o">=</span> /srv/samba/share
   browsable <span class="o">=</span> <span class="nb">yes
   </span>writable <span class="o">=</span> <span class="nb">yes
   </span>guest ok <span class="o">=</span> <span class="nb">yes
   read </span>only <span class="o">=</span> no
   create mode <span class="o">=</span> 0777
   directory mode <span class="o">=</span> 0777
   force user <span class="o">=</span> public_user <i class="conum" data-value="4"></i><b>(4)</b>
   force group <span class="o">=</span> public_group <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez <code>IP_DNS</code> par 127.0.0.1. Si vous dÃ©cidez d&#8217;utiliser le DC de samba conjointement avec <code>dnsmasq</code>, vous devez mettre 127.0.1.1. voir plus bas pour le reste de la configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>ici vous retrouvez le Realm configurÃ© plus haut</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>et le domaine configurÃ© plus haut.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>mettez ici le username de votre Linux qui possÃ©dera tous les fichiers.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>mettez ici le groupname de votre linux qui possÃ©dera tous les fichiers.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configurez la synchronisation temporelle (voir plus bas)</p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mv</span> /etc/krb5.conf /etc/krb5.conf.orig
<span class="nb">cp</span> /var/lib/samba/private/krb5.conf /etc/krb5.conf</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©marrez <code>Samba</code>. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart samba-ad-dc
systemctl status samba-ad-dc</code></pre>
</div>
</div>
</li>
<li>
<p>Activez winbind dans le NSS. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/nsswitch.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Puis dans le fichier changez les lignes suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">passwd:</span> <span class="err">files</span> <span class="err">winbind</span>
<span class="err">group:</span>  <span class="err">files</span> <span class="err">winbind</span></code></pre>
</div>
</div>
</li>
<li>
<p>VÃ©rification des rÃ©solutions d&#8217;hotes. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">host <span class="nt">-t</span> A home.lan <i class="conum" data-value="1"></i><b>(1)</b>
host <span class="nt">-t</span> SRV _kerberos._udp.home.lan <i class="conum" data-value="1"></i><b>(1)</b>
host <span class="nt">-t</span> SRV _ldap._tcp.home.lan <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez home.lan par votre nom de realm configurÃ© plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>En rÃ©sultat les trois commandes host doivent envoyer une rÃ©solution correcte.</p>
</li>
<li>
<p>VÃ©rifier que samba est actif et que les partages sysvol et netlogin sont corrects. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">smbclient <span class="nt">-L</span> home.lan <span class="nt">-N</span></code></pre>
</div>
</div>
</li>
<li>
<p>Vous devez voir au moins les deux partages listÃ©s.</p>
</li>
<li>
<p>CrÃ©ez une zone de recherche inversÃ©e. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">samba-tool dns zonecreate DC1 1.27.172.in-addr.arpa <span class="nt">--username</span><span class="o">=</span>administrator   <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>DC1 : Nom de votre serveur</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>1.27.172.in-addr.arpa : Adresse du sous rÃ©seau inversÃ©e. (Le sous rÃ©seau Ã©tait 172.27.1.0. A remplacer par celui de votre rÃ©seau rÃ©el).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>username : Compte ayant lâautorisation de crÃ©er la zone. Un mot de passe sera demandÃ©.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Maintenant vous devez vous authentifier sur Kerberos avec le login <code>administrator</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">kinit administrator@HOME.LAN <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez home.lan par votre nom de realm configurÃ© plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Tapez ensuite votre mot de passe administrateur.</p>
</li>
<li>
<p>Changez l&#8217;expiration du mot de passe. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">samba-tool user setexpiry administrator <span class="nt">--noexpiry</span></code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez des utilisateurs. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">samba-tool user create user1 user1_password <i class="conum" data-value="1"></i><b>(1)</b>
samba-tool user setexpiry user1 <span class="nt">--noexpiry</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>user1</code> par votre nom de nouvel utilisateur et <code>user1_password</code> par son mot de passe.</td>
</tr>
</table>
</div>
</li>
<li>
<p>AprÃ¨s avoir ajoutÃ© tous vos utilisateurs vous pouvez lister ceux configurÃ©s. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">samba-tool user list</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_mise_en_place_dun_serveur_membre_du_domaine">6.9.3. Mise en place d&#8217;un serveur membre du domaine</h4>
<div class="paragraph">
<p>Cette procÃ©dure explique comme ajouter un serveur membre du domaine.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Normalement, le serveur DHCP s&#8217;il est configurÃ© correctement doit configurer le serveur DNS du membre de domaine. Si ce n&#8217;est pas le cas il faudra appliquer la procÃ©dure ci aprÃ¨s :</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>editez le fichier <code>/etc/resolv.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/resolv.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier, InsÃ©rez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">nameserver</span> <span class="nn">[Adresse_ip]</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="err">search</span> <span class="err">home.lan</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez Adresse_ip par l&#8217;adresse IP de votre DC</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>indiquer ici le nom de domaine de votre realm (en minuscules)</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Installez Samba. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install</span> <span class="nt">-y</span> acl attr samba samba-dsdb-modules samba-vfs-modules smbclient winbind libpam-winbind libnss-winbind libpam-krb5 krb5-config krb5-user</code></pre>
</div>
</div>
</li>
<li>
<p>Configurez Kerberos. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/krb5.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier insÃ©rez les lignes suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">[</span>libdefaults]
	default_realm <span class="o">=</span> HOME.LAN
	dns_lookup_realm <span class="o">=</span> <span class="nb">false
	</span>dns_lookup_kdc <span class="o">=</span> <span class="nb">true</span></code></pre>
</div>
</div>
</li>
<li>
<p>Configurez la synchronisation temporelle (voir plus bas)</p>
</li>
<li>
<p>Editez le fichier <code>/etc/samba/smb.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/samba/smb.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Dans ce fichier, VÃ©rifiez que les informations suivantes sont prÃ©sentes. Ajoutez les sinon :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="c"># Global parameters
</span><span class="nn">[global]</span>
        <span class="py">security</span> <span class="p">=</span> <span class="s">ADS</span>
        <span class="py">realm</span> <span class="p">=</span> <span class="s">HOME.LAN </span><i class="conum" data-value="1"></i><b>(1)</b>
        <span class="py">workgroup</span> <span class="p">=</span> <span class="s">HOME </span><i class="conum" data-value="2"></i><b>(2)</b>
        <span class="py">interfaces</span> <span class="p">=</span> <span class="s">wlan0 eth0 lo</span>
        <span class="err">bind</span> <span class="err">interfaces</span> <span class="py">only</span> <span class="p">=</span> <span class="s">yes</span>
        <span class="err">username</span> <span class="py">map</span> <span class="p">=</span> <span class="s">/etc/samba/user.map</span>
<span class="nn">[printers]</span>
   <span class="py">comment</span> <span class="p">=</span> <span class="s">All Printers</span>
   <span class="py">browseable</span> <span class="p">=</span> <span class="s">no</span>
   <span class="py">path</span> <span class="p">=</span> <span class="s">/var/spool/samba</span>
   <span class="py">printable</span> <span class="p">=</span> <span class="s">yes</span>
   <span class="err">guest</span> <span class="py">ok</span> <span class="p">=</span> <span class="s">no</span>
   <span class="err">read</span> <span class="py">only</span> <span class="p">=</span> <span class="s">yes</span>
   <span class="err">create</span> <span class="py">mask</span> <span class="p">=</span> <span class="s">0700</span>

<span class="nn">[Public]</span>
   <span class="py">comment</span> <span class="p">=</span> <span class="s">Public File Share</span>
   <span class="py">path</span> <span class="p">=</span> <span class="s">/srv/samba/share</span>
   <span class="py">browsable</span> <span class="p">=</span> <span class="s">yes</span>
   <span class="py">writable</span> <span class="p">=</span> <span class="s">yes</span>
   <span class="err">guest</span> <span class="py">ok</span> <span class="p">=</span> <span class="s">yes</span>
   <span class="err">read</span> <span class="py">only</span> <span class="p">=</span> <span class="s">no</span>
   <span class="err">create</span> <span class="py">mode</span> <span class="p">=</span> <span class="s">0777</span>
   <span class="err">directory</span> <span class="py">mode</span> <span class="p">=</span> <span class="s">0777</span>
   <span class="err">force</span> <span class="py">user</span> <span class="p">=</span> <span class="s">public_user </span><i class="conum" data-value="3"></i><b>(3)</b>
   <span class="err">force</span> <span class="py">group</span> <span class="p">=</span> <span class="s">public_group </span><i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez HOME.LAN par le Realm configurÃ© plus haut.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>et le domaine configurÃ© plus haut.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>mettez ici le username de votre Linux qui possÃ©dera tous les fichiers.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>mettez ici le groupname de votre linux qui possÃ©dera tous les fichiers.</td>
</tr>
</table>
</div>
</li>
<li>
<p>CrÃ©ez le fichier <code>user.map</code> afin de mapper l&#8217;utilisateur Linux Root sur le compte Windows Administrateur. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/samba/user.map</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez dans ce fichier ceci:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">!</span><span class="py">root</span> <span class="p">=</span> <span class="s">HOME</span><span class="se">\A</span><span class="s">dministrator </span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez HOME par le domaine configurÃ© plus haut</td>
</tr>
</table>
</div>
</li>
<li>
<p>Joignez le domaine. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">samba-tool domain <span class="nb">join </span>home.lan MEMBER <span class="nt">-U</span> administrator <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez home.lan par le Realm configurÃ© plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>AprÃ¨s avoir tapÃ© votre mot de passe, <code>samba</code> indiquez que vous avez joint le domaine.</p>
</li>
<li>
<p>Activez winbind dans le NSS. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/nsswitch.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Puis dans le fichier changez les lignes suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">passwd:</span> <span class="err">files</span> <span class="err">winbind</span>
<span class="err">group:</span>  <span class="err">files</span> <span class="err">winbind</span></code></pre>
</div>
</div>
</li>
<li>
<p>redÃ©marrez les services Samba. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service smbd restart
service nmbd restart
service winbindd restart</code></pre>
</div>
</div>
</li>
<li>
<p>Testez winbindd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">wbinfo <span class="nt">--ping-dc</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_mise_en_place_dune_synchronisation_temporelle_du_serveur">6.9.4. Mise en place d&#8217;une synchronisation temporelle du serveur</h4>
<div class="paragraph">
<p>Pour que samba avec un DC fonctionne correctement, il faut que le serveur soit correctement synchronisÃ©.
A noter qu&#8217;il est bien d&#8217;une maniÃ¨re gÃ©nÃ©rale de synchroniser les serveurs.</p>
</div>
<div class="paragraph">
<p>Cette procÃ©dure est Ã  appliquer sur le DC et sur le membre du domaine :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez chrony. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>chrony</code></pre>
</div>
</div>
</li>
<li>
<p>Configurez <code>chrony</code> pour fonctionner avec <code>kerberos</code>. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chown </span>root:_chrony /var/lib/samba/ntp_signd/
<span class="nb">chmod </span>750 /var/lib/samba/ntp_signd/</code></pre>
</div>
</div>
</li>
<li>
<p>Editez le fichier <code>chrony.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/chrony/chrony.conf</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez ou modifier dans les fichiers les lignes pour avoir:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># bind the chrony service to IP address of the Samba AD</span>
bindcmdaddress <span class="o">[</span>adresse_ip] <i class="conum" data-value="1"></i><b>(1)</b>
<span class="c"># allow clients on the network to connect to the Chrony NTP server</span>
allow <span class="o">[</span>subnet]/24 <i class="conum" data-value="2"></i><b>(2)</b>

<span class="c"># specify the ntpsigndsocket directory for the Samba AD</span>
ntpsigndsocket /var/lib/samba/ntp_signd</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettez ici l&#8217;adresse IP de l' AD de votre serveur samba</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>mettez ici l&#8217;adresse du sous rÃ©seau.</td>
</tr>
</table>
</div>
</li>
<li>
<p>RedÃ©marrez <code>chrony</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart chronyd
systemctl status chronyd</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_avec_dnsmasq_ou_pi_hole">6.9.5. Configuration avec DNSMASQ ou PI-HOLE</h4>
<div class="paragraph">
<p>L&#8217;utilisation avec DNSMASQ ou PI-HOLE est tout Ã  fait possible</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Editez le fichier <code>07-dhcp-options.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/samba/smb.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier ajoutez dans la section <code>[global]</code> la ligne suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini">        <span class="err">dns</span> <span class="py">forwarder</span> <span class="p">=</span> <span class="s">[IP_DNS] </span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez <code>IP_DNS</code> par 127.0.1.1.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Ajoutez ensuite une rÃ¨gle de forwarding de firewall. Editez le fichier <code>iptables.up.rules</code></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/iptables.up.rules</code></pre>
</div>
</div>
</li>
<li>
<p>Inserez Ã  la fin du fichier la ligne suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nt">-A</span> OUTPUT <span class="nt">-d</span> 127.0.1.1/32 <span class="nt">-p</span> udp <span class="nt">-m</span> udp <span class="nt">--dport</span> 53 <span class="nt">-j</span> DNAT <span class="nt">--to-destination</span> 127.0.0.1:5353</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez une interface de loopback.</p>
</li>
<li>
<p>Editez <code>/etc/network/interfaces.d/lo1</code></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># loopback dns</span>
auto lo:0
   iface lo:0 inet static
   address 127.0.1.1</code></pre>
</div>
</div>
</li>
<li>
<p>Tapez ensuite:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ufw allow 53/udp</code></pre>
</div>
</div>
</li>
<li>
<p>Rebooter votre serveur. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">reboot</code></pre>
</div>
</div>
<div class="paragraph">
<p>=== Modification de la configuration DHCP DNSMASQ</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Si vous utilisez <code>DHCP</code> ou <code>DNSMASQ</code>, il est nÃ©cessaire de modifier la configuration du <code>DHCP</code> pour que les informations sur le serveur de fichier soit correctement diffusÃ©es.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Editez le fichier <code>07-dhcp-options.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/dnsmasq.d/07-dhcp-options.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier, ajoutez les donnÃ©es suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="py">dhcp-option</span><span class="p">=</span><span class="s">44,[ip_address]     # set netbios-over-TCP/IP nameserver(s) aka WINS server(s) </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="py">dhcp-option</span><span class="p">=</span><span class="s">45,[ip_address]      # netbios datagram distribution server </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="py">dhcp-option</span><span class="p">=</span><span class="s">46,8           # netbios node type</span>
<span class="py">dhcp-option</span><span class="p">=</span><span class="s">47             # netbios TCP Scope on</span>
<span class="py">port</span><span class="p">=</span><span class="s">5353 </span><i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettez Ã  la place de <code>[ip_address]</code> l&#8217;adresse IP de votre serveur samba.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>cette ligne est Ã  mettre si vous avez une configuration DNSMASQ. Elle n&#8217;est pas utile pour un serveur dhcp standard.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="guest_samba">6.9.6. AccÃ¨s "Guest"</h4>
<div class="paragraph">
<p>Sous Windows 10 et 11, l&#8217;accÃ¨s Guest est dÃ©sactivÃ© par dÃ©faut sur les postes utilisateurs. Il vous faudra autoriser cet accÃ¨s.</p>
</div>
<div class="paragraph">
<p>Pour cela:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Lancez l&#8217;outil regedit.exe</p>
</li>
<li>
<p>Allez dans la clÃ© <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters</code></p>
</li>
<li>
<p>CrÃ©ez une clÃ© <code>AllowInsecureGuestAuth</code> de type <code>dword</code>.</p>
</li>
<li>
<p>Editez la clÃ© <code>AllowInsecureGuestAuth</code> et mettez la valeur 1.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scan_des_vulnÃ©rabilitÃ©s">6.10. Scan des vulnÃ©rabilitÃ©s</h3>
<div class="sect3">
<h4 id="_installation_dun_scanner_de_vulnÃ©rabilitÃ©s_lynis">6.10.1. Installation d&#8217;un scanner de vulnÃ©rabilitÃ©s Lynis</h4>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>installer Git. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>git</code></pre>
</div>
</div>
</li>
<li>
<p>installer Lynis</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd
</span>git clone https://github.com/CISOfy/lynis</code></pre>
</div>
</div>
</li>
<li>
<p>Executez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd </span>lynis<span class="p">;</span>./lynis audit system</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>L&#8217;outil vous listera dans une forme trÃ¨s synthÃ©tique la liste des vulnÃ©rabilitÃ©s et des amÃ©liorations de sÃ©curitÃ© Ã  appliquer.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_upgrade_de_lynis">6.10.2. Upgrade de Lynis</h4>
<div class="paragraph">
<p>Pour effectuer la mise Ã  jour de Lynis appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd
cd </span>lynis
git pull</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_systÃ¨me_dadministration_webmin">7. Installation du systÃ¨me d&#8217;administration Webmin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Webmin est un outil gÃ©nÃ©raliste de configuration de votre serveur. Son usage peut Ãªtre assez complexe mais il permet une configuration plus prÃ©cise des fonctionnalitÃ©s.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ajoutez le repository Webmin</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>allez dans le rÃ©pertoire des repositories. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /etc/apt/sources.list.d</code></pre>
</div>
</div>
</li>
<li>
<p>Tapez: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo</span> <span class="s2">"deb http://download.webmin.com/download/repository sarge contrib"</span> <span class="o">&gt;&gt;</span> webmin.list</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez la clÃ©. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /etc/apt/trusted.gpg.d
wget http://www.webmin.com/jcameron-key.asc</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Mise Ã  jour. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt update</code></pre>
</div>
</div>
</li>
<li>
<p>Installation de Webmin. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>webmin</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#firewall">Debloquez le port 10000 sur votre firewall</a></p>
</li>
<li>
<p>Changer le nom du user admin</p>
</li>
<li>
<p>Editez le fichier <code>miniserv.users</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/webmin/miniserv.users</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier remplacer le texte <code>root</code> par le nom de votre &lt;sudo_username&gt;.</p>
</li>
<li>
<p>De la mÃªme maniÃ¨re, Ã©diter le fichier <code>webmin.acl</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/webmin/webmin.acl</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier remplacer le texte <code>root</code> par le nom de votre &lt;sudo_username&gt;.</p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service webmin restart</code></pre>
</div>
</div>
</li>
<li>
<p>Connectez vous avec votre navigateur sur l&#8217;url <a href="https://&lt;example.com&gt;:10000" class="bare">https://&lt;example.com&gt;:10000</a>. Un message indique un problÃ¨me de sÃ©curitÃ©. Cela vient du certificat auto-signÃ©. Cliquez sur 'AvancÃ©' puis 'Accepter le risque et poursuivre'.</p>
</li>
<li>
<p>Loguez-vous &lt;sudo_username&gt;. Tapez le mot de passe de <code>&lt;sudo_username&gt;</code>. Le dashboard s&#8217;affiche.</p>
</li>
<li>
<p>Restreignez l&#8217;adressage IP</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Obtenez votre adresse IP en allant par exemples sur le site <a href="https://www.showmyip.com/" class="bare">https://www.showmyip.com/</a></p>
</li>
<li>
<p>Sur votre URL Webmin ou vous Ãªtes loguÃ©, allez dans Webmin&#8594;Webmin Configuration</p>
</li>
<li>
<p>Dans l&#8217;Ã©cran choisir lâicÃ´ne <code>Ip Access Control</code>.</p>
</li>
<li>
<p>Choisissez <code>Only allow from listed addresses</code></p>
</li>
<li>
<p>Puis dans le champ <code>Allowed IP addresses</code> tapez votre adresse IP rÃ©cupÃ©rÃ©e sur showmyip</p>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
<li>
<p>Vous devriez avoir une brÃ¨ve dÃ©connexion le temps que le serveur Webmin redÃ©marre puis une reconnexion.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Si vous n&#8217;arrivez pas Ã  vous reconnecter c&#8217;est que l&#8217;adresse IP n&#8217;est pas la bonne. Le seul moyen de se reconnecter est de:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ãditez le fichier /etc/webmin/miniserv.conf et supprimez la ligne <code>allow= &#8230;&#8203;</code></p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service webmin restart</code></pre>
</div>
</div>
</li>
<li>
<p>Connectez vous sur l&#8217;url de votre site Webmin. Tout doit fonctionner</p>
</li>
</ol>
</div>
</li>
<li>
<p>ComplÃ©ments de configuration</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Pour augmenter la sÃ©curitÃ©, vous pouvez dÃ©sactiver le login <code>sudo_username</code> et crÃ©er un autre compte admin en allant dans: <code>Webmin</code> &#8594; <code>Webmin Users</code> &#8594; <code>Create a new privileged user</code>. Pour le user <code>sudo_username</code>, modifier le <code>Password</code> en mettant <code>No password accepted</code></p>
</li>
<li>
<p>Allez dans <code>Webmin</code> &#8594; <code>Webmin Configuration</code> &#8594; <code>SSL Encryption</code> &#8594; onglet <code>Let&#8217;s Encrypt</code> &#8594; <code>Request Certificate</code>. Attention cette opÃ©ration ne fonctionne que si le serveur est disponible sur internet.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Passez en FranÃ§ais. Pour les personnes non anglophone. Les traductions franÃ§aise ont des problÃ¨mes d&#8217;encodage de caractÃ¨re ce n&#8217;est donc pas recommandÃ©. La suite de mon tutoriel suppose que vous Ãªtes restÃ© en anglais.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Sur votre url Webmin ou vous Ãªtes loguÃ©, allez dans Webmin&#8594;Webmin Configuration</p>
</li>
<li>
<p>Dans l&#8217;Ã©cran choisir lâicÃ´ne <code>Language and Locale</code>.</p>
</li>
<li>
<p>Choisir <code>Display Language</code> Ã  <code>French (FR.UTF-8)</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_de_apt_cacher">8. Configuration de Apt-cacher</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;outil apt-cacher est un systÃ¨me de cache des paquets debian apt.</p>
</div>
<div class="paragraph">
<p>Si vous avez plusieurs machines utilisant debian ou ubuntu sur votre rÃ©seau, les mises Ã  jour seront considÃ©rablement accÃ©lÃ©rÃ©es par l&#8217;utilisation de ce systÃ¨me de cache.</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez le package apt-cacher. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>apt-cacher-ng</code></pre>
</div>
</div>
</li>
<li>
<p>dans le menu de configuration, choisissez: pas de configuration automatique.</p>
</li>
<li>
<p>A la configuration du serveur mandataire, tapez entrÃ©e</p>
</li>
<li>
<p>A la configuration des adresses locales et des ports tapez entrÃ©e.</p>
</li>
<li>
<p>enfin autorisez la crÃ©ation de tunnels HTTP</p>
</li>
<li>
<p>Ãditez le fichier de configuration :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/apt-cacher-ng/acng.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Dans ce fichier, recherchez et dÃ©commentez les lignes suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>CacheDir: /var/cache/apt-cacher-ng
LogDir: /var/log/apt-cacher-ng
ReportPage: acng-report.html
PidFile: /var/run/apt-cacher-ng/pid
ExThreshold: 4</code></pre>
</div>
</div>
</li>
<li>
<p>si vous vous avez des repositories particuliers Ã  cacher, vous pouvez Ã©diter le fichier <code>/etc/apt-cacher-ng/backends_other.default</code> et ajouter dedans les repositories, comme par exemple: <code><a href="https://download.docker.com/linux/debian" class="bare">https://download.docker.com/linux/debian</a></code></p>
</li>
<li>
<p>redÃ©marrez le service. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/etc/init.d/apt-cacher-ng restart</code></pre>
</div>
</div>
</li>
<li>
<p>pointez maintenant votre navigateur sur l&#8217;adresse: <a href="http://homeserver.local:3142/" class="bare">http://homeserver.local:3142/</a></p>
</li>
<li>
<p>une page d&#8217;explication de la configuration d&#8217;apt cacher pour les postes clients s&#8217;affiche dans le navigateur.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Sur les postes clients linux:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le poste client</a></p>
</li>
<li>
<p>installez le paquet d&#8217;autodÃ©ction du proxy apt:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt-get <span class="nb">install </span>squid-deb-proxy-client</code></pre>
</div>
</div>
</li>
<li>
<p>Une autre possibilitÃ© est d&#8217;indiquer explicitement l&#8217;adresse du serveur. Dans ce cas, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo</span> <span class="s1">'Acquire::http::Proxy "http://homeserver.local:3142";'</span> <span class="o">&gt;</span> /etc/apt/apt.conf.d/02proxy <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez homeserver.local par le nom de votre serveur proxy pour les paquets apt.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_de_docker_et_des_outils_associÃ©s">9. Installation de Docker et des outils associÃ©s</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le logiciel <code>Docker</code> est une technologie de conteneurisation qui permet la crÃ©ation et l&#8217;utilisation de conteneurs Linux.
En clair, <code>Docker</code> permet d&#8217;installer et de configurer rapidement toute une appli web complexe dans un environnement isolÃ© et avec tout son Ã©chosystÃ¨me de bibliothÃ¨ques logicielles spÃ©cifiques.</p>
</div>
<div class="paragraph">
<p>Il est ainsi possible d&#8217;effectuer rapidement des installations, de suivre des mises Ã  jours et d&#8217;isoler ces environnements du systÃ¨me principal.</p>
</div>
<div class="sect2">
<h3 id="_a_propos_des_raspberry_pi">9.1. A propos des Raspberry Pi</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Les raspberry utilisent une architecture ARM, tous les containeurs ne seront pas forcÃ©ment compatibles "out of the box" ( Exemple pour MySQL). Sur le <a href="https://hub.docker.com/">Docker Hub</a>, il faut choisir par un Raspberry Pi 4 en Ubuntu une architecture de type ARM64 et pour un Raspberry Pi 3 en Raspbian une architecture de type ARM.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_docker">9.2. Installation de Docker</h3>
<div class="paragraph">
<p>L&#8217;installation de Docker est relativement simple.</p>
</div>
<div class="paragraph">
<p>Il faut suivre les Ã©tapes suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>DÃ©sinstallez les Ã©ventuelles anciennes versions de docker. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt remove <span class="nt">--purge</span> docker docker-engine docker.io containerd runc <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>docker-engine n&#8217;existe pas dans une distribution ubuntu. C&#8217;est Ã  enlever.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt update
apt <span class="nb">install </span>apt-transport-https ca-certificates curl gnupg-agent software-properties-common
<span class="nb">cd</span> /etc/apt/trusted.gpg.d
wget <span class="nt">-O</span> docker.asc https://download.docker.com/linux/debian/gpg</code></pre>
</div>
</div>
</li>
<li>
<p>tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">lsb_release <span class="nt">-cs</span></code></pre>
</div>
</div>
</li>
<li>
<p>Ici la version de votre distribution doit s&#8217;afficher.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
pour des installations hybride d&#8217;une distribution debian, la version qui est proposÃ©e peut Ãªtre la future SID ou la Testing pour lesquelles il n&#8217;existe pas obligatoirement de version installable de docker. Dans ce cas vous devrez sÃ©lectionner vous mÃªme la version de la distribution stable.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Tapez (et remplacer Ã©ventuellement la commande $(lsb_release -cs) par le nom de votre distribution stable).  :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">add-apt-repository <span class="s2">"deb [arch=amd64] https://download.docker.com/linux/debian </span><span class="si">$(</span>lsb_release <span class="nt">-cs</span><span class="si">)</span><span class="s2"> stable"</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ici il faut remplacer l&#8217;architecture <code>amd64</code> par <code>arm64</code> pour un raspberry pi 4  ou par <code>armhf</code> pour un raspberry pi 3. De la mÃªme maniÃ¨re, remplacez debian par ubuntu si vous utilisez une distribution ubuntu/</td>
</tr>
</table>
</div>
</li>
<li>
<p>Une fois installÃ© avec succÃ¨s, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt update</code></pre>
</div>
</div>
</li>
<li>
<p>Si vous obtenez une erreur c&#8217;est que vous avez ajoutÃ© un repository qui n&#8217;est pas suppportÃ© par Docker. VÃ©rifiez les fichier <code>/etc/apt/sources.list</code>.</p>
</li>
<li>
<p>Une fois mis Ã  jour avec succÃ¨s, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>docker-ce docker-ce-cli containerd.io</code></pre>
</div>
</div>
</li>
<li>
<p>vÃ©rifiez que votre installation de <code>Docker</code> est fonctionnelle. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run hello-world</code></pre>
</div>
</div>
</li>
<li>
<p>Cette commande exÃ©cute un conteneur simple. Si aucune erreur nâapparaÃ®t c&#8217;est que l&#8217;installation est rÃ©ussie.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_docker_compose">9.3. Installation de docker-compose</h3>
<div class="paragraph">
<p>Docker-compose est un outil qui aide Ã  l&#8217;installation de plusieurs container de faÃ§on simultanÃ©. Il permet surtout de vÃ©rifier que l&#8217;Ã©chosystÃ¨me installÃ© interagit bien.</p>
</div>
<div class="paragraph">
<p>Il faut suivre les Ã©tapes suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez quelques paquets Debian de base. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>libffi-dev libssl-dev
apt <span class="nb">install</span> <span class="nt">-y</span> python3 python3-pip <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Pour Ubuntu, remplacez ces paquets par <code>python</code> et <code>python-pip</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Installez docker-compose :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">pip3 <span class="nb">install </span>docker-compose</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_docker_swarm">9.4. Installation de docker swarm</h3>
<div class="paragraph">
<p>Docker contient nativement le mode Swarm afin de gÃ©rer un ensemble de Docker Engines.
Cette installation est optionnelle puisque l&#8217;on peut faire fonctionner Docker sans cette Option.</p>
</div>
<div class="paragraph">
<p>Il y a deux types de machines: les <strong>Managers</strong> et les <strong>Workers</strong>.</p>
</div>
<div class="paragraph">
<p>Les managers : Ce sont les nodes gestionnaires de votre cluster. Ils distribuent les tÃ¢ches aux nodes workers et ils effectuent Ã©galement les fonctions d&#8217;orchestration et de gestion.</p>
</div>
<div class="paragraph">
<p>Les workers : Ils vont exÃ©cuter les tÃ¢ches confiÃ©es par les managers. Un agent s&#8217;exÃ©cute sur chaque nÅud et rend compte des tÃ¢ches qui lui sont affectÃ©es. Il informe ainsi les nodes managers de l&#8217;Ã©tat des tÃ¢ches affectÃ©es.</p>
</div>
<div class="paragraph">
<p>Il faut suivre les Ã©tapes suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker swarm init</code></pre>
</div>
</div>
</li>
<li>
<p>Le rÃ©sultat de la commande donne la commande <code>docker swarm join</code> a exÃ©cuter sur un "worker"  pour lui faire rejoindre le "swarm". A noter que le "manager" que nous venons de creer est aussi un worker. De ce fait, un swarm peut Ãªtre installÃ© de faÃ§on standalone sur un VPS.</p>
</li>
<li>
<p>Vous pouvez maintenant vÃ©rifier l&#8217;Ã©tat de votre cluster. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker node <span class="nb">ls</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_choix_des_images_docker">9.5. Choix des images docker</h3>
<div class="paragraph">
<p>Les images docker sont accessibles sur le <a href="https://hub.docker.com/">Docker Hub</a>.</p>
</div>
<div class="paragraph">
<p>Mais voilÃ , c&#8217;est un peu la jungle. Un bon moyen de trouver des images Ã  jour d&#8217;un point de vue sÃ©curitÃ© et non compromises est de ne sÃ©lectionner que des images "Docker Certified" ou "Verified Publisher" ou "Official Images".</p>
</div>
<div class="paragraph">
<p>Du moins on est sÃ»r que ces images ont Ã©tÃ© Ã  minima vÃ©rifiÃ©es par les Ã©quipes Docker.</p>
</div>
<div class="paragraph">
<p>Pour mÃ©moire: <strong>Le nombre de chargement d&#8217;une image n&#8217;est pas un gage de qualitÃ© !</strong></p>
</div>
<div class="paragraph">
<p>Si vous n&#8217;utilisez pas une image du type mentionnÃ© ci dessus, l&#8217;accÃ¨s facile au fichier Dockerfile est un gage de qualitÃ© et de transparence. En tout cas, il vous sera facilement possible de regarder comment l&#8217;image est construite et quels sont les package dockers de base et si ces packages dockers de base sont rÃ©cents et certifiÃ©s.</p>
</div>
<div class="paragraph">
<p>Pour les plateformes de type Raspberry, il faut bien vÃ©rifier que l&#8217;image docker que vous chargez est compatible de votre plateforme. Sur Docker Hub, vous devez allez sur l&#8217;onglet Tag de votre package et vÃ©rifier que le champ OS/ARCH contient bien votre plateforme.</p>
</div>
<div class="paragraph">
<p>Pour un Raspberry Pi 4 ce doit Ãªtre: <code>Linux/arm64</code></p>
</div>
<div class="paragraph">
<p>Pour un Raspberry Pi 3 ce doit Ãªtre: <code>Linux/arm</code></p>
</div>
<div class="paragraph">
<p>Par exemple pour les docker de <code>Yacht</code> et de <code>Portainer</code> dÃ©crits ci aprÃ¨s, on peut voir que les containers sont multiplateforme et conviennent trÃ¨s bien pour de l&#8217;Intel ou de l&#8217;ARM.</p>
</div>
</div>
<div class="sect2">
<h3 id="_considÃ©rations_de_sÃ©curitÃ©">9.6. ConsidÃ©rations de sÃ©curitÃ©</h3>
<div class="paragraph">
<p>A propos de l&#8217;export des ports sous docker.</p>
</div>
<div class="paragraph">
<p>Par dÃ©faut lorsque vous lancez un container docker, l&#8217;option pour exporter un port de votre docker vers votre machine est <code>-p dst_port:src_port</code>.
Si vous indiquez uniquement le port de destination comme par exemple dans <code>-p 80:8080</code> qui exporte le port 8080 de votre docker vers le port 80 de votre machine rÃ©elle, vous exporter vers le port 80 de l&#8217;adresse IP 0.0.0.0 ce qui en pratique indique que vous n&#8217;utilisez pas les rÃ¨gles du firewall; le port est exportÃ© automatiquement sur toutes les interfaces.</p>
</div>
<div class="paragraph">
<p>De ce fait, vous exposez tous les ports interne de votre systÃ¨me docker Ã  tout internet et le firewall ne bloque rien pour ces ports.</p>
</div>
<div class="paragraph">
<p>Il est donc indispensable pour une machine directement exposÃ©e sur internet d&#8217;indiquer l&#8217;adresse du loopback en indiquant systÃ©matiquement l&#8217;adresse IP soit <code>-p 127.0.0.1:80:8080</code>. Ainsi les rÃ¨gles du firewall sont appliquÃ©es et vous pourrez par votre configuration d&#8217;ISPconfig n&#8217;exposer que les ports et noms de domaines nÃ©cessaires.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Dans tout ce qui suit nous omettrons d&#8217;utiliser cette adresse en 127.0.0.1 . Pensez bien donc Ã  ajouter cette adresse systÃ©matiquement pour un serveur prÃ©sent sur le web !
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_mise_Ã _jour_automatique_des_images">9.7. Mise Ã  jour automatique des images</h3>
<div class="paragraph">
<p>Vos images docker peuvent Ãªtre mise Ã  jour automatiquement si vous les avez installÃ©s Ã  partir du docker hub ou de n&#8217;importe quel autre repository compatible.</p>
</div>
<div class="paragraph">
<p>Un outil automatise cette mise Ã  jour c&#8217;est <a href="https://github.com/containrrr/watchtower">watchtower</a>.</p>
</div>
<div class="paragraph">
<p>Pour l&#8217;installer, rien de plus simple:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-d</span> <span class="nt">--name</span> watchtower <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock containrrr/watchtower <span class="nt">--cleanup</span> <span class="nt">--interval</span> 86400</code></pre>
</div>
</div>
</li>
<li>
<p>l&#8217;option cleanup effectue le mÃ©nage des images inutiles et interval indique en secondes le temps Ã  attendre entre deux vÃ©rifications (ici 24h)</p>
</li>
<li>
<p>si vous voulez vous connecter Ã  un repository avec un login et un mot de passe, vous pouvez ajouter au lancement du docker les options suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nt">-e</span> <span class="nv">REPO_USER</span><span class="o">=</span>username <span class="nt">-e</span> <span class="nv">REPO_PASS</span><span class="o">=</span>password</code></pre>
</div>
</div>
</li>
<li>
<p>Si vous dÃ©sirez ne mettre Ã  jour que certains containers, vous pouvez passer l&#8217;option <code>--label-enable</code> et ensuite dÃ©signer les container Ã  mettre Ã  jour en leur passant le label <code>-l com.centurylinklabs.watchtower.enable=true</code></p>
</li>
<li>
<p>Enfin derniÃ¨re option trÃ¨s utile la possibilitÃ© de dÃ©cider de la pÃ©riode de mise Ã  jour Ã  l&#8217;aide d&#8217;une expression de type cron. Comme exemple: <code>--schedule "0 0 4 * * *"</code> mettra Ã  jour Ã  0h0 tous les 4 de chaque mois.</p>
</li>
<li>
<p>Enfin lorsqu&#8217;une mise Ã  jour s&#8217;effectue vous pouvez Ãªtre notifiÃ© par mail, slack ou d&#8217;autres outils tels que shoutrrr. Se rÃ©fÃ©rer Ã  la <a href="https://containrrr.dev/watchtower/notifications/">documentation</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_surveillance_et_redÃ©marrage_de_container">9.8. Surveillance et redÃ©marrage de container</h3>
<div class="paragraph">
<p>Il peut arriver que certains container s&#8217;arrÃªtent brusquement suite Ã  un bug.</p>
</div>
<div class="paragraph">
<p>Autoheal est unn outil qui redÃ©marre ces container automatiquement en se basant sur l&#8217;attribut healthcheck des containers.</p>
</div>
<div class="paragraph">
<p>La documentation est <a href="https://github.com/willfarrell/docker-autoheal">ici</a>.</p>
</div>
<div class="paragraph">
<p>Pour l&#8217;installer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-d</span> <span class="nt">--name</span> autoheal <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-e</span> <span class="nv">AUTOHEAL_CONTAINER_LABEL</span><span class="o">=</span>all <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock willfarrell/autoheal</code></pre>
</div>
</div>
</li>
<li>
<p>La variable d&#8217;environnement AUTOHEAL_CONTAINER_LABEL indique que tous les containers seront vÃ©rifiÃ©s. Si vous souhaitez uniquement indiquer les container Ã  vÃ©rifier, il vous faut ajouter pour les container concernÃ©s l&#8217;otion <code>-l autoheal=true</code></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_de_traefik">10. Installation de Traefik</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le logiciel <code>Traefik</code> est une technologie de Reverse Proxy qui est un intermÃ©diaire de communication, entre un rÃ©seau public et un rÃ©seau privÃ©, le nÃ´tre par exemple. Câest sur ce rÃ©seau privÃ© que lâon trouvera toutes les applications qui ne sont pas accessibles depuis lâextÃ©rieur pour des raisons de sÃ©curitÃ© ou de dÃ©coupe en microservices.</p>
</div>
<div class="paragraph">
<p>Traefik permet donc de faire de la âconfiguration discoveryâ via plusieurs fournisseurs de services et load balancer pour HTTP et TCP. Il offre Ã©galement dâautres fonctionnalitÃ©s comme le support de Letâs Encrypt, des middlewares et la possibilitÃ© de monitorer facilement des services.</p>
</div>
<div class="sect2">
<h3 id="_installation_de_traefik_2">10.1. Installation de Traefik</h3>
<div class="paragraph">
<p>L&#8217;installation de Traefik est simple.</p>
</div>
<div class="paragraph">
<p>Il faut suivre les Ã©tapes suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Assurez vous tout d&#8217;abord qu&#8217;un serveur web n&#8217;est pas actif sur le port 80 de votre Machine. C&#8217;est Traefik qui en prendra la place et servira les pages nÃ©cessaires. Il vous faudra soit dÃ©sactiver tout serveur Apache local soit vÃ©rifier que ce serveur apache n&#8217;utilise pas le port 80.</p>
</li>
<li>
<p>Pour dÃ©sactiver lighttpd ou apache2. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service lighttpd stop
service apache stop</code></pre>
</div>
</div>
</li>
<li>
<p>Ensuite installez Traefik. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-d</span> <span class="nt">--name</span> traefik <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">-p80</span>:80 <span class="nt">-p8080</span>:8080 <span class="nt">--api</span>.insecure<span class="o">=</span><span class="nb">true</span> <span class="nt">--api</span>.dashboard<span class="o">=</span><span class="nb">true</span> <span class="nt">--providers</span>.docker <span class="nt">--log</span>.level<span class="o">=</span>DEBUG <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Si votre serveur Traefik est disponible sur internet, il ne faudra pas exposer le port 8080 et les api insecure. et de ce fait, dans la ligne prÃ©cÃ©dente, supprimez: <code>-p8080:8080 --api.insecure=true --api.dashboard=true</code></td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_de_traefik_pour_une_utilisation_avec_pi_hole">10.2. Configuration de Traefik pour une utilisation avec Pi-Hole</h3>
<div class="paragraph">
<p>Pi-Hole se configure avec un serveur lighttpd sur votre machine en utilisant le port 80. Il est possible d&#8217;utiliser Pi-Hole et Traefik en mÃªme temps pour servir plusieurs site webs sur la mÃªme machine</p>
</div>
<div class="paragraph">
<p>Appliquer la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Reconfigurez Pi Hole pour utiliser un autre port que le port 80 sur la machine local. Pour cela Ã©ditez le fichier <code>external.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/lighttpd/external.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier insÃ¨rez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">server.port:<span class="o">=</span>3080</code></pre>
</div>
</div>
</li>
<li>
<p>Sauvegardez et redÃ©marrez lighttpd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service lighttpd restart</code></pre>
</div>
</div>
</li>
<li>
<p>VÃ©rifier que lighttpd n&#8217;est plus accessible dans votre navigateur sur le port 80 mais sur le port 3080.</p>
</li>
<li>
<p>Editez un fichier de configuration statique Traefik. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> /etc/traefik
vi /etc/traefik/traefik.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Dans ce fichier, tapez le contenu suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">logLevel</span><span class="pi">:</span> <span class="s">Debug</span>

<span class="na">providers</span><span class="pi">:</span>
  <span class="na">docker</span><span class="pi">:</span>
    <span class="na">defaultRule</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Host(`{{</span><span class="nv"> </span><span class="s">trimPrefix</span><span class="nv"> </span><span class="s">`/`</span><span class="nv"> </span><span class="s">.Name</span><span class="nv"> </span><span class="s">}}.example.com`)"</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="na">watch</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">file</span><span class="pi">:</span>
    <span class="na">filename</span><span class="pi">:</span> <span class="s">/etc/traefik/dynamic_conf.yml</span>
    <span class="na">watch</span><span class="pi">:</span> <span class="no">true</span>

<span class="na">defaultEntryPoints</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">https</span>
  <span class="pi">-</span> <span class="s">http</span>

<span class="na">entryPoints</span><span class="pi">:</span>
  <span class="na">http</span><span class="pi">:</span>
    <span class="na">address</span><span class="pi">:</span> <span class="s">:80</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remplacez example.com par le nom de domaine de votre serveur.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Editez le fichier de configuration dynamique. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/traefik/dynamic_conf.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Dans ce fichier, tapez le contenu suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">http</span><span class="pi">:</span>
  <span class="na">routers</span><span class="pi">:</span>
    <span class="na">lighttpd</span><span class="pi">:</span>
      <span class="na">entrypoints</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">http</span>
      <span class="na">service</span><span class="pi">:</span> <span class="s">localserver</span>
      <span class="na">rule</span><span class="pi">:</span> <span class="s">host("example.com")</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="na">services</span><span class="pi">:</span>
    <span class="na">localserver</span><span class="pi">:</span>
      <span class="na">loadBalancer</span><span class="pi">:</span>
        <span class="na">servers</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://ip_address:3080"</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remplacez example.com par le nom de domaine de votre serveur.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>remplacez ip_address par l&#8217;adresse IP de votre serveur.</td>
</tr>
</table>
</div>
</li>
<li>
<p>ArrÃªtez votre ancienne instance Traefik, si Traefik a Ã©tÃ© lancÃ©. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker stop traefik
docker <span class="nb">rm </span>traefik</code></pre>
</div>
</div>
</li>
<li>
<p>Relancez Traefik avec la nouvelle configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-d</span> <span class="nt">--name</span> traefik <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">-v</span> /etc/traefik:/etc/traefik <span class="nt">-p80</span>:80 <span class="nt">-p8080</span>:8080 traefik <span class="nt">--api</span>.insecure<span class="o">=</span><span class="nb">true</span> <span class="nt">--api</span>.dashboard<span class="o">=</span><span class="nb">true</span> <span class="nt">--providers</span>.docker <span class="nt">--log</span>.level<span class="o">=</span>DEBUG</code></pre>
</div>
</div>
</li>
<li>
<p>Pihole est maintenant de nouveau accessible sur le port 80 et Traefik est actif en mÃªme temps pour servir tout un ensemble de sous-domaines virtuels associÃ©s Ã  l&#8217;environnement Docker.</p>
</li>
<li>
<p>Pour superviser vos routes et services Traefik, vous pouvez vous connecter sur <code>http:example.com:8080</code> pour voir la configuration en cours. (example.com est Ã  remplacer pour le nom de votre machine).</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_traefik">10.3. Upgrade de Traefik</h3>
<div class="paragraph">
<p>Rien a faire pour la mise Ã  jour si vous utilisez <code>Watchtower</code>
Vous pouvez aussi appliquer la procÃ©dure de mise Ã  jour des containers Ã  l&#8217;aide de <a href="#port_container_updt"><code>Portainer</code></a> ou Ã  l&#8217;aide <a href="#yacht_container_updt"><code>Yacht</code></a></p>
</div>
<div class="paragraph">
<p>Sinon, effectuez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>Mettez Ã  jour le docker de Traefik. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker pull traefik
docker stop traefik
docker <span class="nb">rm </span>traefik
docker run <span class="nt">-d</span> <span class="nt">--name</span> traefik <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">-v</span> /etc/traefik:/etc/traefik <span class="nt">-p80</span>:80 <span class="nt">-p8080</span>:8080 traefik <span class="nt">--api</span>.insecure<span class="o">=</span><span class="nb">true</span> <span class="nt">--api</span>.dashboard<span class="o">=</span><span class="nb">true</span> <span class="nt">--providers</span>.docker <span class="nt">--log</span>.level<span class="o">=</span>DEBUG <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>supprimez <code>-v /etc/traefik:/etc/traefik</code> si vous n&#8217;utilisez pas Pi-Hole avec Treafik.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_outils_web_de_gestion_des_containers">11. Outils web de gestion des containers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation_de_yacht">11.1. Installation de Yacht</h3>
<div class="paragraph">
<p>Yacht est un outil d&#8217;administration de vos instances docker sous forme de site web. Yacht est trÃ¨s facile d&#8217;utilisation mais manque de possibilitÃ©s du moins dans la version actuelle. Si vous souhaitez administrer de faÃ§on plus avancÃ©e vos instances docker, il est conseillÃ© d&#8217;utiliser Portainer.</p>
</div>
<div class="paragraph">
<p>Yacht sâinstalle comme un conteneur docker pour simplifier son dÃ©ploiement.</p>
</div>
<div class="paragraph">
<p>Pour la crÃ©ation du site web, il faut suivre les Ã©tapes suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans ISPConfig dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>yacht</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>yacht</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>yacht</code>.</p>
</li>
<li>
<p>Activer letâs encrypt ssl</p>
</li>
<li>
<p>Activer <code>Fast CGI</code> pour PHP</p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># yacht httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / http://localhost:8061/
<span class="nc">ProxyPassReverse</span> / http://localhost:8061/

<span class="nc">RedirectMatch</span> ^/$ https://yacht.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Puis sur votre serveur, <a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker volume create yacht_data
docker run <span class="nt">-d</span> <span class="nt">-p</span> 8061:8000 <span class="nt">--name</span><span class="o">=</span>yacht <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> yacht_data:/config selfhostedpro/yacht</code></pre>
</div>
</div>
</li>
<li>
<p>Ouvrez un navigateur et pointez sur <a href="http://yacht.example.com" class="bare">http://yacht.example.com</a></p>
</li>
<li>
<p>L&#8217;utilisateur par dÃ©faut est login: <code>admin@yacht.local</code> et mot de passe: <code>pass</code>.</p>
</li>
<li>
<p>Une fois logguÃ©, Cliquez sur l&#8217;utilisateur en haut Ã  droite et <code>user</code>.</p>
</li>
<li>
<p>Cliquez sur <code>change password</code></p>
</li>
<li>
<p>Modifier votre Email de login et saisissez un nouveau mot de passe.</p>
</li>
<li>
<p>Cliquez ensuite sur <code>Templates</code> dans la barre vertical de gauche puis sur <code>New templates</code></p>
</li>
<li>
<p>Copiez la suggestion de template proposÃ©e.</p>
</li>
<li>
<p>Saisissez un titre <code>Yacht</code> dans le champ <code>Title</code> puis collez l&#8217;URL du json dans le champ <code>URL</code></p>
</li>
<li>
<p>Cliquez sur Submit.</p>
</li>
<li>
<p>Allez dans <code>Templates</code> &#8594; <code>View Templates</code>.</p>
</li>
<li>
<p>cliquez sur <code>Yacht</code>; vous avez maintenant accÃ¨s Ã  une foule de templates.</p>
</li>
<li>
<p>Vous pouvez maintenant administrer vos machines docker. RÃ©fÃ©rez vous Ã  la documentation de <a href="https://yacht.sh/Pages/dashboard/">Yacht</a> pour installer de nouvelles machines docker</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="yacht_container_updt">11.2. Upgrade d&#8217;un container dans Yacht</h3>
<div class="paragraph">
<p>PlutÃ´t que dâeffectuer des mises Ã  jour automatiques avec Watchtower, vous prÃ©fÃ©rerez mettre Ã  jour manuellement avec Yacht.</p>
</div>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ouvrez un navigateur et pointez sur <a href="http://yacht.example.com" class="bare">http://yacht.example.com</a></p>
</li>
<li>
<p>Logguez vous en tant qu'`admin`</p>
</li>
<li>
<p>Allez  dans l&#8217;onglet <code>Applications</code></p>
</li>
<li>
<p>Cliquez sur le bouton <code>Updates</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_yacht">11.3. Upgrade de Yacht</h3>
<div class="paragraph">
<p>Rien a faire pour la mise Ã  jour si vous utilisez <code>Watchtower</code>
Vous pouvez aussi appliquer la procÃ©dure de mise Ã  jour des <a href="#port_container_updt">containers Ã  l&#8217;aide de <code>Portainer</code></a></p>
</div>
<div class="paragraph">
<p>Sinon, effectuez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>Mettez Ã  jour le docker de Yacht. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker pull selfhostedpro/yacht
docker stop yacht
docker <span class="nb">rm </span>yacht
docker run <span class="nt">-d</span> <span class="nt">-p</span> 8061:8000 <span class="nt">--name</span><span class="o">=</span>yacht <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> yacht_data:/config selfhostedpro/yacht</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_portainer">11.4. Installation de Portainer</h3>
<div class="paragraph">
<p>Portainer est un outil d&#8217;administration de vos instances docker sous forme de site web. Portainer est plus complexe Ã  utiliser que Yacht, mais offre cependant beaucoup plus de possibilitÃ©s.</p>
</div>
<div class="paragraph">
<p>Portainer sâinstalle comme un conteneur docker pour simplifier son dÃ©ploiement. Portainer gÃ¨re une bonne partie des Ã©lÃ©ments de docker : conteneurs, images, volumes, rÃ©seaux, utilisateurs</p>
</div>
<div class="paragraph">
<p>Pour la crÃ©ation du site web, il faut suivre les Ã©tapes suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans ISPConfig dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>portainer</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>portainer</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>portainer</code>.</p>
</li>
<li>
<p>Activer letâs encrypt ssl</p>
</li>
<li>
<p>Activer <code>Fast CGI</code> pour PHP</p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># portainer httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / http://localhost:9050/
<span class="nc">ProxyPassReverse</span> / http://localhost:9050/

<span class="nc">RedirectMatch</span> ^/$ https://portainer.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Puis sur votre serveur, <a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker volume create portainer_data
docker run <span class="nt">-d</span> <span class="nt">-p</span> 9050:9000 <span class="nt">--name</span><span class="o">=</span>portainer <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">-v</span> portainer_data:/data portainer/portainer-ce</code></pre>
</div>
</div>
</li>
<li>
<p>Ouvrez un navigateur et pointez sur <a href="http://portainer.example.com" class="bare">http://portainer.example.com</a></p>
</li>
<li>
<p>CrÃ©ez votre utilisateur de <code>admin</code> avec un mot de passe sÃ©curisÃ©.</p>
</li>
<li>
<p>Ajoutez un endpoint <code>Local</code></p>
</li>
<li>
<p>Vous pouvez maintenant administrer vos machines docker. RÃ©fÃ©rez vous Ã  la documentation de <a href="https://documentation.portainer.io/v2.0/stacks/create/">portainer</a> pour installer de nouvelles machines docker</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Portainer offre la possibilitÃ© d&#8217;installer des templates par dÃ©faut. Vous pouvez soit garder le repository par dÃ©fault : <code><a href="https://raw.githubusercontent.com/portainer/templates/master/templates-2.0.json" class="bare">https://raw.githubusercontent.com/portainer/templates/master/templates-2.0.json</a></code> ou utiliser un autre repository comme: <code><a href="https://raw.githubusercontent.com/Qballjos/portainer_templates/master/Template/template.json" class="bare">https://raw.githubusercontent.com/Qballjos/portainer_templates/master/Template/template.json</a></code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>allez sur votre site web portainer.</p>
</li>
<li>
<p>puis dans le menu Settings</p>
</li>
<li>
<p>Dans la zone <code>App Templates</code> saisissez le repository de votre choix dans le champ <code>URL</code></p>
</li>
<li>
<p>Cliquez sur <code>Save Settings</code></p>
</li>
<li>
<p>retournez dans le menu <code>App Templates</code>; vos nouveau templates sont maintenant affichÃ©s.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="port_container_updt">11.5. Upgrade d&#8217;un container dans Portainer</h3>
<div class="paragraph">
<p>PlutÃ´t que dâeffectuer des mises Ã  jour automatiques avec Watchtower, vous prÃ©fÃ©rerez mettre Ã  jour manuellement avec Portainer.</p>
</div>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ouvrez un navigateur et pointez sur <a href="http://portainer.example.com" class="bare">http://portainer.example.com</a></p>
</li>
<li>
<p>Logguez vous en tant qu' <code>admin</code></p>
</li>
<li>
<p>Allez  dans l&#8217;onglet <code>Containers</code></p>
</li>
<li>
<p>Double-cliquez sur le container Ã  mettre Ã  jour</p>
</li>
<li>
<p>Dans le nouvel Ã©cran <code>Container details</code> cliquez sur l&#8217;icone <code>recreate</code></p>
</li>
<li>
<p>SÃ©lectionnez <code>Pull latest image</code> et cliquez <code>recreate</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_portainer">11.6. Upgrade de Portainer</h3>
<div class="paragraph">
<p>Rien a faire pour la mise Ã  jour si vous utilisez <code>Watchtower</code>
Vous pouvez aussi appliquer la procÃ©dure de mise Ã  jour des containers Ã  l&#8217;aide de <a href="#yacht_container_updt"><code>Yacht</code></a></p>
</div>
<div class="paragraph">
<p>Sinon, effectuez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>Mettez Ã  jour le docker de Yacht. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker pull portainer/portainer-ce
docker stop portainer
docker <span class="nb">rm </span>portainer
docker run <span class="nt">-d</span> <span class="nt">-p</span> 9050:9000 <span class="nt">--name</span><span class="o">=</span>portainer <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">-v</span> portainer_data:/data portainer/portainer-ce</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_de_docker_mirror">12. Configuration de Docker-mirror</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;outil Docker-mirror est un systÃ¨me de cache de fichier Dockers.</p>
</div>
<div class="paragraph">
<p>Si vous avez plusieurs machines utilisant docker sur votre rÃ©seau, les dÃ©ploiements et les mises Ã  jour seront considÃ©rablement accÃ©lÃ©rÃ©es par l&#8217;utilisation de ce systÃ¨me de cache.</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Obtenez une configuration initiale pour le fichier <code>config.yml</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--entrypoint</span> <span class="nb">cat </span>registry:2 /etc/docker/registry/config.yml <span class="o">&gt;</span> /etc/docker-mirror.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez ceci dans le fichier <code>config.yml</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/docker-mirror.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Dans ce fichier, ajoutez les lignes suivantes :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>proxy:
      remoteurl: https://registry-1.docker.io</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©marrez ensuite le service docker. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-d</span> <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-p</span> 5000:5000 <span class="nt">--name</span> docker-registry-proxy <span class="nt">-v</span> /etc/docker-mirror.yml:/etc/docker/registry/config.yml registry:2</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Sur le poste client, soit passez l&#8217;option --registry-mirror lorsque vous lancez le dÃ©mon <code>dockerd</code> ou sinon Ã©ditez le fichier <code>/etc/docker/daemon.json</code> et ajoutez la clÃ© <code>registry-mirrors</code> pour rendre le changement persistant:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le poste client</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/docker/daemon.json</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier, ajoutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>{
  "registry-mirrors": ["http://docker.example.com:5000"] <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>docker.example.com</code> par le nom ou l&#8217;adresse ip de votre cache docker.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Sauvegarder le fichier et redÃ©marrez le dÃ©mon docker. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart docker</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_de_statping">13. Installation de Statping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Statping rÃ©cupÃ©rera automatiquement l&#8217;Ã©tat de vos applications web et gÃ©nÃ¨rera une belle page d&#8217;Ã©tat avec des tonnes de fonctionnalitÃ©s pour vous permettre de construire une page d&#8217;Ã©tat encore plus dÃ©taillÃ©e.
Statping est mini d&#8217;une appli smartphone qui vos permettra de consulter les statuts de votre site</p>
</div>
<div class="paragraph">
<p>Des alertes peuvent Ãªtre envoyÃ©es par mail sms ou autre.</p>
</div>
<div class="sect2">
<h3 id="_prÃ©requis">13.1. PrÃ©requis</h3>
<div class="paragraph">
<p>Il vous faudra tout d&#8217;abord installer <code>docker</code> en vous rÃ©fÃ©rant au chapitre qui y est consacrÃ©.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation_du_serveur_statping">13.2. Installation du serveur Statping</h3>
<div class="paragraph">
<p>Nous allons installer Statping Ã  partir de son container Docker.</p>
</div>
<div class="paragraph">
<p>Ouvrez un terminal et suivez la procÃ©dure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>CrÃ©ez le docker de Statping. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker volume create statping_data
docker run <span class="nt">-d</span> <span class="nt">--name</span><span class="o">=</span>statping <span class="nt">-p</span> 8035:8080 <span class="nt">-v</span> statping_data:/app <span class="nt">--restart</span> always statping/statping</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_statping">13.3. CrÃ©ation du site web de statping</h3>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>statping</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>statping</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>statping</code>.</p>
</li>
<li>
<p>Dans auto-Subdomain &#8592; SÃ©lectionnez <code>None</code></p>
</li>
<li>
<p>Activer letâs encrypt ssl</p>
</li>
<li>
<p>Activer <code>Fast CGI</code> pour PHP</p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># statping httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / http://localhost:8035/
<span class="nc">ProxyPassReverse</span> / http://localhost:8035/

<span class="nc">RedirectMatch</span> ^/$ https://statping.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_du_site_statping">13.4. Configuration du site statping</h3>
<div class="paragraph">
<p>Votre site web <code>statping</code> est installÃ© et opÃ©rationnel.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pointez votre navigateur sur votre site web <code>statping</code></p>
</li>
<li>
<p>une page de configuration apparait. Saisissez:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Language</code> &#8594; <code>French</code></p>
</li>
<li>
<p><code>Connexion Ã  la Base</code> &#8594; <code>Sqlite</code></p>
</li>
<li>
<p><code>Nom de la page d&#8217;Ã©tat</code> &#8594; <code>Statut des serveurs</code></p>
</li>
<li>
<p><code>Description</code> &#8594; <code>Monitoring de l&#8217;Ã©tat de tous les serveurs</code></p>
</li>
<li>
<p><code>Domaine</code> &#8594; <code><a href="https://statping.example.com" class="bare">https://statping.example.com</a></code> mettre le nom de votre domaine Ã  la place de example.com</p>
</li>
<li>
<p><code>Nom d&#8217;utilisateur</code> &#8594; <code>admin</code></p>
</li>
<li>
<p><code>mot de passe</code> et <code>confirmer Le</code> &#8594; Saisissez <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a></p>
</li>
<li>
<p><code>Email</code> &#8594; saisissez votre email</p>
</li>
<li>
<p>Cliquez sur <code>enregistrer</code>. Vous avez alors accÃ¨s Ã  la page principale de <code>Statping</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Allez sur le <code>dashboard</code> et logguez vous.</p>
</li>
<li>
<p>Vous pouvez alors configurer statping. Pour la documentation allez  <a href="https://github.com/statping/statping/wiki" class="bare">https://github.com/statping/statping/wiki</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_statping">13.5. Upgrade de Statping</h3>
<div class="paragraph">
<p>Rien a faire pour la mise Ã  jour si vous utilisez <code>Watchtower</code>
Vous pouvez aussi appliquer la procÃ©dure de mise Ã  jour des containers Ã  l&#8217;aide de <a href="#port_container_updt"><code>Portainer</code></a> ou Ã  l&#8217;aide <a href="#yacht_container_updt"><code>Yacht</code></a></p>
</div>
<div class="paragraph">
<p>Sinon, effectuez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>Mettez Ã  jour le docker de Mealie. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker pull statping/statping:latest
docker stop statping
docker <span class="nb">rm </span>statping
docker run <span class="nt">-d</span> <span class="nt">--name</span><span class="o">=</span>statping <span class="nt">-p</span> 8035:8080 <span class="nt">-v</span> statping_data:/app <span class="nt">--restart</span> always statping/statping</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_systÃ¨me_de_backup_borgbackup">14. Installation du systÃ¨me de backup BorgBackup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>BorgBackup est un systÃ¨me de backup simple mais offrant des fonctionnalitÃ©s avancÃ©es telles que le backup incrÃ©mental, la dÃ©duplication de donnÃ©es, la compression, l&#8217;authentification, l&#8217;encryption.</p>
</div>
<div class="paragraph">
<p>Borg backup est un systÃ¨me de backup offsite. Cela signifie que vous devez avoir accÃ¨s Ã  un espace de stockage sur un autre site pour effectuer cette sauvegarde.</p>
</div>
<div class="paragraph">
<p>Pour le moment, BorgBackup n&#8217;utilise pas de mÃ©canisme de type RClone et il n&#8217;est donc pas encore possible de sauvegarder sur google drive ou autres espaces partagÃ©s.</p>
</div>
<div class="sect2">
<h3 id="_introduction">14.1. Introduction</h3>
<div class="paragraph">
<p>BorgBackup permet de stocker des backups sur un serveur distant.
Nous nommerons le serveur sur lequel les sauvegardes seront stockÃ©es : serveur de stockage et identifiÃ© par &lt;storing_srv&gt;.
Nous nommerons le serveur qu&#8217;il faut sauvegarder: serveur sauvegardÃ© et identifiÃ© par &lt;example.com&gt;</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation_du_serveur_de_stockage">14.2. Installation du serveur de stockage</h3>
<div class="paragraph">
<p>Il est prÃ©fÃ©rable pour des questions de sÃ©curitÃ© de crÃ©er un compte utilisateur spÃ©cifique.</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;storing_srv&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>borgbackup</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#pass_gen">GÃ©nÃ©rez un mot de passe long</a></p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Sauvegardez prÃ©cieusement ce mot de passe. Il vous sera indispensable pour rÃ©cupÃ©rer vos backup aprÃ¨s un crash du serveur. Sans celui-ci, impossible de rÃ©cupÃ©rer votre installation !
</td>
</tr>
</table>
</div>
</li>
<li>
<p>CrÃ©ez un compte utilisateur. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">adduser borgbackup</code></pre>
</div>
</div>
</li>
<li>
<p>Copiez-collez le mot de passe gÃ©nÃ©rÃ© lorsqu&#8217;il est demandÃ©</p>
</li>
<li>
<p>se loguer comme <code>borgbackup</code></p>
</li>
<li>
<p>CrÃ©er un rÃ©pertoire <code>~/.ssh</code> s&#8217;il n&#8217;existe pas. tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/.ssh
<span class="nb">chmod </span>700 ~/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>Allez dans le rÃ©pertoire. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> ~/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>GÃ©nÃ©rez vous clÃ©s. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh-keygen <span class="nt">-t</span> rsa</code></pre>
</div>
</div>
</li>
<li>
<p>Un ensemble de questions apparaÃ®t. Si un texte vous explique que le fichier existe dÃ©jÃ , arrÃªtez la procÃ©dure. Cela signifie que vous avez dÃ©jÃ  crÃ©Ã© une clÃ© et que vous risquez de perdre la connexion Ã  d&#8217;autres serveurs si vous en gÃ©nÃ©rez une nouvelle. Sinon, appuyez sur EntrÃ©e Ã  chaque fois pour accepter les valeurs par dÃ©faut.</p>
</li>
<li>
<p>CrÃ©ez maintenant le rÃ©pertoire pour recevoir les sauvegardes</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd
mkdir </span>borgbackup
<span class="nb">chmod </span>700 borgbackup</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_sur_le_serveur_sauvegardÃ©">14.3. Installation sur le serveur sauvegardÃ©</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>borgbackup</code></pre>
</div>
</div>
</li>
<li>
<p>Copiez la clÃ© publique de root sur le &lt;storing_srv&gt;. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh-copy-id <span class="nt">-i</span> ~/.ssh/id_<span class="k">*</span>.pub borgbackup@&lt;storing_srv&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Coller le mot de passe gÃ©nÃ©rÃ© plus haut lorsqu&#8217;il est demandÃ©</p>
</li>
<li>
<p>Affichez votre adresse IP. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">wget <span class="nt">-qO-</span> http://ipecho.net/plain<span class="p">;</span> <span class="nb">echo</span></code></pre>
</div>
</div>
</li>
<li>
<p>Faites un essai de connexion en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh borgbackup@&lt;storing_srv&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Aucun mot de passe ne doit Ãªtre demandÃ©e et vous devez Ãªtre connectÃ© en tant que borgbackup sur le &lt;storing_srv&gt;</p>
</li>
<li>
<p>Si vous Ãªtes trÃ¨s attachÃ© Ã  la sÃ©curitÃ©, vous pouvez restreindre l&#8217;accÃ¨s au seul serveur &lt;example.com&gt;. Tapez sur la ligne de commande du &lt;storing_srv&gt; :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi ~/.ssh/authorized_keys</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez en premiÃ¨re ligne du fichier :</p>
<div class="listingblock">
<div class="content">
<pre>from="SERVERIPADDRESS",command="borg serve --restrict-to-path /home/borgbackup/borgbackup/",no-pty,no-agent-forwarding,no-port-forwarding,no-X11-forwarding,no-user-rc <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez SERVERIPADDRESS par l&#8217;adresse IP affichÃ©e plus tÃ´t.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Fusionnez cette ligne avec la suivante qui dÃ©marre par ssh en prenant bien garde de laissez un espace entre no-user-rc et ssh-rsa</p>
</li>
<li>
<p>DÃ©connectez vous en tapant :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">exit</span></code></pre>
</div>
</div>
</li>
<li>
<p>De retour sur le serveur &lt;example.com&gt;</p>
</li>
<li>
<p><a href="#pass_gen">CrÃ©ez un mot de passe pour le dÃ©pot borg backup</a>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Sauvegardez prÃ©cieusement ce mot de passe. Il vous sera indispensable pour rÃ©cupÃ©rer vos backup aprÃ¨s un crash du serveur. Sans celui-ci, impossible de rÃ©cupÃ©rer votre installation !
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Puis tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut</td>
</tr>
</table>
</div>
</li>
<li>
<p>Initialisez le dÃ©pot borg. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">borg init <span class="nt">-e</span> repokey-blake2 borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/</code></pre>
</div>
</div>
</li>
<li>
<p>Tout est maintenant prÃªt pour faire un backup</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_effectuer_un_backup">14.4. Effectuer un backup</h3>
<div class="paragraph">
<p>Nous allons crÃ©er tout d&#8217;abord un script de backup pour sauvegarder tout le serveur sauf les rÃ©pertoires systÃ¨me:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borgbackup.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ¨rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">cd</span> / <span class="o">&amp;&amp;</span> borg create <span class="nt">--stats</span> <span class="nt">--progress</span> <span class="nt">--compress</span> zstd borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/::<span class="sb">`</span><span class="nb">hostname</span><span class="sb">`</span>-<span class="sb">`</span><span class="nb">date</span> +%Y-%m-%d-%H-%M-%S<span class="sb">`</span> ./ <span class="nt">--exclude</span><span class="o">=</span>dev <span class="nt">--exclude</span><span class="o">=</span>proc <span class="nt">--exclude</span><span class="o">=</span>run <span class="nt">--exclude</span><span class="o">=</span>root/.cache/ <span class="nt">--exclude</span><span class="o">=</span>mnt/borgmount <span class="nt">--exclude</span><span class="o">=</span>sys <span class="nt">--exclude</span><span class="o">=</span>swapfile <span class="nt">--exclude</span><span class="o">=</span>tmp <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>si votre machine est assez puissante, vous pouvez remplacer l&#8217;algorithme de compression zstd par un algorithme lz4 (rapide) ou  lzma (trÃ¨s lent mais performant en taille).</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgbackup.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant effectuer une premiÃ¨re sauvegarde en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borgbackup.sh</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_lister_les_backups">14.5. Lister les backups</h3>
<div class="paragraph">
<p>Nous allons crÃ©er un script de listage :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borglist.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ¨rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
borg list <span class="nt">-v</span> borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borglist.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant lister vos backup en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borglist.sh</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_vÃ©rifier_un_backup">14.6. VÃ©rifier un backup</h3>
<div class="paragraph">
<p>Nous allons crÃ©er un script de vÃ©rification :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borgcheck.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ¨rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
borg check <span class="nt">--progress</span> borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/::<span class="nv">$1</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgcheck.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant vÃ©rifier un de vos backup en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borgcheck.sh &lt;nom_de_sauvegarde&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>le nom de sauvegarde est rÃ©cupÃ©rÃ© en utilisant la commande borglist.sh</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_restaurer_un_backup">14.7. Restaurer un backup</h3>
<div class="paragraph">
<p>Nous allons crÃ©er un script de montage sous forme de systÃ¨me de fichier :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borgmount.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> /mnt/borgbackup
<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
borg mount borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/ /mnt/borgbackup</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgmount.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant monter vos backups et effectuer des opÃ©rations de fichiers. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borgmount.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Pour crÃ©er un script pour dÃ©monter les backups. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borgumount.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
umount /mnt/borgbackup
<span class="nb">rmdir</span> /mnt/borgbackup</code></pre>
</div>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgumount.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant demonter vos backups. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borgumount.sh</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_supprimer_vos_vieux_backups">14.8. Supprimer vos vieux backups</h3>
<div class="paragraph">
<p>Nous allons crÃ©er un script de mÃ©nage des backups :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borgprune.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ¨rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>

<span class="c"># Nettoyage des anciens backups</span>
<span class="c"># On conserve</span>
<span class="c"># - une archive par jour les 7 derniers jours,</span>
<span class="c"># - une archive par semaine pour les 4 derniÃ¨res semaines,</span>
<span class="c"># - une archive par mois pour les 6 derniers mois.</span>


<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
borg prune <span class="nt">--stats</span> <span class="nt">--progress</span> borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/ <span class="nt">--prefix</span> <span class="sb">`</span><span class="nb">hostname</span><span class="sb">`</span>- <span class="nt">--keep-daily</span><span class="o">=</span>7 <span class="nt">--keep-weekly</span><span class="o">=</span>4 <span class="nt">--keep-monthly</span><span class="o">=</span>12 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Le nettoyage des sauvegardes va conserver 7 sauvegardes journaliÃ¨res, 4 Ã  la semaine et 12 au mois</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgprune.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant effectuer du mÃ©nage:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borgprune.sh</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_automatisez_votre_sauvegarde">14.9. Automatisez votre sauvegarde</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pour crÃ©er un script automatisÃ© de backup. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /var/log/borg
vi /usr/local/bin/borgcron.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="c">#</span>
<span class="c"># Script de sauvegarde.</span>
<span class="c">#</span>

<span class="nb">set</span> <span class="nt">-e</span>

<span class="nv">LOG_PATH</span><span class="o">=</span>/var/log/borg/cron.log

/usr/local/bin/borgbackup.sh <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">LOG_PATH</span><span class="k">}</span> 2&gt;&amp;1
/usr/local/bin/borgprune.sh <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">LOG_PATH</span><span class="k">}</span> 2&gt;&amp;1</code></pre>
</div>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgcron.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez ensuite planifier votre backup Ã  1h du matin. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">crontab <span class="nt">-e</span></code></pre>
</div>
</div>
</li>
<li>
<p>Inserez ensuite le texte suivant:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre># Backup via Borg to backup server
00 01 * * * /usr/local/bin/borgcron.sh</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_restauration_durgence">14.10. Restauration d&#8217;urgence.</h3>
<div class="paragraph">
<p>En cas de crash du serveur, lâintÃ©rÃªt du backup offsite est de pouvoir remonter la derniÃ¨re sauvegarde sans souci.
Pour cela il faut avoir un moyen de booter le serveur dans un mode rescue (boot du VPS en mode rescue, utilisation d&#8217;un clÃ© USB bootable, boot rÃ©seau ou autre moyen).</p>
</div>
<div class="paragraph">
<p>On suppose dans ce qu&#8217;il suit que vous avez bootÃ© sur un linux de type debian ou ubuntu dont la version n&#8217;est pas la toute derniÃ¨re et dans laquelle borg-backup n&#8217;est pas obligatoirement prÃ©sent du moins dans un version suffisamment rÃ©cente.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>loguez vous root sur votre serveur. A noter que, comme vous Ãªtes en mode rescue, l&#8217;accÃ¨s au mode est indiquÃ© par votre hÃ©bergeur ou, si vous avez bootÃ© sur une clÃ© USB en local, l&#8217;accÃ¨s root s&#8217;effectue souvent avec une commande <code>sudo bash</code></p>
</li>
<li>
<p>Montez votre partition racine. Sur un VPS, la partition est souvent dÃ©jÃ  montÃ©e dans le rÃ©pertoire /mnt. Sur un PC c&#8217;est souvent /dev/sda1. Sur un Raspberry Pi cette partition est /dev/mmcblk0p7. Tapez la commande:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /mnt/root
mount /dev/mmcblk0p7 /mnt/root</code></pre>
</div>
</div>
</li>
<li>
<p>Installez borgbackup. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>python3-pip libssl-dev cython3 gcc g++ libpython3-dev libacl1-dev python3-llfuse libfuse-dev
pip3 <span class="nb">install</span> <span class="nt">-U</span> pip setuptools wheel
pip3 <span class="nb">install </span>pkgconfig
pip3 <span class="nb">install </span>borgbackup[llfuse]</code></pre>
</div>
</div>
</li>
<li>
<p>Si la compilation Ã©choue, c&#8217;est qu&#8217;il manque des packages. lisez attentivement les logs et installez les packages manquant.</p>
</li>
<li>
<p>Munissez vous du mot de passe &lt;mot_passe&gt; des archives borg et tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /mnt/borgbackup
<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
borg list borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez mot_passe par votre mot de passe de borg</td>
</tr>
</table>
</div>
</li>
<li>
<p>tapez le mot de passe du compte borgbackup.</p>
</li>
<li>
<p>la liste des sauvegardes est affichÃ©es Ã  l&#8217;Ã©cran.</p>
</li>
<li>
<p>Choisissez l&#8217;archive qui vous convient et tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /mnt/root
borg extract <span class="nt">--list</span> borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/::&lt;votre_archive&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>tapez le mot de passe du compte borgbackup.</p>
</li>
<li>
<p>la restauration s&#8217;effectue et peut prendre des heures ! soyez patient.</p>
</li>
<li>
<p>il peut Ãªtre nÃ©cessaire de rÃ©installer le bootloader (non utile sur VPS ou raspberry). Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /mnt/root
<span class="nb">chroot</span> <span class="nb">.</span> bash
<span class="nb">mkdir</span> <span class="nt">-p</span> dev proc run sys tmp
mount <span class="nt">-t</span> devtmpfs dev /dev
mount <span class="nt">-t</span> proc proc /proc
grub_install /dev/sda <i class="conum" data-value="1"></i><b>(1)</b>
umount /proc
umount /dev
<span class="nb">sync
exit</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>tapez ici le nom de device de votre disque de boot</td>
</tr>
</table>
</div>
</li>
<li>
<p>CrÃ©ez votre fichier de swap en suivant <a href="#swap_create">la
procÃ©dure</a>. Attention le fichier de swap doit Ãªtre installÃ© dans
<code>/mnt/root/swapfile</code></p>
</li>
<li>
<p>vous pouvez maintenant rebooter votre machine en mode normal.</p>
</li>
<li>
<p>une autre faÃ§on de remonter la sauvegarde est d&#8217;extraire un fichier tar.xz directement du serveur de stockage et de transfÃ©rer cette archive sur la machine en mode rescue puis de dÃ©compresser. La commande de gÃ©nÃ©ration d&#8217;archive est:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">borg export-tar <span class="nt">--list</span> borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/::&lt;votre_archive&gt; restore.tar.xz</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_borgweb">14.11. Installation de Borgweb</h3>
<div class="paragraph">
<p>Borgweb existe en version officielle. Cette version n&#8217;a pas trop d&#8217;intÃ©ret pour nous Ã©tant donnÃ©e qu&#8217;elle n&#8217;interroge pas le serveur de stockage pour obtenir les informations des backups rÃ©alisÃ©s. Il existe un clone de repository qui implÃ©mente une fonctionnalitÃ© qui liste tous les backups effectuÃ©s sur le serveur de stockage</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante sur le serveur de stockage:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;storing_srv&gt;. </a></p>
</li>
<li>
<p>Installez pip  pour python3 et NPM. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>python3-pip npm</code></pre>
</div>
</div>
</li>
<li>
<p>Installer le logiciel dans le rÃ©pertoire <code>/var/lib/borgweb</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /var/lib/borgweb
<span class="nb">cd</span> /var/lib/borgweb
git clone https://github.com/vche/borgweb.git</code></pre>
</div>
</div>
</li>
<li>
<p>Dans la version testÃ©e, le fichier <code>README.rst</code> est utilisÃ© par l&#8217;installeur mais plus prÃ©sent dans le repo. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd </span>borgweb
<span class="nb">touch </span>README.rst</code></pre>
</div>
</div>
</li>
<li>
<p>Lancez l&#8217;installation. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">pip3 <span class="nb">install</span> <span class="nt">-e</span> <span class="nb">.</span>
<span class="nb">cd </span>js
npm <span class="nb">install</span></code></pre>
</div>
</div>
</li>
<li>
<p>Editez la configuration. Comme la variable d&#8217;environnement <code>BORG_CONFIG</code> semble n&#8217;avoir aucun effet, Ã©ditez directement le fichier de configuration du repository. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /var/lib/borgweb/borgweb/borgweb
vi config.py</code></pre>
</div>
</div>
</li>
<li>
<p>Mettez ce texte dans le fichier Ã©ditÃ©:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s">"""This is the basic configuration class for BorgWeb."""</span>

    <span class="c1">#: builtin web server configuration
</span>    <span class="n">HOST</span> <span class="o">=</span> <span class="s">'127.0.0.1'</span>  <span class="c1"># use 0.0.0.0 to bind to all interfaces
</span>    <span class="n">PORT</span> <span class="o">=</span> <span class="mi">5000</span>  <span class="c1"># ports &lt; 1024 need root
</span>    <span class="n">DEBUG</span><span class="o">=</span><span class="bp">False</span>

    <span class="c1">#: borg / borgweb configuration
</span>    <span class="n">LOG_DIR</span> <span class="o">=</span> <span class="s">'/var/log/borg'</span>
    <span class="n">BORG_PATH</span><span class="o">=</span><span class="s">"/usr/bin/borg"</span>

    <span class="c1"># Repo status cache configuration. TTL in secs
</span>    <span class="n">STATUS_CACHE_TTL</span><span class="o">=</span><span class="mi">43200</span>
    <span class="n">STATUS_CACHE_PATH</span><span class="o">=</span><span class="s">"/tmp/borgweb.cache"</span>

    <span class="n">BACKUP_REPOS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># Repo  name
</span>        <span class="s">"example.com"</span><span class="p">:</span> <span class="p">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="c1"># Repo absolute path
</span>            <span class="s">"repo_path"</span><span class="p">:</span> <span class="s">"/home/borgbackup/borgbackup"</span><span class="p">,</span>

            <span class="c1"># Repo logs absolute path, or relative to the main LOG_DIR
</span>            <span class="s">"log_path"</span><span class="p">:</span> <span class="s">"/var/log/borg/"</span><span class="p">,</span>

            <span class="c1"># Repo password
</span>            <span class="s">"repo_pwd"</span><span class="p">:</span> <span class="s">"your_password"</span><span class="p">,</span> <i class="conum" data-value="1"></i><b>(1)</b>

            <span class="c1"># Command/script to run to manually start a backup.
</span>            <span class="c1"># If left empty or not specified, the backup won't be
</span>            <span class="c1"># manually runnable
</span>            <span class="s">"script"</span><span class="p">:</span> <span class="s">"script"</span><span class="p">,</span>

            <span class="c1"># Filled with discovered backups in the repo
</span>            <span class="s">"backups"</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>InsÃ©rez ici le mot de passe du dÃ©pot Borg Backup</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Mettez ici le nom de votre domaine sauvegardÃ©</td>
</tr>
</table>
</div>
</li>
<li>
<p>CrÃ©ez un service <code>systemd</code>. Editez le fichier de service. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/systemd/system/borgweb.service</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>[Unit]
Description=Borgweb Daemon
After=syslog.target network.target

[Service]
WorkingDirectory=/var/lib/borgweb
User=root
Group=root
UMask=0002
Restart=on-failure
RestartSec=5
Type=simple
ExecStart=/usr/local/bin/borgweb
KillSignal=SIGINT
TimeoutStopSec=20
SyslogIdentifier=borgweb

[Install]
WantedBy=multi-user.target</code></pre>
</div>
</div>
</li>
<li>
<p>Recharge la base de systemd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl daemon-reload</code></pre>
</div>
</div>
</li>
<li>
<p>Activez et dÃ©marrez <code>borgweb</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl <span class="nb">enable </span>borgweb.service
systemctl start borgweb.service</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_borgweb">14.12. CrÃ©ation du site web de Borgweb</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes Dans ISPConfig de votre serveur de stockage &lt;storing_srv&gt;:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>borgweb</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>borgweb</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>borgweb</code>.</p>
</li>
<li>
<p>Activer letâs encrypt ssl</p>
</li>
<li>
<p>Activer <code>Fast CGI</code> pour PHP</p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="c"># borgweb httpserver</span>
<span class="c">#</span>

<span class="p">&lt;</span><span class="nl">Location</span><span class="sr"> /</span><span class="p">&gt;
</span>    <span class="nc">AllowOverride</span> <span class="ss">AuthConfig</span>
    <span class="nc">AuthUserFile</span> /var/lib/borgweb/borgweb-htpasswd
    <span class="nc">AuthName</span> "Borgweb"
    <span class="nc">AuthType</span> <span class="ss">Basic</span>
    <span class="nc">Require</span> valid-user

<span class="p">&lt;/</span><span class="nl">Location</span><span class="p">&gt;
</span>

<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># borgweb httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>
<span class="nc">ProxyPass</span> / http://localhost:5000/
<span class="nc">ProxyPassReverse</span> / http://localhost:5000/

<span class="nc">RedirectMatch</span> ^/$ https://borgweb.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;storing_srv&gt;. </a></p>
</li>
<li>
<p>CrÃ©ez ensuite le fichier de mot de passe de borgweb dans votre &lt;storing_srv&gt;:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">htpasswd <span class="nt">-c</span> /var/lib/borgweb/borgweb-htpasswd admin</code></pre>
</div>
</div>
</li>
<li>
<p>Tapez <a href="#pass_gen">votre mot de passe gÃ©nÃ©rÃ©</a></p>
</li>
<li>
<p>RedÃ©marrez apache. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service apache2 restart</code></pre>
</div>
</div>
</li>
<li>
<p>Pointez votre navigateur sur <a href="https://borgweb.storing_srv" class="bare">https://borgweb.storing_srv</a> , un mot de passe vous est demandÃ©. Tapez <code>admin</code> pour le user et le password saisi. Vous accÃ©dez aux informations de sauvegarde de votre site.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_annexe">15. Annexe</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_configuration_dun_Ã©cran_3_5_inch_rpi_lcd_a">15.1. Configuration d&#8217;un Ã©cran 3.5 inch RPI LCD (A)</h3>
<div class="sect3">
<h4 id="_pour_commencer">15.1.1. Pour commencer</h4>
<div class="paragraph">
<p>Le RPi LCD peut Ãªtre pilotÃ© de deux maniÃ¨res :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>installer le pilote sur votre
Raspbian OS.</p>
</li>
<li>
<p>utiliser le fichier image prÃªt Ã  l&#8217;emploi ou lle pilote LCD est prÃ©installÃ©.</p>
</li>
<li>
<p>TÃ©lÃ©chargez la derniÃ¨re image sur le site web de Raspberry Pi et Ã©crivez-la sur la carte SD.</p>
</li>
<li>
<p>Connectez l&#8217;Ã©cran LCD RPI Ã  Raspberry Pi et connectez le Pi au rÃ©seau.</p>
</li>
<li>
<p>Configurez votre Pi :</p>
<div class="literalblock">
<div class="content">
<pre>sudo raspi-config</pre>
</div>
</div>
</li>
<li>
<p>configurez ainsi :</p>
<div class="ulist">
<ul>
<li>
<p>SÃ©lectionnez "Expand Filesystem".</p>
</li>
<li>
<p>Boot Option &#8594; Desktop Autologin (peut diffÃ©rer selon la rÃ©vision Raspbian)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ouvrez le terminal du Raspberry PI (Vous devrez peut-Ãªtre connecter un clavier et un Ã©cran LCD HDMI Ã  PI pour l&#8217;installation du pilote). Tapez:</p>
<div class="literalblock">
<div class="content">
<pre>git clone https://github.com/waveshare/LCD-show.git
cd LCD-show/</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note: Une connexion rÃ©seau est nÃ©cessaire lors de l&#8217;installation du pilote sur votre Pi, sinon l&#8217;installation ne fonctionnera pas correctement.</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>chmod +x LCD35-show
./LCD35-show</pre>
</div>
</div>
</li>
<li>
<p>AprÃ¨s le redÃ©marrage du systÃ¨me, le RPI LCD est prÃªt Ã  l&#8217;emploi.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_basculer_entre_laffichage_lcd_et_hdmi">15.1.2. Basculer entre l&#8217;affichage LCD et HDMI</h4>
<div class="paragraph">
<p>Une fois que l&#8217;Ã©cran LCD est activÃ©, les paramÃ¨tres par dÃ©faut pour HDMI sont modifiÃ©s. Si vous souhaitez utiliser un autre moniteur HDMI, veuillez exÃ©cuter la commande suivante :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd LCD-show/
./LCD-hdmi</pre>
</div>
</div>
<div class="paragraph">
<p>Cela permet de basculer le mode sur l&#8217;affichage LCD :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>chmod +x LCD35-show
./LCD35-show</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_paramÃ¨tres_dorientation_de_lÃ©cran">15.1.3. ParamÃ¨tres d&#8217;orientation de l&#8217;Ã©cran</h4>
<div class="paragraph">
<p>Une fois le pilote tactile installÃ©, l&#8217;orientation de l&#8217;Ã©cran peut Ãªtre dÃ©finie par ces commandes :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rotation de 0 degrÃ©s</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>cd LCD-show/
./LCD35-show 0</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Rotation de 90 degrÃ©s</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>cd LCD-show/
./LCD35-show 90</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Rotation de 180 degrÃ©s</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>cd LCD-show/
./LCD35-show 180</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Rotation de 270 degrÃ©s</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>cd LCD-show/
./LCD35-show 270</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_calibrage_de_lÃ©cran_tactile">15.1.4. Calibrage de l&#8217;Ã©cran tactile</h4>
<div class="paragraph">
<p>Cet Ã©cran LCD peut Ãªtre calibrÃ© Ã  l&#8217;aide d&#8217;un programme appelÃ© <code>xinput_calibrator</code> . Il n&#8217;est pas prÃ©installÃ© sur le systÃ¨me d&#8217;exploitation Raspbian original. Vous devez donc le tÃ©lÃ©charger et installer le programme manuellement.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo apt-get install -y xinput-calibrator</pre>
</div>
</div>
<div class="paragraph">
<p>Entrez les commandes suivantes pour le calibrage de l&#8217;Ã©cran tactile :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo DISPLAY=:0.0 xinput_calibrator</pre>
</div>
</div>
<div class="paragraph">
<p>ou SÃ©lectionnez Menu &#8594; Preferences &#8594; Calibrate Touchscreen.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s l&#8217;exÃ©cution de ces commandes, l&#8217;Ã©cran LCD affiche une invite pour un calibrage en quatre points. Cliquez sur les points un par un pour terminer le calibrage tactile. Ensuite, les nouvelles donnÃ©es de calibrage seront affichÃ©es dans le terminal, comme indiquÃ© ci-dessous. Veuillez obtenir ces donnÃ©es pour une utilisation ultÃ©rieure.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Doing dynamic recalibration:
Setting new calibration data: 3919, 208, 236, 3913</pre>
</div>
</div>
<div class="paragraph">
<p>Tapez la commande suivante pour Ã©diter 99-calibration.conf:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo nano /etc/X11/xorg.conf.d/99-calibration.conf</pre>
</div>
</div>
<div class="paragraph">
<p>Ensuite, les anciennes donnÃ©es d&#8217;Ã©talonnage seront affichÃ©es dans le terminal :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Section "InputClass"
Identifier  "calibration"
MatchProduct    "ADS7846 Touchscreen"
Option  "Calibration"   "160 3723 3896 181"
Option  "SwapAxes"  "1"
EndSection</pre>
</div>
</div>
<div class="paragraph">
<p>Modifiez les donnÃ©es d&#8217;Ã©talonnage en fonction des nouvelles donnÃ©es d&#8217;Ã©talonnage affichÃ©es plus haut :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Section "InputClass"
Identifier  "calibration"
MatchProduct    "ADS7846 Touchscreen"
Option  "Calibration"   "3919 208 236 3913"
Option  "SwapAxes"  "1"
EndSection</pre>
</div>
</div>
<div class="paragraph">
<p>Appuyez sur les touches Ctrl+X, et sÃ©lectionnez l&#8217;option Y pour enregistrer la modification.</p>
</div>
<div class="paragraph">
<p>La modification sera valide aprÃ¨s le redÃ©marrage du systÃ¨me. Entrez la commande suivante pour le redÃ©marrage du systÃ¨me :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo reboot</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notices: En cas de toucher imprÃ©cis, veuillez procÃ©der Ã  un nouvel Ã©talonnage de l&#8217;Ã©cran et redÃ©marrer le systÃ¨me.</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_installer_un_clavier_virtuel">15.1.5. Installer un clavier virtuel</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installer matchbox-keyboard</p>
<div class="literalblock">
<div class="content">
<pre>sudo apt-get install update
sudo apt-get install matchbox-keyboard
sudo nano /usr/bin/toggle-matchbox-keyboard.sh</pre>
</div>
</div>
</li>
<li>
<p>Copiez les commandes ci-dessous dans toggle-matchbox-keyboard.sh et sauvegardez.</p>
<div class="literalblock">
<div class="content">
<pre>#!/bin/bash
#This script toggle the virtual keyboard
PID=`pidof matchbox-keyboard`
if [Â ! -e $PID ]; then
killall matchbox-keyboard
else
matchbox-keyboard -s 50 extended&amp;
fi</pre>
</div>
</div>
</li>
<li>
<p>ExÃ©cutez les commandes:</p>
<div class="literalblock">
<div class="content">
<pre>sudo chmod +x /usr/bin/toggle-matchbox-keyboard.sh
sudo mkdir /usr/local/share/applications
sudo nano /usr/local/share/applications/toggle-matchbox-keyboard.desktop</pre>
</div>
</div>
</li>
<li>
<p>Copiez les commandes ci-dessous dans toggle-matchbox-keyboard.desktop et sauvegardez.</p>
<div class="literalblock">
<div class="content">
<pre>[Desktop Entry]
Name=Toggle Matchbox Keyboard
Comment=Toggle Matchbox Keyboard`
Exec=toggle-matchbox-keyboard.sh
Type=Application
Icon=matchbox-keyboard.png
Categories=Panel;Utility;MB
X-MB-INPUT-MECHANSIM=True</pre>
</div>
</div>
</li>
<li>
<p>ExÃ©cutez les commandes ci dessous.</p>
<div class="paragraph">
<p><strong>NOTE: Notez que vous devez utiliser les droits d&#8217;utilisateur "Pi" au lieu de root pour exÃ©cuter cette commande</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>nano ~/.config/lxpanel/LXDE-pi/panels/panel</pre>
</div>
</div>
</li>
<li>
<p>Trouvez la dÃ©claration qui est similaire Ã  celle ci-dessous : (Elle peut Ãªtre diffÃ©rente dans une autre version)</p>
<div class="literalblock">
<div class="content">
<pre>Plugin {
  type = launchbar
  Config {
    Button {
      id=lxde-screenlock.desktop
    }
    Button {
      id=lxde-logout.desktop
    }
  }
}</pre>
</div>
</div>
</li>
<li>
<p>Ajoutez ces dÃ©clarations pour ajouter une option de bouton :</p>
<div class="literalblock">
<div class="content">
<pre>Button {
  id=/usr/local/share/applications/toggle-matchbox-keyboard.desktop
}</pre>
</div>
</div>
</li>
<li>
<p>redÃ©marrez votre Raspberry Pi. Si le clavier virtuel est correctement installÃ©, vous pouvez constater qu&#8217;il y a une icÃ´ne de clavier sur la gauche de la barre</p>
<div class="literalblock">
<div class="content">
<pre>sudo reboot</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_ressources">15.1.6. Ressources</h4>
<div class="sect4">
<h5 id="_manuel_utilisateur">Manuel utilisateur</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.waveshare.com/w/upload/1/1e/RPi_LCD_User_Manual_EN.pdf">RPiLCD User Manual</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_images">Images</h5>
<div class="paragraph">
<p>Description : si vous avez eu du mal Ã  installer le pilote, essayez l&#8217;image avec le pilote prÃ©installÃ©.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://drive.google.com/open?id=1xsvANujoImwVQvdf0n7IiUjP8BuCe2GK">RPi-35inch-LCD-(A)-Raspbian-180326.7z</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_driver">Driver</h5>
<div class="paragraph">
<p>Le pilote peut Ãªtre tÃ©lÃ©chargÃ© sur github</p>
</div>
<div class="literalblock">
<div class="content">
<pre>git clone https://github.com/waveshare/LCD-show.git</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fichiers_de_configuration_de_rÃ©fÃ©rence">Fichiers de configuration de rÃ©fÃ©rence</h5>
<div class="paragraph">
<p>/boot/cmdline.txt</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dwc_otg.lpm_enable=0 console=tty1 console=ttyAMA0,115200 root=/dev/mmcblk0p7 rootfstype=ext4 elevator=deadline rootwait fbcon=map:10 fbcon=font:ProFont6x11 logo.nologo</pre>
</div>
</div>
<div class="paragraph">
<p>/boot/config.txt</p>
</div>
<div class="listingblock">
<div class="content">
<pre># For more options and information see
# http://www.raspberrypi.org/documentation/configuration/config-txt.md
# Some settings may impact device functionality. See link above for details

# uncomment if you get no picture on HDMI for a default "safe" mode
#hdmi_safe=1

# uncomment this if your display has a black border of unused pixels visible
# and your display can output without overscan
#disable_overscan=1

# uncomment the following to adjust overscan. Use positive numbers if console
# goes off screen, and negative if there is too much border
#overscan_left=16
#overscan_right=16
#overscan_top=16
#overscan_bottom=16

# uncomment to force a console size. By default it will be display's size minus
# overscan.
#framebuffer_width=1280
#framebuffer_height=720

# uncomment if hdmi display is not detected and composite is being output
hdmi_force_hotplug=1

# uncomment to force a specific HDMI mode (this will force VGA)
#hdmi_group=1
#hdmi_mode=1

# uncomment to force a HDMI mode rather than DVI. This can make audio work in
# DMT (computer monitor) modes
#hdmi_drive=2

# uncomment to increase signal to HDMI, if you have interference, blanking, or
# no display
#config_hdmi_boost=4

# uncomment for composite PAL
#sdtv_mode=2

#uncomment to overclock the arm. 700 MHz is the default.
#arm_freq=800

# Uncomment some or all of these to enable the optional hardware interfaces
dtparam=i2c_arm=on
#dtparam=i2s=on
dtparam=spi=on
enable_uart=1
# Uncomment this to enable the lirc-rpi module
#dtoverlay=lirc-rpi

# Additional overlays and parameters are documented /boot/overlays/README

# Enable audio (loads snd_bcm2835)
dtparam=audio=on
dtoverlay=tft35a
#dtoverlay=ads7846,cs=1,penirq=17,penirq_pull=2,speed=1000000,keep_vref_on=1,swapxy=1,pmax=255,xohms=60,xmin=200,xmax=3900,ymin=200,ymax=3900</pre>
</div>
</div>
<div class="paragraph">
<p>/etc/inittab</p>
</div>
<div class="paragraph">
<p>Ajouter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#Spawn a getty on Raspberry Pi serial line
T0:23:respawn:/sbin/getty -L ttyAMA0 115200 vt100</pre>
</div>
</div>
<div class="paragraph">
<p>/usr/share/X11/xorg.conf/99-fbturbo.conf</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Section "Device"
        Identifier      "Allwinner A10/A13/A20 FBDEV"
        Driver          "fbturbo"
        Option          "fbdev" "/dev/fb1"

        Option          "SwapbuffersWait" "true"
EndSection</pre>
</div>
</div>
<div class="paragraph">
<p>/usr/share/X11/xorg.conf.d/40-libinput.conf
/usr/share/X11/xorg.conf.d/45-evdev.conf</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Section "InputClass"
        Identifier "libinput pointer catchall"
        MatchIsPointer "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection

Section "InputClass"
        Identifier "libinput keyboard catchall"
        MatchIsKeyboard "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection

Section "InputClass"
        Identifier "libinput touchpad catchall"
        MatchIsTouchpad "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection

Section "InputClass"
        Identifier "libinput touchscreen catchall"
        MatchIsTouchscreen "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection

Section "InputClass"
        Identifier "libinput tablet catchall"
        MatchIsTablet "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection</pre>
</div>
</div>
<div class="paragraph">
<p>/etc/X11/xorg.conf.d/99-calibration.conf</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Section "InputClass"
        Identifier      "calibration"
        MatchProduct    "ADS7846 Touchscreen"
        Option  "Calibration"   "3936 227 268 3880"
        Option  "SwapAxes"      "1"
EndSection</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.1<br>
Last updated 2022-05-17 00:50:40 +0200
</div>
</div>
</body>
</html>